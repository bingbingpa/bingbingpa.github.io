<!DOCTYPE html><html lang="ko" prefix="og: http://ogp.me/ns#"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.215fae47ff5351112280.css" id="gatsby-global-css">@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:300;src:local("Open Sans Light "),local("Open Sans-Light"),url(/static/open-sans-latin-300-60c866748ff15f5b347fdba64596b1b1.woff2) format("woff2"),url(/static/open-sans-latin-300-521d17bc9f3526c690e8ada6eee55bec.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:300;src:local("Open Sans Light italic"),local("Open Sans-Lightitalic"),url(/static/open-sans-latin-300italic-06bbd3188b34820cd83a0e0b3d0a6f57.woff2) format("woff2"),url(/static/open-sans-latin-300italic-8a648ff38ded89ea15916e84529d62d3.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:400;src:local("Open Sans Regular "),local("Open Sans-Regular"),url(/static/open-sans-latin-400-cffb686d7d2f4682df8342bd4d276e09.woff2) format("woff2"),url(/static/open-sans-latin-400-bf2d0783515b7d75c35bde69e01b3135.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:400;src:local("Open Sans Regular italic"),local("Open Sans-Regularitalic"),url(/static/open-sans-latin-400italic-987032ea5d57c93d8da215678eae3b86.woff2) format("woff2"),url(/static/open-sans-latin-400italic-db70d0b9cb27ada1a260a2b35e756b8b.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:600;src:local("Open Sans SemiBold "),local("Open Sans-SemiBold"),url(/static/open-sans-latin-600-223a277bd88d8a90c8cdf24cda0ad5f5.woff2) format("woff2"),url(/static/open-sans-latin-600-1cd5320f8937d337b61d5117cf9d7b28.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:600;src:local("Open Sans SemiBold italic"),local("Open Sans-SemiBolditalic"),url(/static/open-sans-latin-600italic-4950a7205f0b5cefe41fc03ac346e236.woff2) format("woff2"),url(/static/open-sans-latin-600italic-318ea1ada4102c0704a0637228dcad03.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:700;src:local("Open Sans Bold "),local("Open Sans-Bold"),url(/static/open-sans-latin-700-d08c09f2f169f4a6edbcf8b8d1636cb4.woff2) format("woff2"),url(/static/open-sans-latin-700-623e3205570002af47fc2b88f9335d19.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:700;src:local("Open Sans Bold italic"),local("Open Sans-Bolditalic"),url(/static/open-sans-latin-700italic-c02f5da6e82e1efe0b45841bfd49ce37.woff2) format("woff2"),url(/static/open-sans-latin-700italic-72e19cbb0e38c6773a7751156752cec4.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:800;src:local("Open Sans ExtraBold "),local("Open Sans-ExtraBold"),url(/static/open-sans-latin-800-aaeffaf205b9bbb09920089a14dbe9e8.woff2) format("woff2"),url(/static/open-sans-latin-800-c6aa0c4a601fb6ac66f8253fa594dff5.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:800;src:local("Open Sans ExtraBold italic"),local("Open Sans-ExtraBolditalic"),url(/static/open-sans-latin-800italic-6b3973ffe02bb6a8be0f8453506ec032.woff2) format("woff2"),url(/static/open-sans-latin-800italic-79b58175343190550489efe46a7f1138.woff) format("woff")}.footer{background:#fff;padding:0 20px 120px}.footer ul{list-style:none;text-align:center;padding:0}.footer ul li{color:#969492;font-size:.8em;padding:2px 10px;position:relative;display:inline-block}.footer ul li:after{content:"\2022";position:absolute;right:-5px}.footer ul li:last-child:after{content:""}@media screen and (min-width:1024px){.footer{padding:0 1em 1.5em}}.item,.showItem{background:transparent;transition:all .5s;display:flex;align-items:center}.item a,.showItem a{padding:10px;display:flex;align-items:center}.item svg,.showItem svg{margin:0 5px 0 0;opacity:.3}.itemList .hideItem{display:none}@media screen and (min-width:1024px){.item a{color:#3e3e3c;padding:10px;transition:all .5s;border-radius:5px}.homepage:not(.fixed) .item a{color:#fff}.item a:hover{color:#709425;background:hsla(0,0%,100%,.4)}.item svg{transition:all .5s}.item:hover svg{fill:#709425;opacity:1}.hero .item:hover svg svg{fill:green}.showItem{display:none}.hiddenItem{text-align:left;padding:5px}.hiddenItem a.inHiddenItem{color:#3e3e3c}.hiddenItem a.inHiddenItem:hover{color:#709425}}.more{cursor:pointer}@media screen and (max-width:1023px){.more{background:#fff;border-radius:5px 5px 0 0;border:1px solid #709425;border-bottom:none;position:absolute;left:50%;top:-35px;width:60px;height:36px;overflow:hidden;z-index:1;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.more:focus{outline:none}.more:focus svg{fill:#709425}.more svg{transition:all .5s;-webkit-transform:rotate(180deg);transform:rotate(180deg);fill:orange}.open .more svg{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}@media screen and (min-width:1024px){.more{flex-shrink:0;flex-grow:0;width:44px;height:38px;background:transparent;margin-left:10px;border-radius:5px;border:1px solid #ecebea;display:flex;transition:background-color .5s;justify-content:center;align-items:center;padding:0;z-index:1}.more:focus,.more:hover{outline:none}.more svg{transition:all .5s}.homepage .more{border:1px solid transparent;background-color:hsla(0,0%,100%,.1)}.homepage .more:hover{background-color:hsla(0,0%,100%,.4)}.open .more{background-color:hsla(0,0%,100%,.9);border-bottom-left-radius:0;border-bottom-right-radius:0}.open .more:hover{background-color:hsla(0,0%,100%,.1)}.open .more svg{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fixed .more{border:1px solid #ecebea;height:30px}}.menu{align-items:center;background:#fff;bottom:0;flex-grow:1;left:0;padding:0 10px;position:fixed;z-index:1;transition:all .5s}.itemList,.menu{display:flex;width:100%}.itemList{flex-wrap:wrap;justify-content:center;list-style:none;margin:0;padding:0;position:relative}@media screen and (max-width:1023px){.menu:after{position:absolute;content:"";left:20px;right:20px;top:0;height:1px;background:#709425}.menu.open{padding:20px}.homepage:not(.fixed) .menu{bottom:-100px}}@media screen and (min-width:1024px){.menu{border-top:none;background:transparent;display:flex;position:relative;padding-left:50px;transition:none}.itemList,.menu{justify-content:flex-end}.itemList{padding:0}.hiddenItemList{list-style:none;margin:0;position:absolute;background:#fff;border:1px solid #ecebea;top:48px;right:10px;display:flex;flex-direction:column;justify-content:flex-start;padding:20px;border-radius:5px 0 5px 5px}.hiddenItemList:after{content:"";background:#fff;z-index:10;top:-10px;right:-1px;width:44px;height:10px;position:absolute;border-left:1px solid #ecebea;border-right:1px solid #ecebea}.homepage:not(.fixed) .hiddenItemList{border:1px solid transparent;background:hsla(0,0%,100%,.9);top:50px}.homepage:not(.fixed) .hiddenItemList:after{top:-11px;border-left:1px solid transparent;border-right:1px solid transparent;background:hsla(0,0%,100%,.9)}.fixed .hiddenItemList{top:44px}}.header{justify-content:center;background-color:#fff;height:80px;position:relative;top:0;width:100%}.header,.header a.logoType{align-items:center;display:flex}.header a.logoType{flex-direction:"column";color:#3e3e3c}.header a.logoType .logo{flex-shrink:0}.header.homepage{position:absolute;background-color:transparent;height:100px}.h1-header{font-size:1.35em;font-weight:400;margin:0 0 5px}.h2-header{font-weight:400;font-size:.8em;letter-spacing:0;margin:0}.logo{border-radius:65% 75%;border:1px solid #eee;display:inline-block;height:44px;margin:0 20px 0 0;overflow:hidden;width:44px;transition:all .5s}.homepage .logo{height:60px;width:60px}.logo img{width:100%}.sensor-homepage{top:100px}.sensor-default,.sensor-homepage{display:block;position:absolute;bottom:0;z-index:1;left:0;right:0;height:1px}.sensor-default{top:80px}@media screen and (min-width:600px){.header{padding:40px}.header.homepage{height:100px}}@media screen and (max-width:1023px){.header.homepage .logo{border:none}.header.homepage .h1-header,.header.homepage a.logoType{color:#fff}.header.homepage .h2-header{color:#dddbda}}@media screen and (min-width:1024px){.header{align-items:center;display:flex;position:absolute;justify-content:space-between;transition:padding .5s}.header,.header.fixed{background-color:#fff;top:0;width:100%}.header.fixed{height:50px;left:0;padding:0 20px;position:fixed;z-index:1}.header.fixed .h1-header{margin:0 0 2px}.header.fixed .h2-header{display:none}.header.homepage:not(.fixed) .h1-header,.header.homepage:not(.fixed) a.logoType{color:#fff}.header.homepage:not(.fixed) .h2-header{color:#dddbda}.header a.logoType{text-align:left;flex-direction:row;flex-shrink:0;width:auto}.logo{margin:0 20px 0 0}.fixed .logo{height:36px;width:36px}.header.homepage:not(.fixed) .logo{border:none}h2{-webkit-animation-duration:.5s;animation-duration:.5s;-webkit-animation-name:h2Entry;animation-name:h2Entry}@-webkit-keyframes h2Entry{0%{opacity:0}to{opacity:1}}@keyframes h2Entry{0%{opacity:0}to{opacity:1}}}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit;margin:0;padding:0}body{font-family:Open Sans,sans-serif}body h1,body h2,body h3{font-weight:600;line-height:1.1;letter-spacing:-.03em;margin:0}body h1{letter-spacing:-.04em}body p{margin:0}body strong{font-weight:600}body a{text-decoration:none;color:#666}body main{width:auto;display:block;min-height:80vh}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.article{padding:20px;margin:0 auto}@media screen and (min-width:600px){.article{padding:20px 40px;max-width:650px}}@media screen and (min-width:1024px){.article{padding:130px 0 40px;max-width:700px}}.h1-headline{font-size:2.2em;margin:0 0 40px;-webkit-animation-name:headlineEntry;animation-name:headlineEntry;-webkit-animation-duration:1s;animation-duration:1s}.h1-headline span{font-weight:400;display:block;font-size:.5em;letter-spacing:0;margin:0 0 5px}.h1-headline svg{height:.75em;fill:#709425}@-webkit-keyframes headlineEntry{0%{opacity:.5}to{opacity:1}}@keyframes headlineEntry{0%{opacity:.5}to{opacity:1}}@media screen and (min-width:600px){.h1-headline{font-size:2.4em}}@media screen and (min-width:1024px){.h1-headline{font-size:2.8em}}.ul-list{margin:0 0 20px;padding:20px;list-style:circle}.li-list{padding:5px 0;font-size:1.1em;line-height:1.4}.h2-category{margin:0 0 .5em}.h2-category svg{height:.8em;fill:#709425}.form-search{border-bottom:1px solid #aaa}.form-search,.input-search{position:relative;display:flex;justify-content:space-between}.input-search{border:0;width:100%;padding:.2em;font-size:1.4em;flex-grow:1}.link{width:100%;color:#3e3e3c}.li-item{border:1px solid transparent;border-radius:10px;margin:40px 0 60px;padding:10px;position:relative;transition:all .5s;background:transparent}.li-item .gatsby-image-outer-wrapper{border-radius:10px;border:1px solid #ecebea;overflow:hidden}.li-item .gatsby-image-outer-wrapper img{z-index:-1}.li-item:after{bottom:-30px}.li-item:after,.li-item:first-child:before{border-top:1px solid #ecebea;content:"";height:0;position:absolute;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);transition:all .5s;width:50%}.li-item:first-child:before{top:-30px}.h1-item{padding:20px 10px 0;line-height:1.1;font-size:1.7em;text-remove-gap:both}.h1-item .arrow{display:none;position:relative;top:7px}.item-meta{display:flex;flex-flow:row wrap;font-size:.8em;padding:20px 10px;background:transparent}.item-meta svg{fill:#709425;margin:0 5px 0 0}.item-meta span{align-items:center;display:flex;text-transform:uppercase;margin:5px 10px 5px 0}.item-excerpt{line-height:1.5;padding:0 10px;text-remove-gap:both}@media screen and (min-width:600px){.li-item{padding:20px}.li-item:after{bottom:-40px}.li-item:first-child:before{top:-35px}.h1-item{font-size:2.04em;padding:30px 20px 0;transition:all .5s}.item-meta{padding:30px 20px}.item-excerpt{padding:0 20px}}@media screen and (min-width:1024px){.li-item{padding:0 0 40px}.li-item:after{bottom:-30px}.blogItemLink:first-child>li:before,.li-item:first-child:before{top:-55px}.h1-item{font-size:2.5em;padding:24px 40px 0}.item-meta{padding:30px 40px 10px}.item-excerpt{padding:0 40px}.li-item:hover{border:1px solid #ecebea;box-shadow:0 3px 2px rgba(0,0,0,.03)}.li-item:hover:after{bottom:-50px}.li-item:hover .gatsby-image-wrapper{-webkit-transform:scale(1.1);transform:scale(1.1)}.li-item:hover .h1-item{color:#709425}.li-item:hover .arrow{opacity:1;stroke:orange;-webkit-transform:translateX(0);transform:translateX(0)}.li-item .arrow,.li-item .gatsby-image-wrapper{transition:all .5s}.li-item .arrow{display:inline-block;fill:orange;stroke:orange;stroke-width:40;stroke-linecap:round;opacity:0;-webkit-transform:translateX(-50%);transform:translateX(-50%)}}.main{padding:0 20px}.blog-ul{list-style:none;margin:0 auto;padding:30px 0 10px}@media screen and (min-width:601px){.main{padding:0 0 30px}.blog-ul{max-width:650px}}@media screen and (min-width:1025px){.blog-ul{max-width:700px}}.icon{display:flex;justify-content:flex-end;margin-bottom:20px}.icon svg{height:30px}.bodytext{-webkit-animation-name:bodytextEntry;animation-name:bodytextEntry;-webkit-animation-duration:1s;animation-duration:1s}.bodytext h2,.bodytext h3{margin:1.5em 0 1em}.bodytext h2{line-height:1.2;font-size:1.7em}.bodytext h3{font-size:1.35em;line-height:1.3}.bodytext p{font-size:1.1em;line-height:1.6;margin:0 0 1.5em}.bodytext ul{list-style:circle;margin:0 0 1.5em;padding:0 0 0 1.5em}.bodytext li{margin:.7em 0;line-height:1.5}.bodytext a{font-weight:600;color:#709425;text-decoration:underline}.bodytext a.gatsby-resp-image-link{display:block;margin:2.5em 0;border-radius:10px;overflow:hidden;border:1px solid #ecebea}.bodytext code.language-text{background:#ecebea;text-shadow:none;color:inherit;padding:.1em .3em .2em;border-radius:.1em}@-webkit-keyframes bodytextEntry{0%{opacity:0}to{opacity:1}}@keyframes bodytextEntry{0%{opacity:0}to{opacity:1}}.meta{display:flex;flex-flow:row wrap;font-size:1em;margin:20px 0;background:transparent}.meta svg{fill:#709425;margin:0 5px 0 0}.meta .span-meta{align-items:center;display:flex;text-transform:uppercase;margin:5px 10px 5px 0}@media screen and (min-width:600px){.meta{margin:30px 0 20px}}.author{margin:40px 0;padding:40px 0;border-top:1px solid #ecebea;border-bottom:1px solid #ecebea}.avatar{float:left;border-radius:65% 75%;border:1px solid #ecebea;display:inline-block;height:50px;margin:5px 20px 0 0;overflow:hidden;width:50px}.avatar img{width:100%}.note{font-size:.9em;line-height:1.6}@media screen and (min-width:600px){.author{display:flex}.avatar{flex:0 0 auto}}.links{flex-direction:column;padding:0 20px 40px;border-bottom:1px solid #ecebea;margin:0 0 40px}.links,.links a{display:flex}.links a:nth-child(2){margin:20px 0 0}.links svg{fill:orange;width:20px;height:20px;flex-shrink:0;flex-grow:0;margin:20px}h4{font-weight:600;margin:0;font-size:1.1em}time{color:#969492;display:block;font-weight:400;font-size:.8em;margin-top:.5em}@media screen and (min-width:1024px){.links{flex-direction:row-reverse;justify-content:center}.links a{flex-basis:50%}.links a:nth-child(2){margin:0}.links svg{transition:all .5s;margin:10px}}@media screen and (min-width:1024px)and (hover:hover){.links a:hover svg{-webkit-transform:scale(1.5);transform:scale(1.5)}}@media(max-width:768px){.matrix{width:100%}}.hero{align-items:center;display:flex;justify-content:center}.button-matrix{position:absolute;top:80%;background:#709425;border:0;border-radius:50%;font-size:1.35em;padding:10px 20px;cursor:pointer;width:80px;height:80px}.button-matrix:focus{outline-style:none;background:#709425}.button-matrix svg{position:relative;top:5px;fill:#fff;stroke-width:40;stroke:#fff;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-name:buttonIconMove;animation-name:buttonIconMove;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite}@-webkit-keyframes buttonIconMove{0%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(-10px);transform:translateY(-10px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes buttonIconMove{0%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(-10px);transform:translateY(-10px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}.hr-index{margin:0;border:0}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="canonical" href="https://bingbingpa.github.io/load-balancing-session-clustering/" data-baseprotocol="https:" data-basehost="bingbingpa.github.io"/><title data-react-helmet="true">Load Balancing, Session Clustering - 삽질 저장소</title><meta data-react-helmet="true" name="description" content="삽질한 내용들을 정리하는 블로그"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="Load Balancing, Session Clustering - 삽질 저장소"/><meta data-react-helmet="true" property="og:description" content="삽질한 내용들을 정리하는 블로그"/><meta data-react-helmet="true" property="og:image" content="preview.png"/><meta data-react-helmet="true" property="og:url" content="https://bingbingpa.github.io/load-balancing-session-clustering/"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="google-site-verification" content="05n7EQOUWLW-NVaGmvLtb2mFwNCQlApz6zHbZyGwW58"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#666"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-df3d685180072ab29eaf.js"/><link as="script" rel="preload" href="/framework-acd7498685eeb36e39da.js"/><link as="script" rel="preload" href="/1bfc9850-d06e3c25ea137ea82c47.js"/><link as="script" rel="preload" href="/app-cc3235dd701427d7b59f.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/3df72598ed628fa3b584613cd093848b9c087970-7e8ab1b1cd93282549c1.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-dd92b58e687c0d5ee5f5.js"/><link as="fetch" rel="preload" href="/page-data/load-balancing-session-clustering/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/960164547.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/960164547.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#D0E0D8"/><meta name="apple-mobile-web-app-title" content="Lazywill"/><link rel="apple-touch-icon" href="/icons/apple-icon-57x57.png" sizes="57x57"/><link rel="apple-touch-icon" href="/icons/apple-icon-60x60.png" sizes="60x60"/><link rel="apple-touch-icon" href="/icons/apple-icon-72x72.png" sizes="72x72"/><link rel="apple-touch-icon" href="/icons/apple-icon-76x76.png" sizes="76x76"/><link rel="apple-touch-icon" href="/icons/apple-icon-114x114.png" sizes="114x114"/><link rel="apple-touch-icon" href="/icons/apple-icon-120x120.png" sizes="120x120"/><link rel="apple-touch-icon" href="/icons/apple-icon-144x144.png" sizes="144x144"/><link rel="apple-touch-icon" href="/icons/apple-icon-152x152.png" sizes="152x152"/><link rel="apple-touch-icon" href="/icons/apple-icon-180x180.png" sizes="180x180"/><link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="header  "><a class="logoType" href="/"><div class="logo"><img src="https://avatars.githubusercontent.com/u/6446144?v=4" alt="삽질저장소"/></div><div class="type"><h1 class="h1-header">삽질저장소</h1><h2 class="h2-header"></h2></div></a><nav class="menu " rel="js-menu"><ul class="itemList"><li class="item"><a class="" data-slug="/" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg> <!-- -->Home</a></li><li class="item"><a class="" data-slug="/category/" href="/category/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg> <!-- -->Categories</a></li><li class="item"><a class="" data-slug="/search/" href="/search/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg> <!-- -->Search</a></li><li class="item"><a class="" data-slug="/about/" href="/about/"> <!-- -->About</a></li></ul></nav></header><div class="sensor-default"></div><main><article class="article"><header><h1 class="h1-headline">Load Balancing, Session Clustering</h1><p class="meta"><span class="span-meta"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" size="18" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg> <!-- -->2020-06-10</span><span class="span-meta"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" size="18" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg><a href="/category/infra">infra</a></span></p></header><div class="bodytext"><h3>1. 테스트 환경 및 버전</h3>
<ul>
<li>모든 테스트는 docker 에서 진행</li>
<li>centos : CentOS Linux release 8.1.1911(centos 버전 확인은 cat /etc/centos-release)</li>
<li>haproxy : 2.1.5</li>
<li>apache : 2.4</li>
<li>tomcat-conectors(mod_jk) : 1.2.48</li>
<li>tomcat : 9.0.35</li>
<li>db container : gaia3d/mago3d-postgresql(postgresql-12.3) docker image</li>
<li>application : mago3d-CMS(<a href="https://github.com/Gaia3D/mago3d-CMS/tree/mago3d">mago3d 브런치</a>)</li>
</ul>
<h3>2. 네트워크 구성도</h3>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/43f8cfc9a205020436a31a468b586e7b/e05eb/network.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 584px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 69.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACSElEQVR42o2T3W7TQBCF8768ARdcccM7IITgissKgYQEqFRqVVQ1tE1Kk5YkTuz4J7bj2E6d2N31x9hJ04YWxEjjXe+eObt7ZqbBH1aW5WbspprWTNOfK0bXqh6rtUKXW9j71vgX4cu+4kmzpD2HuYbzBD44ivTmPwkrQIVZjSWjTMjCjO+/LFpjn46fyJrmRtegLeyG8Hbhsc3K9DJjNOjjmCPiMNjeE6zexK+8sSJi/VkDtSZNU1zPw3Zc4iQlms3wJhP5d4jjmJui4DGTJ9ds9TfJFjhC4rkOYRCwWCwe6FvkOdPpFEsOGlhjhn5EVJSi6ypZjYNA8dbQHM9K+mFC056xF+g6CXe6llty5OLvLM2bfkHbDglyTTspOY4UjU+u4kVHcxCWZAI0Bf1loghzfaeTSFD7mnAut3ktl3hlgJxNuFSchDlHUyG8lgUvzTg87/K12WK/1SHICtRG3IemhDyR0jm57LGzu8+30wvOBiZSAPfKRhVMTIMkmBC6Nq5tMxwO6Xa7mKaJZVn1vNfr4che5DnkaUzieyyT6FZlGtXT7IXCk6TttS85Hbm0TY+x6xGJ+NMowvf92iOZx5LtsSSkaTi0pTYPLnp1jCPxrvA0dmzF01bJXgizZcGVtNZHryQsHn9uZZVMz0X3Zz/BSAumgj2SS+6K9o2zWPPeyjm0U4xkSdufcxQU6/baLtxVUkoWSrMfaj6bczrTjKso44eXcimXWWuo8WwLQzrCtkYSo/7aq+W9ZBXzBHNoMBwMCKR2K/sNk78xKEZZqxQAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="network"
        title=""
        src="/static/43f8cfc9a205020436a31a468b586e7b/e05eb/network.png"
        srcset="/static/43f8cfc9a205020436a31a468b586e7b/772e8/network.png 200w,
/static/43f8cfc9a205020436a31a468b586e7b/e17e5/network.png 400w,
/static/43f8cfc9a205020436a31a468b586e7b/e05eb/network.png 584w"
        sizes="(max-width: 584px) 100vw, 584px"
      />
    </span>
  </span>
  
  </a>
    </p>
<ul>
<li>
<p>설정 순서</p>
<ul>
<li>사용자 설정</li>
<li>tomcat 서비스 설정</li>
<li>session clustering</li>
<li>apache 설치 및 mod_jk 컴파일 및 설정</li>
<li>haproxy</li>
</ul>
</li>
</ul>
<h3>3. container 설정</h3>
<ul>
<li>테스트에는 db, haproxy, apache-tomcat 2 개 총 4개의 컨테이너가 필요하고 apache-tomcat은 하나의 설정이 완료 된 후 이를 복사하여 사용한다.</li>
</ul>
<h4>3.1. 네트워크 설정</h4>
<ul>
<li>
<p>테스트 시 모든 사람들이 동일한 ip를 사용하도록 네트워크를 만들어서 사용한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker network create --subnet<span class="token operator">=</span><span class="token number">172.18</span>.0.0/16 mynetwork</code></pre></div>
</li>
</ul>
<h4>3.2. database</h4>
<ul>
<li>
<p>database 는 gaia3d 의 mago3d-postgresql 이미지를 사용하도록 한다. (컨테이너끼리만 접근하므로 별도의 host port는 바인딩하지 않는다.)</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker container run --privileged --net mynetwork --ip <span class="token number">172.18</span>.0.10  -d --name <span class="token string">"container-db"</span> gaia3d/mago3d-postgresql /sbin/init</code></pre></div>
</li>
</ul>
<h4>3.3. haproxy</h4>
<ul>
<li>
<p>로드 밸런스 테스트를 위한 haproxy container</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker container run --privileged --net mynetwork --ip <span class="token number">172.18</span>.0.11  -d -p <span class="token number">80</span>:80 -p <span class="token number">9090</span>:9090 --name <span class="token string">"haproxy"</span> gaia3d/haproxy /sbin/init</code></pre></div>
</li>
</ul>
<h4>3.4. apache-tomcat</h4>
<ul>
<li>
<p>mago3d-CMS 저장소의 doc-docker 폴더경로에서 다음을 실행해서 container 를 생성한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker build apache-tomcat -t apache-tomcat
cmd<span class="token operator">></span> docker container run --privileged --net mynetwork --ip <span class="token number">172.18</span>.0.12  -d -p <span class="token number">10080</span>:80 -p <span class="token number">18081</span>:8081 -p <span class="token number">19090</span>:9090 --name <span class="token string">"apache-tomcat1"</span> apache-tomcat /sbin/init</code></pre></div>
</li>
</ul>
<h3>4. 유저 생성 및 sudo 권한 설정</h3>
<ul>
<li>
<p>tomcat 과 관련된 다음의 모든 과정은 생성한 apache-tomcat1 컨테이너에 연결해서 수행한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker <span class="token builtin class-name">exec</span> -it apache-tomcat1 <span class="token function">bash</span></code></pre></div>
</li>
<li>
<p>root 계정외의 별도의 계정을 생성하고 서비스 실행을 위한 권한만 부여한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">adduser -m gaia3d</code></pre></div>
</li>
<li>
<p>유저 생성 후 <strong>passwd</strong> 명령으로 패스워드를 설정해준다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">passwd</span> gaia3d</code></pre></div>
</li>
<li>
<p>생성한 계정에 필요한 명령만 권한을 준다. <strong>/etc/sudoers</strong> 를 직접 수정할 수도 있지만. visudo를 사용 할 경우 파일 수정 시 오타나 문법 오류 등을 검사해 주므로 visudo를 사용한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">sudo</span> visudo
gaia3d  <span class="token assign-left variable">ALL</span><span class="token operator">=</span>NOPASSWD:   /bin/systemctl</code></pre></div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/f2560a94fb692435e6e6740aacf57f5e/6c115/visudo.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 353px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 14.500000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAjUlEQVR42j2PywqFMAxEXfdhrXWlIn2AbVFE8P+/bS5T6F0ckklCJhlijNj3HVJKbNsG6pQScs5Y1xXWWozjiGVZcJ4nnHNNG2OgtW6xQz3UWnFdV1tGSil4ngff9+G+b7zvi2maoJQCZ733OI4DIYRmysi+EKLNDBSkOzDnBd29L+MHrBNeTeZ5/vc7P4XyS9lPIzF4AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="visudo"
        title=""
        src="/static/f2560a94fb692435e6e6740aacf57f5e/6c115/visudo.png"
        srcset="/static/f2560a94fb692435e6e6740aacf57f5e/772e8/visudo.png 200w,
/static/f2560a94fb692435e6e6740aacf57f5e/6c115/visudo.png 353w"
        sizes="(max-width: 353px) 100vw, 353px"
      />
    </span>
  </span>
  
  </a>
    </p>
</li>
</ul>
<h3>5. tomcat 설정</h3>
<ul>
<li>
<p>container 에는 dockerfile 을 통해 미리 다운 받은 jdk와 tomcat이 있다. 이를 /home/생성한 유저폴더 경로로 옮겨주고 권한은 해당 유저의 권한으로 변경해준다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">mv</span> /setup /home/gaia3d/
<span class="token function">chown</span> -R gaia3d:gaia3d /home/gaia3d/setup</code></pre></div>
</li>
<li>
<p>이후 작업은 생성한 사용자로 진행한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">su</span> gaia3d</code></pre></div>
</li>
</ul>
<h4>5.1. 압축 해제 / 경로 설정</h4>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /home/gaia3d/setup
<span class="token function">tar</span> -xvzf jdk-11.tgz
<span class="token function">tar</span> -xvzf tomcat.tgz
<span class="token function">mkdir</span> <span class="token punctuation">..</span>/tools <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> apache-tomcat-9.0.36 mago3d-tomcat <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> mago3d-tomcat <span class="token punctuation">..</span>/tools <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> jdk-11.0.2 <span class="token punctuation">..</span>/tools
<span class="token function">rm</span> -rf /home/gaia3d/tools/mago3d-tomcat/webapps/*</code></pre></div>
<h4>5.2. 자바 경로 및 메모리 설정</h4>
<ul>
<li>linux 의 경우에는 setenv.sh 파일을 만들어 작성하고, windows 의 경우에는 setenv.bat 파일을 만들어 작성한다.</li>
<li>
<p><strong>windows 의 경우 서비스로 등록시 setenv.bat 파일을 읽지 않기 때문에 service.bat 에 설정하거나 환경 변수로 등록해야 한다.</strong></p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /home/gaia3d/tools/mago3d-tomcat/bin
<span class="token function">vi</span> setenv.sh</code></pre></div>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim">export JAVA_HOME<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>gaia3d<span class="token operator">/</span>tools<span class="token operator">/</span>jdk<span class="token operator">-</span><span class="token number">11.0</span><span class="token operator">.</span><span class="token number">2</span>
export JAVA_OPTS<span class="token operator">=</span><span class="token operator">-</span>D<span class="token operator">-</span>Xms4096m<span class="token operator">-</span>Xmx4096m</code></pre></div>
</li>
<li>
<p>tomcat cache 설정</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">vi</span> /home/gaia3d/tools/mago3d-tomcat/conf/context.xml</code></pre></div>
<div class="gatsby-highlight" data-language="xml"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Resources</span> <span class="token attr-name">cachingAllowed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">cacheMaxSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre></div>
</li>
</ul>
<h4>5.3. application 경로 설정</h4>
<ul>
<li>
<p>server.xml 설정 : service 엘리먼트를 다음과 같이 수정한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">vi</span> /home/gaia3d/tools/mago3d-tomcat/conf/server.xml</code></pre></div>
</li>
<li><strong>배치되는 application 의 경로는 docBase로 절대 경로를 잡아준다.</strong> webapp 밑에 배치하지 않는 이유는
apllication 에서 로그 파일을 쓸 경우 webapp 밑에 있는 경우 충돌이나 에러가 발생하는 경우가 있어 별도의 폴더에 배치하여 사용한다.</li>
<li>
<p><strong>application의 의도치 않은 재시작 및 덮어쓰기를 방지하기 위해 unpackWARs, autoDeploy, reloadable 옵션은 false 로 변경한다.</strong></p>
<div class="gatsby-highlight" data-language="xml"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Service</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Catalina<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>9090<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>
           <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>
           <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8446<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment">&lt;!--&lt;Connector port="8019" protocol="AJP/1.3" redirectPort="8446" address="0.0.0.0" secretRequired="false"/>--></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Engine</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Catalina<span class="token punctuation">"</span></span> <span class="token attr-name">defaultHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span> <span class="token attr-name">jvmRoute</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>admin1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.realm.LockOutRealm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.realm.UserDatabaseRealm<span class="token punctuation">"</span></span>
           <span class="token attr-name">resourceName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserDatabase<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Realm</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Host</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span>  <span class="token attr-name">appBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>webapps<span class="token punctuation">"</span></span>
        <span class="token attr-name">unpackWARs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">autoDeploy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.valves.AccessLogValve<span class="token punctuation">"</span></span> <span class="token attr-name">directory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logs<span class="token punctuation">"</span></span>
           <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost_access_log<span class="token punctuation">"</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.txt<span class="token punctuation">"</span></span>
           <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%h %l %u %t <span class="token entity named-entity" title="&quot;">&amp;quot;</span>%r<span class="token entity named-entity" title="&quot;">&amp;quot;</span> %s %b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span> <span class="token attr-name">docBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/gaia3d/tools/mago3d-tomcat/source/mago3d-admin<span class="token punctuation">"</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">reloadable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Host</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Engine</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Service</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Service</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Catalina2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8081<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>
           <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>
           <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8447<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment">&lt;!--&lt;Connector port="8029" protocol="AJP/1.3" redirectPort="8447" address="0.0.0.0" secretRequired="false"/>--></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Engine</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Catalina2<span class="token punctuation">"</span></span> <span class="token attr-name">defaultHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span> <span class="token attr-name">jvmRoute</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.realm.LockOutRealm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Realm</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.realm.UserDatabaseRealm<span class="token punctuation">"</span></span>
           <span class="token attr-name">resourceName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserDatabase<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Realm</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Host</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span>  <span class="token attr-name">appBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>webapps<span class="token punctuation">"</span></span>
        <span class="token attr-name">unpackWARs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">autoDeploy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.valves.AccessLogValve<span class="token punctuation">"</span></span> <span class="token attr-name">directory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logs<span class="token punctuation">"</span></span>
           <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost_access_log2<span class="token punctuation">"</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.txt<span class="token punctuation">"</span></span>
           <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%h %l %u %t <span class="token entity named-entity" title="&quot;">&amp;quot;</span>%r<span class="token entity named-entity" title="&quot;">&amp;quot;</span> %s %b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span> <span class="token attr-name">docBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/gaia3d/tools/mago3d-tomcat/source/mago3d-user<span class="token punctuation">"</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">reloadable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Host</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Engine</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Service</span><span class="token punctuation">></span></span></code></pre></div>
</li>
</ul>
<h4>5.4. application 배치</h4>
<ul>
<li>
<p><strong>resources/develop/application.properties 수정</strong></p>
<ul>
<li>mago3d-CMS jdbc url 은 localhost 로 되어 있으므로 생성한 container-db 의 ip로 변경해준다.</li>
</ul>
</li>
<li>
<p>프로젝트 빌드</p>
<ul>
<li>profile 을 develop 으로 해서 빌드한다.</li>
<li>
<p><strong>springBoot 2.3.0 버전부터는 gradle-6.2.2 보다 상위 버전의 gradle 로 변경후 빌드해야 한다.</strong></p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> gradle clean -xtest
cmd<span class="token operator">></span> gradle build -xtest -Pprofile<span class="token operator">=</span>develop</code></pre></div>
</li>
</ul>
</li>
<li>
<p>mago3d-CMS 프로젝트를 빌드 후 war 파일을 컨테이너로 복사한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker container <span class="token function">cp</span> d:<span class="token punctuation">\</span>mago3d-user-0.0.1-SNAPSHOT.war apache-tomcat1:/home/gaia3d/setup
cmd<span class="token operator">></span> docker container <span class="token function">cp</span> d:<span class="token punctuation">\</span>mago3d-admin-0.0.1-SNAPSHOT.war apache-tomcat1:/home/gaia3d/setup</code></pre></div>
</li>
<li>
<p>복사한 파일 권한 설정 및 이동</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">chown</span> gaia3d:gaia3d /home/gaia3d/setup/*.war
<span class="token function">su</span> gaia3d
<span class="token builtin class-name">cd</span> /home/gaia3d/tools/mago3d-tomcat/ <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p source/mago3d-admin <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p source/mago3d-user
<span class="token builtin class-name">cd</span> /home/gaia3d/setup/
<span class="token function">unzip</span> mago3d-admin-0.0.1-SNAPSHOT.war -d <span class="token punctuation">..</span>/tools/mago3d-tomcat/source/mago3d-admin/
<span class="token function">unzip</span> mago3d-user-0.0.1-SNAPSHOT.war -d <span class="token punctuation">..</span>/tools/mago3d-tomcat/source/mago3d-user/</code></pre></div>
</li>
</ul>
<h4>5.5. log 설정</h4>
<ul>
<li>톰캣에서 서비스되는 어플리케이션의 비즈니스 로그는 기본적으로 톰캣의 logs/catalina.out 파일에 기록되는데 로그 설정을 따로 하지 않으면
계속 이 파일에 로그가 기록되어 파일 사이즈가 계속 커지게 된다. 따라서 별도의 설정이 필요한데 /etc/rogrotate.conf 에 로그 설정을 하는 방법이 있고
logback이나 log4j를 사용하는 방법이 있는데 여기서는 현재 프로젝트에 사용하고 있는 logback을 사용해서 로그 설정을 한다.</li>
<li>
<p>먼저 기존에 기록되던 catalina.out 파일에 더이상 로그를 쓰지 않도록 설정한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">vi</span> /home/gaia3d/tools/mago3d-tomcat/bin/catalina.sh</code></pre></div>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token assign-left variable">CATALINA_OUT</span><span class="token operator">=</span>/dev/null</code></pre></div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/746339260943c916a498d217759422d8/f6386/catalina.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 686px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 43.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoElEQVR42n1SaW+bQBTkcACzNudyWBjCjfEVp6hVq0b9//9q+t7WSV2pyofRnm92Zt5q4xihaXq0bYs8zzGOI7p+wDgMal6VJcqqwvF4xDRNKIoCjuPAtu0P8NowDFwuF2hNbWOzCYgsw36/VwVt1xHZRMQ9PM+DaZoQroCmaZ+CBWhdJ5AkOUpSkmcZwiBAFEXIshwyjiGlRBiGCjwvij0CuhPHkhAjpLu8ZpXz4UAKGweO8GCv17AIHhfLBCEVCJ/2hUsONuoBHi3LgnW3yXZ57QqhLHMkWts+oZY5lmnEt9MJv5YF3ymLn7cXvF1esbQTmudnHM9ncpIgkVKpS9NUqWaV75YVYVFYuLlbvGUpfiQpvgYhXrdbfCF1i+njprmwDf2jaLVaKTWP0HX9L+E8C6zse+AU/ppsrckCR7AJfIjAg05FpmlgSw/9rxn/EFblE3w/wjD0qOsa83zA6XSmjg20N+J6vaLrevWl+v7PyMRsNyFHj4/cM3QobJ++TKG+TJomqCizjCKQlNlut6OzUuG9y5wbW+WGcASPCn8Di9/cDqceeeIAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="catalina"
        title=""
        src="/static/746339260943c916a498d217759422d8/f6386/catalina.png"
        srcset="/static/746339260943c916a498d217759422d8/772e8/catalina.png 200w,
/static/746339260943c916a498d217759422d8/e17e5/catalina.png 400w,
/static/746339260943c916a498d217759422d8/f6386/catalina.png 686w"
        sizes="(max-width: 686px) 100vw, 686px"
      />
    </span>
  </span>
  
  </a>
    </p>
</li>
<li>
<p>logback 설정 확인</p>
<ul>
<li>build 시 설정한 profile 대로 로그 파일이 파일로 생성 되도록 설정 되어 있는지 확인 한다.

  <a
    class="gatsby-resp-image-link"
    href="/static/2ebee08337ca247d1a68686fdb9d8846/715a3/logback.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB6klEQVR42nVUWXaDMAzMZRpqCBi84QVoev9DqSPhJJCXfsyTke2xRguX4Avd54VyLDSXTGkpVH4WsjHT4CO12tO1tdR0lr5v7oRPvkt78xSmSHNINCVGJssA+RQT9WYWdGMQggfeiZ6EV2wOOlC0IHCFggPJFEiNnm6wjN4CJki0rXakBnciZ1yrvbRTAbOlYgv9uoWWAPn5Dvl3yN4o5B+xNm0Ut1+a1zuZuNKIsxp3BpPJjJE8oIeZLhxmNwQh3JDPCZFak2hEGtTAEQXqdBDb4tx3x9GdZaoKkSyEvSfHr6A4xqEYFjmDxBvQTbvt4WP5x4JILt+kC2ELQqMRUY/c8euo6rU1Z6gKrBtGV88citRwhE0lnKeE4iCKMVXEE/opPcH7Hc7yWsOywgepRDjiwooc6gNB97A6yuXd/3qM88l2gD0T4oOrw86vg9RTS7C/e0g1B/+bZM6hAlFC6RMmw2Zu6CLwcyIHn4NvwXdAs49odIXHP03OM8IWhdjsQmsuMh1uxWWMngdJxNrBt60L+hJ+jKULWaq9Tw4X4kwsEXIetLTJLL0nm/0Lqtq25571MjFK8vaBsKlFmW0iY9Ht6Le+YnD7HKua9OOI7RJtbfQX6UVjIrKBXFSTN1V/wOD36P75EXyK8A9zpdXY7bQVxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="logback"
        title=""
        src="/static/2ebee08337ca247d1a68686fdb9d8846/5a190/logback.png"
        srcset="/static/2ebee08337ca247d1a68686fdb9d8846/772e8/logback.png 200w,
/static/2ebee08337ca247d1a68686fdb9d8846/e17e5/logback.png 400w,
/static/2ebee08337ca247d1a68686fdb9d8846/5a190/logback.png 800w,
/static/2ebee08337ca247d1a68686fdb9d8846/715a3/logback.png 830w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </li>
</ul>
</li>
</ul>
<h4>5.6. service 등록</h4>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">exit<span class="token punctuation">(</span>root 계정으로 변경<span class="token punctuation">)</span>
<span class="token function">vi</span> /usr/lib/systemd/system/mago3d-tomcat.service</code></pre></div>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>gis
After<span class="token operator">=</span>syslog<span class="token operator">.</span>target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Type<span class="token operator">=</span>forking
User<span class="token operator">=</span>gaia3d
Group<span class="token operator">=</span>gaia3d
ExecStart<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>gaia3d<span class="token operator">/</span>tools<span class="token operator">/</span>mago3d<span class="token operator">-</span>tomcat<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>startup<span class="token operator">.</span><span class="token keyword">sh</span>
ExecStop<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>gaia3d<span class="token operator">/</span>tools<span class="token operator">/</span>mago3d<span class="token operator">-</span>tomcat<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>shutdown<span class="token operator">.</span><span class="token keyword">sh</span>
SuccessExitStatus<span class="token operator">=</span><span class="token number">143</span>

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi<span class="token operator">-</span>user<span class="token operator">.</span>target</code></pre></div>
<ul>
<li>
<p>서비스 자동 재시작 등록 및 daemon 리로드 후 서비스 시작</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">systemctl <span class="token builtin class-name">enable</span> mago3d-tomcat <span class="token operator">&amp;&amp;</span> systemctl daemon-reload <span class="token operator">&amp;&amp;</span> systemctl start mago3d-tomcat</code></pre></div>
</li>
</ul>
<h3>6. session clustering 설정</h3>
<ul>
<li>session 에 담기는 모든 객체는 <strong>java.io.Serializable</strong> 을 상속 해야 한다. <a href="https://woowabros.github.io/experience/2017/10/17/java-serialize.html">참고</a></li>
<li>tomcat 에서 제공하는 session clustering 은 node 가 4대 이상일 경우 속도가 매우 떨어지므로 4대 이상의 노드를 연결할 경우에는 redis 와 같은 별도의 세션 관리 방법이 필요하다.</li>
<li>
<p>Manager : 세션을 어떻게 복제할지를 책임지는 객체</p>
<ul>
<li>DeltaManager : 모든 노드에 동일한 세션을 복제한다. 정보가 변경될 때 마다 복제하기 때문에 노드 개수가 많을 수록 네트워크 트래픽이 높아지고 메모리 소모가 심해진다.</li>
<li>BackupManager : Primary Node 와 Backup Node 로 분리 되어 모든 노드에 복제하지 않고 Backup Node 에만 복제한다.</li>
<li>PersistentManager : DB 나 파일 시스템을 이용하여 세션을 저장하는데, IO 문제가 생기기 때문에 실시간성이 떨어진다.</li>
</ul>
</li>
<li>
<p>Channel</p>
<ul>
<li>Membership : Cluster 안의 노드들을 동적으로 분별하는데 Multicast IP/PORT 를 통해 frequency 에 설정된 간격으로 각 노드들이 UDP packet 을 날려 상태를 확인한다.</li>
<li>Receiver : Cluster 로부터 메시지를 수신하는 역활을 하며 blocking 방식 <strong>org.apache.catalina.tribes.transport.bio.BioReceiver</strong>와 non-blocking방식인
<strong>org.apache.catalina.tribes.transport.nio.NioReceiver</strong>을 지원한다.</li>
</ul>
</li>
<li>channelSendOptions : 기본값은 8 이며, 8은 비동기 6은 동기 방식이다.</li>
<li>
<p>앞서 설정한 server.xml 에 각 서비스별로 다음의 내용을 추가한다. 각 서비스별로 Membership 의 address 와 Receiver 의 port는 달라야 한다.</p>
<div class="gatsby-highlight" data-language="xml"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Cluster</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.tcp.SimpleTcpCluster<span class="token punctuation">"</span></span> <span class="token attr-name">channelSendOptions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Manager</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.session.DeltaManager<span class="token punctuation">"</span></span> <span class="token attr-name">expireSessionsOnShutdown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">notifyListenersOnReplication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Channel</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tribes.group.GroupChannel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Membership</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tribes.membership.McastService<span class="token punctuation">"</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>228.0.0.4<span class="token punctuation">"</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>45564<span class="token punctuation">"</span></span> <span class="token attr-name">frequency</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span> <span class="token attr-name">dropTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Receiver</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tribes.transport.nio.NioReceiver<span class="token punctuation">"</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auto<span class="token punctuation">"</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4000<span class="token punctuation">"</span></span> <span class="token attr-name">autoBind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">selectorTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5000<span class="token punctuation">"</span></span> <span class="token attr-name">maxThreads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Sender</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tribes.transport.ReplicationTransmitter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Transport</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tribes.transport.nio.PooledParallelSender<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Sender</span><span class="token punctuation">></span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Interceptor</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tribes.group.interceptors.TcpFailureDetector<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Interceptor</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tribes.group.interceptors.MessageDispatchInterceptor<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Channel</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.tcp.ReplicationValve<span class="token punctuation">"</span></span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Valve</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.session.JvmRouteBinderValve<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Deployer</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.deploy.FarmWarDeployer<span class="token punctuation">"</span></span> <span class="token attr-name">tempDir</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/tmp/war-temp/<span class="token punctuation">"</span></span> <span class="token attr-name">deployDir</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/tmp/war-deploy/<span class="token punctuation">"</span></span> <span class="token attr-name">watchDir</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/tmp/war-listen/<span class="token punctuation">"</span></span> <span class="token attr-name">watchEnabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ClusterListener</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.session.ClusterSessionListener<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Cluster</span><span class="token punctuation">></span></span></code></pre></div>
</li>
<li>web.xml 설정 : <strong>&#x3C;distributable/></strong> 을 web.xml 에 추가한다. 톰캣이 아닌 어플리케이션의 web.xml 에 설정해야 한다. 별도의 web.xml 이 없다면 생성해서 저 내용을 추가해야지 정상동작한다.</li>
<li>
<p>지금까지 설정한 컨테이너를 이미지로 만들어 동일한 컨테이너를 만든다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker container commit apache-tomcat1 temp
cmd<span class="token operator">></span> docker container run --privileged --net mynetwork --ip <span class="token number">172.18</span>.0.13  -d -p <span class="token number">20080</span>:80 -p <span class="token number">28081</span>:8081 -p <span class="token number">29090</span>:9090 --name <span class="token string">"temp"</span> temp /sbin/init</code></pre></div>
</li>
<li>apache-tomcat1, temp container 의 톰캣을 재시작 한다.

  <a
    class="gatsby-resp-image-link"
    href="/static/b094ae3b3e532f976f15958c7fc04c8b/84ee5/socket-bind.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 48%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACIElEQVR42j2S608aQRTFx4iKFd8v3ssuUFgtIKBYlTfaggHESk1tIdomqKCgxk9t/cZfUJMmbdr+radnNuKHX87M2Tt37p27oplI4CIWQysaxfmTGkQi+ExNUzMku7b2TI6+9FKhkEGe+1d+Pz41mxAhRUFO0/Da6UTCbseWy4Vttxvb1AS9CL2w1Qp9fh4vZ2ae0SwWKOPjcJnNCExNwSIE0tksxFufDwek7PGgoqoGcl2l7jKxsrQED9FsNmOtLC4a6pidhW16GjYmd87NwTwygmKpBOFaWMAOA9YZEGPABj/GGTQgzEpWWYlUfWwMK6xIqndoCCqr0qj68DBMXCczGYhOt4ve/T3Or65wcX2Nzs0N2r0eLgfQv6T/pdVC4/QUjbMzNMlHvteHRgMnRK6P6nX0+32In3d3+MukBkzwh/q708E/6i8m/0q+k4fbWzwwdqDS+/aE9LrtNn48PkJ4+NibJMaWI5OTWGfLUbYeY7sRqk7PxxYl2uiogZe42aqTbdqI32QyWt5JpyGKuo6DYBBljl1SDQSwLwdFLXAwqsMBjZP2UlU5mOVleDh1Oy+2sgiJg3Mw85JKpQIRZmCeB1IM2uKHJAc0YJP7EA/q/C1WWXGQGmTFcq/JionC6a5MTOAFK9wrFiFqh4c44YPWq1W8K5dxzL1cH9dqhr7nrUf0awwu5XIo5fPYLxSwl0qhkExil7xhqxvxOHp8z/+lYkOm/BP3NwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="socket-bing"
        title=""
        src="/static/b094ae3b3e532f976f15958c7fc04c8b/5a190/socket-bind.png"
        srcset="/static/b094ae3b3e532f976f15958c7fc04c8b/772e8/socket-bind.png 200w,
/static/b094ae3b3e532f976f15958c7fc04c8b/e17e5/socket-bind.png 400w,
/static/b094ae3b3e532f976f15958c7fc04c8b/5a190/socket-bind.png 800w,
/static/b094ae3b3e532f976f15958c7fc04c8b/84ee5/socket-bind.png 1076w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </li>
<li>apache-tomcat1 에서 mago3d-CMS 시스템에 로그인 하고 temp 의 index 페이지에 접근하여 세션이 공유 되어 로그인이 된 상태인지 확인한다.</li>
<li>
<p>admin 사이트에서 로그인 한 세션이 user 사이트로 로그인 되지 않는지 확인한다. admin / user 는 각기 다른 세션을 사용해야 한다.</p>
<ul>
<li>admin / user 서비스가 같은 클러스터 채널을 사용한다면 Serializable 에러가 발생한다.</li>
</ul>
</li>
</ul>
<h3>7. apache 설정</h3>
<h4>7.1. apache 및 compile 관련 패키지 설치</h4>
<ul>
<li>
<p>apache 설정과 관련된 부분은 root 계정으로 진행한다.</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">dnf <span class="token function">install</span> -y gcc gcc-c++ httpd-devel redhat-rpm-config</code></pre></div>
</li>
<li>
<p>httpd 자동 재시작 설정</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">systemctl <span class="token builtin class-name">enable</span> httpd <span class="token operator">&amp;&amp;</span> systemctl daemon-reload</code></pre></div>
</li>
</ul>
<h4>7.2. 압축해제 및 컴파일</h4>
<ul>
<li>apache 와 was 를 연결하는 방법에는 mod<em>jk, mod</em>proxy, mod<em>proxy</em>ajp 이렇게 3가지가 있지만 여기에서는 mod_jk를 사용하도록 한다.</li>
<li>
<p>컴파일이 정상적으로 되면 /etc/httpd/modules 경로에 mod_jk.so 파일이 생성된다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /home/gaia3d/setup
<span class="token function">tar</span> -xvzf tomcat-connectors.tgz
<span class="token builtin class-name">cd</span> tomcat-connectors-1.2.48-src/native
./configure --with-apxs<span class="token operator">=</span>/usr/bin/apxs
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></code></pre></div>
</li>
</ul>
<h4>7.3. mod_jk.conf 파일 생성</h4>
<ul>
<li>
<p>mod_jk 의 로그 및 worker 파일 위치 및 기타 설정들을 설정한다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/httpd/conf.modules.d/mod_jk.conf</code></pre></div>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token operator">&lt;</span>IfModule mod_jk<span class="token operator">.</span><span class="token keyword">c</span><span class="token operator">></span>
# 워커 설정파일 위치
JkWorkersFile <span class="token keyword">conf</span><span class="token operator">/</span>workers<span class="token operator">.</span>properties
# 공유 메모리파일 위치 반드시 Selinux 보안때문에 run에 위치 필수
JkShmFile run<span class="token operator">/</span>mod_jk<span class="token operator">.</span><span class="token builtin">shm</span>
# log 위치
JkLogFile logs<span class="token operator">/</span>mod_jk<span class="token operator">.</span>log
# 로그레벨 설정
JkLogLevel info
# 로그 포맷에 사용할 시간 형식을 지정한다<span class="token operator">.</span>
JkLogStampFormat <span class="token string">"[%y %m %d %H:%M:%S]"</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>IfModule<span class="token operator">></span></code></pre></div>
</li>
</ul>
<h4>7.4. workers.properties 파일 생성</h4>
<ul>
<li>apache 에서 로드 밸런싱 해줄 톰캣에 대한 설정 정보 파일이다. <strong>port는 http port 가 아닌 ajp port 를 사용한다.</strong></li>
<li>lbfactor : 가중치에 따라 로드 밸런싱 된다.</li>
<li>
<p>sticky_session : 기존의 세션 아이디 뒤에 jvmroutid 를 붙여 어느 서버로 갈지 결정 한다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/httpd/conf/workers.properties</code></pre></div>
<div class="gatsby-highlight" data-language="properties"><pre class="language-properties"><code class="language-properties"><span class="token attr-name">worker.list</span><span class="token punctuation">=</span><span class="token attr-value">admin,user</span>

<span class="token attr-name">worker.admin.type</span><span class="token punctuation">=</span><span class="token attr-value">lb</span>
<span class="token attr-name">worker.admin.balance_workers</span><span class="token punctuation">=</span><span class="token attr-value">admin1,admin2</span>
<span class="token attr-name">worker.admin.sticky_session</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token attr-name">worker.admin1.type</span><span class="token punctuation">=</span><span class="token attr-value">ajp13</span>
<span class="token attr-name">worker.admin1.host</span><span class="token punctuation">=</span><span class="token attr-value">172.18.0.12</span>
<span class="token attr-name">worker.admin1.port</span><span class="token punctuation">=</span><span class="token attr-value">8019</span>
<span class="token attr-name">worker.admin1.lbfactor</span><span class="token punctuation">=</span><span class="token attr-value">1</span>

<span class="token attr-name">worker.admin2.type</span><span class="token punctuation">=</span><span class="token attr-value">ajp13</span>
<span class="token attr-name">worker.admin2.host</span><span class="token punctuation">=</span><span class="token attr-value">172.18.0.13</span>
<span class="token attr-name">worker.admin2.port</span><span class="token punctuation">=</span><span class="token attr-value">8019</span>
<span class="token attr-name">worker.admin2.lbfactor</span><span class="token punctuation">=</span><span class="token attr-value">1</span>

<span class="token attr-name">worker.user.type</span><span class="token punctuation">=</span><span class="token attr-value">lb</span>
<span class="token attr-name">worker.user.balance_workers</span><span class="token punctuation">=</span><span class="token attr-value">user1,user2</span>
<span class="token attr-name">worker.user.sticky_session</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token attr-name">worker.user1.type</span><span class="token punctuation">=</span><span class="token attr-value">ajp13</span>
<span class="token attr-name">worker.user1.host</span><span class="token punctuation">=</span><span class="token attr-value">172.18.0.12</span>
<span class="token attr-name">worker.user1.port</span><span class="token punctuation">=</span><span class="token attr-value">8029</span>
<span class="token attr-name">worker.user1.lbfactor</span><span class="token punctuation">=</span><span class="token attr-value">1</span>

<span class="token attr-name">worker.user2.type</span><span class="token punctuation">=</span><span class="token attr-value">ajp13</span>
<span class="token attr-name">worker.user2.host</span><span class="token punctuation">=</span><span class="token attr-value">172.18.0.13</span>
<span class="token attr-name">worker.user2.port</span><span class="token punctuation">=</span><span class="token attr-value">8029</span>
<span class="token attr-name">worker.user2.lbfactor</span><span class="token punctuation">=</span><span class="token attr-value">1</span></code></pre></div>
</li>
</ul>
<h4>7.5. httpd.conf 설정</h4>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/httpd/conf/httpd.conf</code></pre></div>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim">Listen <span class="token number">9090</span>

LoadModule jk_module modules<span class="token operator">/</span>mod_jk<span class="token operator">.</span><span class="token keyword">so</span>
<span class="token operator">&lt;</span>VirtualHost <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token operator">></span>
ServerName mago3d<span class="token operator">-</span>user
JkMount <span class="token operator">/</span><span class="token operator">*</span> user
JkUnMount  <span class="token operator">/</span>images<span class="token operator">/</span><span class="token operator">*</span> user
JkUnMount  <span class="token operator">/</span><span class="token builtin">js</span><span class="token operator">/</span><span class="token operator">*</span> user
JkUnMount  <span class="token operator">/</span>css<span class="token operator">/</span><span class="token operator">*</span> user
jkUnMount  <span class="token operator">/</span>externlib<span class="token operator">/</span><span class="token operator">*</span> user
jkUnMount  <span class="token operator">/</span>sample<span class="token operator">/</span><span class="token operator">*</span> user
DocumentRoot <span class="token string">"/var/www/mago3d-user"</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>VirtualHost<span class="token operator">></span>

<span class="token operator">&lt;</span>VirtualHost <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">9090</span><span class="token operator">></span>
ServerName mago3d<span class="token operator">-</span>admin
JkMount <span class="token operator">/</span><span class="token operator">*</span> admin
JkUnMount  <span class="token operator">/</span>images<span class="token operator">/</span><span class="token operator">*</span> admin
JkUnMount  <span class="token operator">/</span><span class="token builtin">js</span><span class="token operator">/</span><span class="token operator">*</span> admin
JkUnMount  <span class="token operator">/</span>css<span class="token operator">/</span><span class="token operator">*</span> admin
jkUnMount  <span class="token operator">/</span>externlib<span class="token operator">/</span><span class="token operator">*</span> admin
jkUnMount  <span class="token operator">/</span>sample<span class="token operator">/</span><span class="token operator">*</span> admin
DocumentRoot <span class="token string">"/var/www/mago3d-admin"</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>VirtualHost<span class="token operator">></span></code></pre></div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/a5c1ca1c3f7d713318589a7732824eff/89aeb/httpd-conf.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 323px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 215%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAYAAAB4pah1AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFh0lEQVR42pWXWU9jRxCFLzvGGANmMWDMZpvFGDBmyYBYhRADE0JAQiN2XjJSpEiRJlImeYqUnxDl91bO13YRD5mFPJR6ud2nTi1d3Tf6e3XVrufn7YdSya5nZ+3HwUE7Vb9UqVhledmWXyAVrZ2bm7OLiwuL/hTgViplh/399np01N60t1umsdGilhZrbmqyFrWtra1BmjRuqs3VS1tbm0VRZIuLixa9u7mxXE+PLQgstGNjlslkLJvN2qjm0um0TU5O2tDQkI2Pj9vIyIj1aF08HrfOzs4gXV1d1igSqyIXvb2+tjZ9HBgetpTM7RXTvr6+IIMap8S+X3MI4Mx3d3cHUL65oGB9fd2i29vboHVmZsbyuZzl83mbmJgI7fT0dJiflW/HxDyn75hVLBaDFaybl/+Zx5qTkxOLbmQyH5l0kzBxamrKCoVCAGLeBQWsZZ51gKJ4YGDAjo+PLbq7u7NhmeuMaEuKMmDMowxhA8qY6+3tDT5mTJ8Ws4PJV1dXFovFwgZ8w4JEIhEc3a6IE0Gkvs96n+vo6Aj+I8qkT3StoGAKA8wAlACgwINAhAkQY8SDhWKPMum0srJSBUQDprDYwXzswP4NBR5ZANnraRMAHx8fw2Yih19g6VFm7IIVgGBBMpl8MhUB+Anw/v7+ycmwYBNOZgwjlCGYSXCcNaY6GAqam5v/NZkkhQG5RAsYacMY/8EaJZ57Lqxxl6B8Z2enmodoYDOTMKGFNX0PChvdd8zBmj4Rh2lDQ0M1ypwUFsAArWx2VjBAO8zok8huOushwTyJzp6Dg4OqyWgHjFNAGQKMoJDcCPOAIXz3E0TfTxAW7e/vVwGhjQZPCT7iV29xAdHlu7sDYeyRxmRqY/Tw8BAWORMAUEBauNSPn3/7T2Kfn59/lCqulUWIH0OvfZ+SjwAvLy+DOfgRdgB7/qGAAHhB8Igiz1k+RZm0QUP9EXNwP7P155cWcHzuaYZgydbWVjVtYELpIoocQaLGmOJJWjDGx3xnjujSp/AyT4tlZ2dnVYb4zQsq6eJ9zPW66DmHctZ4QWZMH/aHh4dVQOhiBqZiBub4qWDOTwzia+orE+vx5cbGhgCVhyn5a1LaxjBdjLJiRjuhuXDPwEbfijI1J5aZ2jXh5x+GMD09PVWUdQV0YrJ8N0CpEtAIAPhFbU4+m1C/W4ySYkrbVTvXzhq2RH5vb8+in4Wap3zL7CXRXtKHRVpJWf0FlXn6JbVFXeolXfizKv9xkryWNn5SyuWyRX/IjA2ZcCDZkB+RHWncFotNsdiTf7bFbFdzu2q/EaM7VadhgcQ+ldjvX72yFCmic1jQndsvs2kxPSmQhIDjAulUAHBNkxRuCSAjZu0APr8CflNkhuXoWaXCuCoIwSBAabEZknRwOjCLEyFplWzz/hHQZwFnxG6udll7GfO0IBf9zCYkrZJtKfkiYGFpycoy04unl3fE744XA/4qH+YWFmxeqUEK+H1CCzAJD9sQTQG1COCLgB8EOKWnR0UsYUcl5kHkx4tzy3x4gUlhTBEGcPRzgO/1phsSo7m68u+V2e8XAENfTL8K+IsAUzo+izyDJRwljhV9QOurNJH+qsm/b25aVuyKEnxG+fJyhB8pvv8rKEQ5L59Ny2cwAhRAL7QUAH8CvzxtdAaXFZT6tKHALij6gHmZfxHgh1ralGQqDGHkL1QiTTDwK5s6dEK+7kMYKgCrYpilzgmoLAXTAi1ISPi8gpTm4pILksrLXaIssJgqlD+WKA7hL+CntTVLcG/Ib+OwFMOYNsd50UpBl8p/j9yQENNetY1KqTUxTfPfwotWLVnAC3ZJpKK/xOBbbboR0FtF1eV7+fM7AZ/Ih/Rfi8Wu6uGOQN7JpxXeOnKJv81xy9HRkf0DyZN8rollr0YAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="httpd-conf"
        title=""
        src="/static/a5c1ca1c3f7d713318589a7732824eff/89aeb/httpd-conf.png"
        srcset="/static/a5c1ca1c3f7d713318589a7732824eff/772e8/httpd-conf.png 200w,
/static/a5c1ca1c3f7d713318589a7732824eff/89aeb/httpd-conf.png 323w"
        sizes="(max-width: 323px) 100vw, 323px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h4>7.6. static resource 복사</h4>
<ul>
<li>
<p>static 파일들을 apache 에서 처리하도록 httpd.conf 파일에 설정한 폴더를 생성하고 파일들을 복사해준다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> /var/www/mago3d-user <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> /var/www/mago3d-admin
<span class="token function">cp</span> -R /home/gaia3d/tools/mago3d-tomcat/source/mago3d-admin/WEB-INF/classes/static/* /var/www/mago3d-admin/
<span class="token function">cp</span> -R /home/gaia3d/tools/mago3d-tomcat/source/mago3d-user/WEB-INF/classes/static/* /var/www/mago3d-user/</code></pre></div>
</li>
</ul>
<h4>7.7. tomcat ajp 포트 설정</h4>
<ul>
<li>session clustering 테스르를 위해 http port 로 실행한 톰캣의 port 를 ajp port 로 변경 한다.(기존의 http port 를 주석 하고 ajp port 를 주석 해제 한다.)</li>
<li>
<p><strong>tomcat 버전에 따라 secretRequired 값을 설정 하지 않으면 톰캣이 시작 되지 않을 수 있다.</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">su</span> gaia3d
<span class="token function">vi</span> /home/gaia3d/tools/mago3d-tomcat/conf/server.xml</code></pre></div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/944c1ad21682af40739b1e1d8eebd5bf/1cfc2/ajp-port.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 37.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZ0lEQVR42o2SS0tCURSFj3RFvaI3sZep1zDLCB+BBmaDQEXNgf0Fh00qewyahIraQ3TUwL/ha+zcUpr1d1b7nE5gEdGFj7X3OuseuHtfFovFcJhM4iCRwH48jkg4jHAoJPSLaCTyJ3vRKHaCQZwUi2CK2Qyb0wmL3Q476ZrXi1WPBy5dF6pqGhYoo1gsv0NnRlUFMxiwSxczB2PwE+uETmyZTNimUJDCAaMRHvI4Xgmv3TLvlh5/b4k48vvBJsMh3gYDvPT7eJUq6PUE3JtRZip1NhoJjzOVPfcnlH0fj8HuWy08dTqCh3Yb1UYDlXodFam8rzabn/B6vpdejfSuVsNztwtGj/j+b/qz/ie6zwemKgpWbDY4aGbLtJhNWkSAQ8vZcLngtFqh0Uz5OddFiUazFjX5DlqKmS6M09/BTtNp3ObzuMhmcX18jMtcTnBF3nkmg7L0OeW5DK955qZQEN5ZKoXHUgkfi6AUsuvnlrAAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="ajp"
        title=""
        src="/static/944c1ad21682af40739b1e1d8eebd5bf/5a190/ajp-port.png"
        srcset="/static/944c1ad21682af40739b1e1d8eebd5bf/772e8/ajp-port.png 200w,
/static/944c1ad21682af40739b1e1d8eebd5bf/e17e5/ajp-port.png 400w,
/static/944c1ad21682af40739b1e1d8eebd5bf/5a190/ajp-port.png 800w,
/static/944c1ad21682af40739b1e1d8eebd5bf/1cfc2/ajp-port.png 900w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
</li>
<li>
<p>설정 변경 후 톰캣 - apache 순으로 재시작한다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart mago3d-tomcat
<span class="token function">sudo</span> systemctl restart httpd</code></pre></div>
</li>
</ul>
<h4>7.8. container 생성</h4>
<ul>
<li>
<p>테스트를 위해 생성한 temp container 를 삭제하고 지금까지 설정한 내용을 기반으로 container 를 생성한다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">cmd<span class="token operator">></span> docker container stop temp
cmd<span class="token operator">></span> docker container <span class="token function">rm</span> temp
cmd<span class="token operator">></span> docker container commit apache-tomcat1 apache-tomcat2
cmd<span class="token operator">></span> docker container run --privileged --net mynetwork --ip <span class="token number">172.18</span>.0.13  -d -p <span class="token number">20080</span>:80 -p <span class="token number">28081</span>:8081 -p <span class="token number">29090</span>:9090 --name <span class="token string">"apache-tomcat2"</span> apache-tomcat2 /sbin/init</code></pre></div>
</li>
<li>생성한 container 에서 tomcat 의 jvmRoute 값을 각각 admin2, user2 로 변경한다.</li>
</ul>
<h4>7.9. 테스트</h4>
<ul>
<li>apache-tomcat1 의 port 로 사용자 또는 관리자 사이트에 접속해서 개발자 도구의 네트워크 탭에서 세션을 확인 한다.</li>
<li>apache-tomcat1 container 를 stop 했을 때 기존의 세션값이 그대로 넘어 가고 jvmroutid 가 변경 됐는지 확인 한다.

  <a
    class="gatsby-resp-image-link"
    href="/static/391243e41c5fa9e1f5d2efff81735123/ec3e2/session-test.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABXElEQVR42mWRSW7DMAxFff+rdNkzdFkgzZws4iGxLSW25FkeYv+SChy4qAACkvj1Pkk59/sdHFmWIQxD3MIb5jsOpRSGvsOPW+DjS+DzW+PsCdIGkJR/PB5vnTEGDh+CILAJrTXCOERRFOj7HuM4Yl5lrpCIAIUSqMoCoYiQ5dk/nSOlhO/71oGBDK7rGm3bYhgGTNNkhanScD0fUpIxdSOFRFmWf3QcDgMY2jSNhUZRZMFc/izixSOZjRkUx7HdV1X1rtAC+TBf5PQoTdPXI267695ANmEgF8AjsSNa6pjBQCyW4laSBBmJGmqlo1ZaCrZjE/40huVUIes07SvqrKU5Gorh+YSzbEtTu9H5DH29ohQCPVU15jkmqsCQgf0sMiiputvhgMTzUJFuIB0lMRH8BWQaCZvTCfl6jXq/hzke0VAY2o9ktFzd5YJitUK92dh8s9vBbLd4ui5+AaCdYnwmo47JAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="session-test"
        title=""
        src="/static/391243e41c5fa9e1f5d2efff81735123/5a190/session-test.png"
        srcset="/static/391243e41c5fa9e1f5d2efff81735123/772e8/session-test.png 200w,
/static/391243e41c5fa9e1f5d2efff81735123/e17e5/session-test.png 400w,
/static/391243e41c5fa9e1f5d2efff81735123/5a190/session-test.png 800w,
/static/391243e41c5fa9e1f5d2efff81735123/ec3e2/session-test.png 997w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </li>
</ul>
<h3>8. haproxy 설정</h3>
<ul>
<li>
<p>haproxy container 연결</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">cmd<span class="token operator">></span> docker <span class="token builtin class-name">exec</span> -it haproxy <span class="token function">bash</span></code></pre></div>
</li>
<li>
<p>haproxy.cfg 파일에서 frontend, backend 부분 수정</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">vi</span> /etc/haproxy/haproxy.cfg</code></pre></div>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim">#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
# main frontend which proxys <span class="token keyword">to</span> the backends
#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
frontend mago3d<span class="token operator">-</span>user<span class="token operator">-</span>front
  bind <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">80</span>
  stats uri <span class="token operator">/</span>haproxy<span class="token operator">?</span>stats

  default_backend    mago3d<span class="token operator">-</span>user

#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
# round robin balancing between the various backends
#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
backend mago3d<span class="token operator">-</span>user
  balance     roundrobin
  server  user<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>host   <span class="token number">172.18</span><span class="token operator">.</span><span class="token number">0.12</span><span class="token punctuation">:</span><span class="token number">80</span>  check fall <span class="token number">3</span> rise <span class="token number">2</span>
  server  user<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span>host   <span class="token number">172.18</span><span class="token operator">.</span><span class="token number">0.13</span><span class="token punctuation">:</span><span class="token number">80</span>  check fall <span class="token number">3</span> rise <span class="token number">2</span>



#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
# main frontend which proxys <span class="token keyword">to</span> the backends
#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
frontend mago3d<span class="token operator">-</span>admin<span class="token operator">-</span>front
  bind <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">9090</span>
  stats uri <span class="token operator">/</span>haproxy<span class="token operator">?</span>stats

  default_backend    mago3d<span class="token operator">-</span>admin

#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
# round robin balancing between the various backends
#<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
backend mago3d<span class="token operator">-</span>admin
  balance     roundrobin
  server  admin<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>host   <span class="token number">172.18</span><span class="token operator">.</span><span class="token number">0.12</span><span class="token punctuation">:</span><span class="token number">9090</span>  check fall <span class="token number">3</span> rise <span class="token number">2</span>
  server  admin<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span>host   <span class="token number">172.18</span><span class="token operator">.</span><span class="token number">0.13</span><span class="token punctuation">:</span><span class="token number">9090</span>  check fall <span class="token number">3</span> rise <span class="token number">2</span></code></pre></div>
</li>
<li>
<p>파일 유효성 확인 후 재시작</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">haproxy -f haproxy.cfg -c
systemctl restart haproxy</code></pre></div>
</li>
<li>haproxy container 의 바인딩 포트인 80 / 9090 으로 확인 한다.</li>
</ul></div><footer><div class="author"><div class="avatar"><img src="https://avatars.githubusercontent.com/u/6446144?v=4" alt="삽질저장소"/></div><div class="note"><p>🔘 안되면 될 때 까지! 🏃 🔘</p></div></div><div class="links"><a href="/geoserver-clustering/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg><h4>Geoserver Clustering<!-- --> <time>2020-06-13<!-- --> </time></h4></a><a href="/docker-haproxy/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg><h4>docker 에 haproxy 설치<!-- --> <time>2020-06-06</time></h4></a></div><div></div></footer></article></main><footer class="footer"><ul>
<li>Thank You for Visiting My Blog, Have a Good Day 😆 <br />© 2021 Developer <a href="https://github.com/">shPark</a>, Powered By Gatsby.</li>
</ul></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/load-balancing-session-clustering/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-16797aeb1857e4bdc070.js"],"app":["/app-cc3235dd701427d7b59f.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-36dc033f967ae9fe9cda.js"],"component---src-pages-404-js":["/component---src-pages-404-js-29ccc9f03a886ed7280f.js"],"component---src-pages-category-js":["/component---src-pages-category-js-59a162261b03ed3f2568.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a4b26d4da667b7e0d371.js"],"component---src-pages-search-js":["/component---src-pages-search-js-d6c22e90e502c95f5fcc.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-c1d37a996bae6e29cb78.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-67b3bc047f385a030f3d.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-dd92b58e687c0d5ee5f5.js"]};/*]]>*/</script><script src="/polyfill-16797aeb1857e4bdc070.js" nomodule=""></script><script src="/component---src-templates-post-template-js-dd92b58e687c0d5ee5f5.js" async=""></script><script src="/3df72598ed628fa3b584613cd093848b9c087970-7e8ab1b1cd93282549c1.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-cc3235dd701427d7b59f.js" async=""></script><script src="/1bfc9850-d06e3c25ea137ea82c47.js" async=""></script><script src="/framework-acd7498685eeb36e39da.js" async=""></script><script src="/webpack-runtime-df3d685180072ab29eaf.js" async=""></script></body></html>