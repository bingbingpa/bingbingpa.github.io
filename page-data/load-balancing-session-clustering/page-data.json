{"componentChunkName":"component---src-templates-post-template-js","path":"/load-balancing-session-clustering/","result":{"data":{"post":{"id":"68581b87-47db-505f-ae3a-8f4e4f8c9ddb","html":"<h3>1. 테스트 환경 및 버전</h3>\n<ul>\n<li>모든 테스트는 docker 에서 진행</li>\n<li>centos : CentOS Linux release 8.1.1911(centos 버전 확인은 cat /etc/centos-release)</li>\n<li>haproxy : 2.1.5</li>\n<li>apache : 2.4</li>\n<li>tomcat-conectors(mod_jk) : 1.2.48</li>\n<li>tomcat : 9.0.35</li>\n<li>db container : gaia3d/mago3d-postgresql(postgresql-12.3) docker image</li>\n<li>application : mago3d-CMS(<a href=\"https://github.com/Gaia3D/mago3d-CMS/tree/mago3d\">mago3d 브런치</a>)</li>\n</ul>\n<h3>2. 네트워크 구성도</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43f8cfc9a205020436a31a468b586e7b/e05eb/network.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 584px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 69.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACSElEQVR42o2T3W7TQBCF8768ARdcccM7IITgissKgYQEqFRqVVQ1tE1Kk5YkTuz4J7bj2E6d2N31x9hJ04YWxEjjXe+eObt7ZqbBH1aW5WbspprWTNOfK0bXqh6rtUKXW9j71vgX4cu+4kmzpD2HuYbzBD44ivTmPwkrQIVZjSWjTMjCjO+/LFpjn46fyJrmRtegLeyG8Hbhsc3K9DJjNOjjmCPiMNjeE6zexK+8sSJi/VkDtSZNU1zPw3Zc4iQlms3wJhP5d4jjmJui4DGTJ9ds9TfJFjhC4rkOYRCwWCwe6FvkOdPpFEsOGlhjhn5EVJSi6ypZjYNA8dbQHM9K+mFC056xF+g6CXe6llty5OLvLM2bfkHbDglyTTspOY4UjU+u4kVHcxCWZAI0Bf1loghzfaeTSFD7mnAut3ktl3hlgJxNuFSchDlHUyG8lgUvzTg87/K12WK/1SHICtRG3IemhDyR0jm57LGzu8+30wvOBiZSAPfKRhVMTIMkmBC6Nq5tMxwO6Xa7mKaJZVn1vNfr4che5DnkaUzieyyT6FZlGtXT7IXCk6TttS85Hbm0TY+x6xGJ+NMowvf92iOZx5LtsSSkaTi0pTYPLnp1jCPxrvA0dmzF01bJXgizZcGVtNZHryQsHn9uZZVMz0X3Zz/BSAumgj2SS+6K9o2zWPPeyjm0U4xkSdufcxQU6/baLtxVUkoWSrMfaj6bczrTjKso44eXcimXWWuo8WwLQzrCtkYSo/7aq+W9ZBXzBHNoMBwMCKR2K/sNk78xKEZZqxQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"network\"\n        title=\"\"\n        src=\"/static/43f8cfc9a205020436a31a468b586e7b/e05eb/network.png\"\n        srcset=\"/static/43f8cfc9a205020436a31a468b586e7b/772e8/network.png 200w,\n/static/43f8cfc9a205020436a31a468b586e7b/e17e5/network.png 400w,\n/static/43f8cfc9a205020436a31a468b586e7b/e05eb/network.png 584w\"\n        sizes=\"(max-width: 584px) 100vw, 584px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>\n<p>설정 순서</p>\n<ul>\n<li>사용자 설정</li>\n<li>tomcat 서비스 설정</li>\n<li>session clustering</li>\n<li>apache 설치 및 mod_jk 컴파일 및 설정</li>\n<li>haproxy</li>\n</ul>\n</li>\n</ul>\n<h3>3. container 설정</h3>\n<ul>\n<li>테스트에는 db, haproxy, apache-tomcat 2 개 총 4개의 컨테이너가 필요하고 apache-tomcat은 하나의 설정이 완료 된 후 이를 복사하여 사용한다.</li>\n</ul>\n<h4>3.1. 네트워크 설정</h4>\n<ul>\n<li>\n<p>테스트 시 모든 사람들이 동일한 ip를 사용하도록 네트워크를 만들어서 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker network create --subnet<span class=\"token operator\">=</span><span class=\"token number\">172.18</span>.0.0/16 mynetwork</code></pre></div>\n</li>\n</ul>\n<h4>3.2. database</h4>\n<ul>\n<li>\n<p>database 는 gaia3d 의 mago3d-postgresql 이미지를 사용하도록 한다. (컨테이너끼리만 접근하므로 별도의 host port는 바인딩하지 않는다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker container run --privileged --net mynetwork --ip <span class=\"token number\">172.18</span>.0.10  -d --name <span class=\"token string\">\"container-db\"</span> gaia3d/mago3d-postgresql /sbin/init</code></pre></div>\n</li>\n</ul>\n<h4>3.3. haproxy</h4>\n<ul>\n<li>\n<p>로드 밸런스 테스트를 위한 haproxy container</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker container run --privileged --net mynetwork --ip <span class=\"token number\">172.18</span>.0.11  -d -p <span class=\"token number\">80</span>:80 -p <span class=\"token number\">9090</span>:9090 --name <span class=\"token string\">\"haproxy\"</span> gaia3d/haproxy /sbin/init</code></pre></div>\n</li>\n</ul>\n<h4>3.4. apache-tomcat</h4>\n<ul>\n<li>\n<p>mago3d-CMS 저장소의 doc-docker 폴더경로에서 다음을 실행해서 container 를 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker build apache-tomcat -t apache-tomcat\ncmd<span class=\"token operator\">></span> docker container run --privileged --net mynetwork --ip <span class=\"token number\">172.18</span>.0.12  -d -p <span class=\"token number\">10080</span>:80 -p <span class=\"token number\">18081</span>:8081 -p <span class=\"token number\">19090</span>:9090 --name <span class=\"token string\">\"apache-tomcat1\"</span> apache-tomcat /sbin/init</code></pre></div>\n</li>\n</ul>\n<h3>4. 유저 생성 및 sudo 권한 설정</h3>\n<ul>\n<li>\n<p>tomcat 과 관련된 다음의 모든 과정은 생성한 apache-tomcat1 컨테이너에 연결해서 수행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker <span class=\"token builtin class-name\">exec</span> -it apache-tomcat1 <span class=\"token function\">bash</span></code></pre></div>\n</li>\n<li>\n<p>root 계정외의 별도의 계정을 생성하고 서비스 실행을 위한 권한만 부여한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">adduser -m gaia3d</code></pre></div>\n</li>\n<li>\n<p>유저 생성 후 <strong>passwd</strong> 명령으로 패스워드를 설정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">passwd</span> gaia3d</code></pre></div>\n</li>\n<li>\n<p>생성한 계정에 필요한 명령만 권한을 준다. <strong>/etc/sudoers</strong> 를 직접 수정할 수도 있지만. visudo를 사용 할 경우 파일 수정 시 오타나 문법 오류 등을 검사해 주므로 visudo를 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> visudo\ngaia3d  <span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span>NOPASSWD:   /bin/systemctl</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f2560a94fb692435e6e6740aacf57f5e/6c115/visudo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 353px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 14.500000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAjUlEQVR42j2PywqFMAxEXfdhrXWlIn2AbVFE8P+/bS5T6F0ckklCJhlijNj3HVJKbNsG6pQScs5Y1xXWWozjiGVZcJ4nnHNNG2OgtW6xQz3UWnFdV1tGSil4ngff9+G+b7zvi2maoJQCZ733OI4DIYRmysi+EKLNDBSkOzDnBd29L+MHrBNeTeZ5/vc7P4XyS9lPIzF4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"visudo\"\n        title=\"\"\n        src=\"/static/f2560a94fb692435e6e6740aacf57f5e/6c115/visudo.png\"\n        srcset=\"/static/f2560a94fb692435e6e6740aacf57f5e/772e8/visudo.png 200w,\n/static/f2560a94fb692435e6e6740aacf57f5e/6c115/visudo.png 353w\"\n        sizes=\"(max-width: 353px) 100vw, 353px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</li>\n</ul>\n<h3>5. tomcat 설정</h3>\n<ul>\n<li>\n<p>container 에는 dockerfile 을 통해 미리 다운 받은 jdk와 tomcat이 있다. 이를 /home/생성한 유저폴더 경로로 옮겨주고 권한은 해당 유저의 권한으로 변경해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">mv</span> /setup /home/gaia3d/\n<span class=\"token function\">chown</span> -R gaia3d:gaia3d /home/gaia3d/setup</code></pre></div>\n</li>\n<li>\n<p>이후 작업은 생성한 사용자로 진행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">su</span> gaia3d</code></pre></div>\n</li>\n</ul>\n<h4>5.1. 압축 해제 / 경로 설정</h4>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> /home/gaia3d/setup\n<span class=\"token function\">tar</span> -xvzf jdk-11.tgz\n<span class=\"token function\">tar</span> -xvzf tomcat.tgz\n<span class=\"token function\">mkdir</span> <span class=\"token punctuation\">..</span>/tools <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mv</span> apache-tomcat-9.0.36 mago3d-tomcat <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mv</span> mago3d-tomcat <span class=\"token punctuation\">..</span>/tools <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mv</span> jdk-11.0.2 <span class=\"token punctuation\">..</span>/tools\n<span class=\"token function\">rm</span> -rf /home/gaia3d/tools/mago3d-tomcat/webapps/*</code></pre></div>\n<h4>5.2. 자바 경로 및 메모리 설정</h4>\n<ul>\n<li>linux 의 경우에는 setenv.sh 파일을 만들어 작성하고, windows 의 경우에는 setenv.bat 파일을 만들어 작성한다.</li>\n<li>\n<p><strong>windows 의 경우 서비스로 등록시 setenv.bat 파일을 읽지 않기 때문에 service.bat 에 설정하거나 환경 변수로 등록해야 한다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> /home/gaia3d/tools/mago3d-tomcat/bin\n<span class=\"token function\">vi</span> setenv.sh</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\">export JAVA_HOME<span class=\"token operator\">=</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>gaia3d<span class=\"token operator\">/</span>tools<span class=\"token operator\">/</span>jdk<span class=\"token operator\">-</span><span class=\"token number\">11.0</span><span class=\"token operator\">.</span><span class=\"token number\">2</span>\nexport JAVA_OPTS<span class=\"token operator\">=</span><span class=\"token operator\">-</span>D<span class=\"token operator\">-</span>Xms4096m<span class=\"token operator\">-</span>Xmx4096m</code></pre></div>\n</li>\n<li>\n<p>tomcat cache 설정</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vi</span> /home/gaia3d/tools/mago3d-tomcat/conf/context.xml</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Resources</span> <span class=\"token attr-name\">cachingAllowed</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cacheMaxSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100000<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></code></pre></div>\n</li>\n</ul>\n<h4>5.3. application 경로 설정</h4>\n<ul>\n<li>\n<p>server.xml 설정 : service 엘리먼트를 다음과 같이 수정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vi</span> /home/gaia3d/tools/mago3d-tomcat/conf/server.xml</code></pre></div>\n</li>\n<li><strong>배치되는 application 의 경로는 docBase로 절대 경로를 잡아준다.</strong> webapp 밑에 배치하지 않는 이유는\napllication 에서 로그 파일을 쓸 경우 webapp 밑에 있는 경우 충돌이나 에러가 발생하는 경우가 있어 별도의 폴더에 배치하여 사용한다.</li>\n<li>\n<p><strong>application의 의도치 않은 재시작 및 덮어쓰기를 방지하기 위해 unpackWARs, autoDeploy, reloadable 옵션은 false 로 변경한다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Service</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Catalina<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Connector</span> <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>9090<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">protocol</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>HTTP/1.1<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">connectionTimeout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20000<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">redirectPort</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8446<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token comment\">&lt;!--&lt;Connector port=\"8019\" protocol=\"AJP/1.3\" redirectPort=\"8446\" address=\"0.0.0.0\" secretRequired=\"false\"/>--></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Engine</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Catalina<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">defaultHost</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>localhost<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">jvmRoute</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>admin1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Realm</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.realm.LockOutRealm<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Realm</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.realm.UserDatabaseRealm<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">resourceName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UserDatabase<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Realm</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Host</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>localhost<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">appBase</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>webapps<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">unpackWARs</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">autoDeploy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Valve</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.valves.AccessLogValve<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">directory</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>logs<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">prefix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>localhost_access_log<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">suffix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>.txt<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">pattern</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>%h %l %u %t <span class=\"token entity named-entity\" title=\"&quot;\">&amp;quot;</span>%r<span class=\"token entity named-entity\" title=\"&quot;\">&amp;quot;</span> %s %b<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Context</span> <span class=\"token attr-name\">docBase</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/home/gaia3d/tools/mago3d-tomcat/source/mago3d-admin<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">reloadable</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Host</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Engine</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Service</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Service</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Catalina2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Connector</span> <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8081<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">protocol</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>HTTP/1.1<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">connectionTimeout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20000<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">redirectPort</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8447<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token comment\">&lt;!--&lt;Connector port=\"8029\" protocol=\"AJP/1.3\" redirectPort=\"8447\" address=\"0.0.0.0\" secretRequired=\"false\"/>--></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Engine</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Catalina2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">defaultHost</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>localhost<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">jvmRoute</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Realm</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.realm.LockOutRealm<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Realm</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.realm.UserDatabaseRealm<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">resourceName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UserDatabase<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Realm</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Host</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>localhost<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">appBase</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>webapps<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">unpackWARs</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">autoDeploy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Valve</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.valves.AccessLogValve<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">directory</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>logs<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">prefix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>localhost_access_log2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">suffix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>.txt<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">pattern</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>%h %l %u %t <span class=\"token entity named-entity\" title=\"&quot;\">&amp;quot;</span>%r<span class=\"token entity named-entity\" title=\"&quot;\">&amp;quot;</span> %s %b<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Context</span> <span class=\"token attr-name\">docBase</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/home/gaia3d/tools/mago3d-tomcat/source/mago3d-user<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">reloadable</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Host</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Engine</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Service</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n</ul>\n<h4>5.4. application 배치</h4>\n<ul>\n<li>\n<p><strong>resources/develop/application.properties 수정</strong></p>\n<ul>\n<li>mago3d-CMS jdbc url 은 localhost 로 되어 있으므로 생성한 container-db 의 ip로 변경해준다.</li>\n</ul>\n</li>\n<li>\n<p>프로젝트 빌드</p>\n<ul>\n<li>profile 을 develop 으로 해서 빌드한다.</li>\n<li>\n<p><strong>springBoot 2.3.0 버전부터는 gradle-6.2.2 보다 상위 버전의 gradle 로 변경후 빌드해야 한다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> gradle clean -xtest\ncmd<span class=\"token operator\">></span> gradle build -xtest -Pprofile<span class=\"token operator\">=</span>develop</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>mago3d-CMS 프로젝트를 빌드 후 war 파일을 컨테이너로 복사한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker container <span class=\"token function\">cp</span> d:<span class=\"token punctuation\">\\</span>mago3d-user-0.0.1-SNAPSHOT.war apache-tomcat1:/home/gaia3d/setup\ncmd<span class=\"token operator\">></span> docker container <span class=\"token function\">cp</span> d:<span class=\"token punctuation\">\\</span>mago3d-admin-0.0.1-SNAPSHOT.war apache-tomcat1:/home/gaia3d/setup</code></pre></div>\n</li>\n<li>\n<p>복사한 파일 권한 설정 및 이동</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">chown</span> gaia3d:gaia3d /home/gaia3d/setup/*.war\n<span class=\"token function\">su</span> gaia3d\n<span class=\"token builtin class-name\">cd</span> /home/gaia3d/tools/mago3d-tomcat/ <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mkdir</span> -p source/mago3d-admin <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mkdir</span> -p source/mago3d-user\n<span class=\"token builtin class-name\">cd</span> /home/gaia3d/setup/\n<span class=\"token function\">unzip</span> mago3d-admin-0.0.1-SNAPSHOT.war -d <span class=\"token punctuation\">..</span>/tools/mago3d-tomcat/source/mago3d-admin/\n<span class=\"token function\">unzip</span> mago3d-user-0.0.1-SNAPSHOT.war -d <span class=\"token punctuation\">..</span>/tools/mago3d-tomcat/source/mago3d-user/</code></pre></div>\n</li>\n</ul>\n<h4>5.5. log 설정</h4>\n<ul>\n<li>톰캣에서 서비스되는 어플리케이션의 비즈니스 로그는 기본적으로 톰캣의 logs/catalina.out 파일에 기록되는데 로그 설정을 따로 하지 않으면\n계속 이 파일에 로그가 기록되어 파일 사이즈가 계속 커지게 된다. 따라서 별도의 설정이 필요한데 /etc/rogrotate.conf 에 로그 설정을 하는 방법이 있고\nlogback이나 log4j를 사용하는 방법이 있는데 여기서는 현재 프로젝트에 사용하고 있는 logback을 사용해서 로그 설정을 한다.</li>\n<li>\n<p>먼저 기존에 기록되던 catalina.out 파일에 더이상 로그를 쓰지 않도록 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vi</span> /home/gaia3d/tools/mago3d-tomcat/bin/catalina.sh</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">CATALINA_OUT</span><span class=\"token operator\">=</span>/dev/null</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/746339260943c916a498d217759422d8/f6386/catalina.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 686px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 43.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoElEQVR42n1SaW+bQBTkcACzNudyWBjCjfEVp6hVq0b9//9q+t7WSV2pyofRnm92Zt5q4xihaXq0bYs8zzGOI7p+wDgMal6VJcqqwvF4xDRNKIoCjuPAtu0P8NowDFwuF2hNbWOzCYgsw36/VwVt1xHZRMQ9PM+DaZoQroCmaZ+CBWhdJ5AkOUpSkmcZwiBAFEXIshwyjiGlRBiGCjwvij0CuhPHkhAjpLu8ZpXz4UAKGweO8GCv17AIHhfLBCEVCJ/2hUsONuoBHi3LgnW3yXZ57QqhLHMkWts+oZY5lmnEt9MJv5YF3ymLn7cXvF1esbQTmudnHM9ncpIgkVKpS9NUqWaV75YVYVFYuLlbvGUpfiQpvgYhXrdbfCF1i+njprmwDf2jaLVaKTWP0HX9L+E8C6zse+AU/ppsrckCR7AJfIjAg05FpmlgSw/9rxn/EFblE3w/wjD0qOsa83zA6XSmjg20N+J6vaLrevWl+v7PyMRsNyFHj4/cM3QobJ++TKG+TJomqCizjCKQlNlut6OzUuG9y5wbW+WGcASPCn8Di9/cDqceeeIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"catalina\"\n        title=\"\"\n        src=\"/static/746339260943c916a498d217759422d8/f6386/catalina.png\"\n        srcset=\"/static/746339260943c916a498d217759422d8/772e8/catalina.png 200w,\n/static/746339260943c916a498d217759422d8/e17e5/catalina.png 400w,\n/static/746339260943c916a498d217759422d8/f6386/catalina.png 686w\"\n        sizes=\"(max-width: 686px) 100vw, 686px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</li>\n<li>\n<p>logback 설정 확인</p>\n<ul>\n<li>build 시 설정한 profile 대로 로그 파일이 파일로 생성 되도록 설정 되어 있는지 확인 한다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2ebee08337ca247d1a68686fdb9d8846/715a3/logback.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB6klEQVR42nVUWXaDMAzMZRpqCBi84QVoev9DqSPhJJCXfsyTke2xRguX4Avd54VyLDSXTGkpVH4WsjHT4CO12tO1tdR0lr5v7oRPvkt78xSmSHNINCVGJssA+RQT9WYWdGMQggfeiZ6EV2wOOlC0IHCFggPJFEiNnm6wjN4CJki0rXakBnciZ1yrvbRTAbOlYgv9uoWWAPn5Dvl3yN4o5B+xNm0Ut1+a1zuZuNKIsxp3BpPJjJE8oIeZLhxmNwQh3JDPCZFak2hEGtTAEQXqdBDb4tx3x9GdZaoKkSyEvSfHr6A4xqEYFjmDxBvQTbvt4WP5x4JILt+kC2ELQqMRUY/c8euo6rU1Z6gKrBtGV88citRwhE0lnKeE4iCKMVXEE/opPcH7Hc7yWsOywgepRDjiwooc6gNB97A6yuXd/3qM88l2gD0T4oOrw86vg9RTS7C/e0g1B/+bZM6hAlFC6RMmw2Zu6CLwcyIHn4NvwXdAs49odIXHP03OM8IWhdjsQmsuMh1uxWWMngdJxNrBt60L+hJ+jKULWaq9Tw4X4kwsEXIetLTJLL0nm/0Lqtq25571MjFK8vaBsKlFmW0iY9Ht6Le+YnD7HKua9OOI7RJtbfQX6UVjIrKBXFSTN1V/wOD36P75EXyK8A9zpdXY7bQVxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"logback\"\n        title=\"\"\n        src=\"/static/2ebee08337ca247d1a68686fdb9d8846/5a190/logback.png\"\n        srcset=\"/static/2ebee08337ca247d1a68686fdb9d8846/772e8/logback.png 200w,\n/static/2ebee08337ca247d1a68686fdb9d8846/e17e5/logback.png 400w,\n/static/2ebee08337ca247d1a68686fdb9d8846/5a190/logback.png 800w,\n/static/2ebee08337ca247d1a68686fdb9d8846/715a3/logback.png 830w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n</li>\n</ul>\n<h4>5.6. service 등록</h4>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">exit<span class=\"token punctuation\">(</span>root 계정으로 변경<span class=\"token punctuation\">)</span>\n<span class=\"token function\">vi</span> /usr/lib/systemd/system/mago3d-tomcat.service</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\nDescription<span class=\"token operator\">=</span>gis\nAfter<span class=\"token operator\">=</span>syslog<span class=\"token operator\">.</span>target\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\nType<span class=\"token operator\">=</span>forking\nUser<span class=\"token operator\">=</span>gaia3d\nGroup<span class=\"token operator\">=</span>gaia3d\nExecStart<span class=\"token operator\">=</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>gaia3d<span class=\"token operator\">/</span>tools<span class=\"token operator\">/</span>mago3d<span class=\"token operator\">-</span>tomcat<span class=\"token operator\">/</span><span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>startup<span class=\"token operator\">.</span><span class=\"token keyword\">sh</span>\nExecStop<span class=\"token operator\">=</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>gaia3d<span class=\"token operator\">/</span>tools<span class=\"token operator\">/</span>mago3d<span class=\"token operator\">-</span>tomcat<span class=\"token operator\">/</span><span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>shutdown<span class=\"token operator\">.</span><span class=\"token keyword\">sh</span>\nSuccessExitStatus<span class=\"token operator\">=</span><span class=\"token number\">143</span>\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\nWantedBy<span class=\"token operator\">=</span>multi<span class=\"token operator\">-</span>user<span class=\"token operator\">.</span>target</code></pre></div>\n<ul>\n<li>\n<p>서비스 자동 재시작 등록 및 daemon 리로드 후 서비스 시작</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">systemctl <span class=\"token builtin class-name\">enable</span> mago3d-tomcat <span class=\"token operator\">&amp;&amp;</span> systemctl daemon-reload <span class=\"token operator\">&amp;&amp;</span> systemctl start mago3d-tomcat</code></pre></div>\n</li>\n</ul>\n<h3>6. session clustering 설정</h3>\n<ul>\n<li>session 에 담기는 모든 객체는 <strong>java.io.Serializable</strong> 을 상속 해야 한다. <a href=\"https://woowabros.github.io/experience/2017/10/17/java-serialize.html\">참고</a></li>\n<li>tomcat 에서 제공하는 session clustering 은 node 가 4대 이상일 경우 속도가 매우 떨어지므로 4대 이상의 노드를 연결할 경우에는 redis 와 같은 별도의 세션 관리 방법이 필요하다.</li>\n<li>\n<p>Manager : 세션을 어떻게 복제할지를 책임지는 객체</p>\n<ul>\n<li>DeltaManager : 모든 노드에 동일한 세션을 복제한다. 정보가 변경될 때 마다 복제하기 때문에 노드 개수가 많을 수록 네트워크 트래픽이 높아지고 메모리 소모가 심해진다.</li>\n<li>BackupManager : Primary Node 와 Backup Node 로 분리 되어 모든 노드에 복제하지 않고 Backup Node 에만 복제한다.</li>\n<li>PersistentManager : DB 나 파일 시스템을 이용하여 세션을 저장하는데, IO 문제가 생기기 때문에 실시간성이 떨어진다.</li>\n</ul>\n</li>\n<li>\n<p>Channel</p>\n<ul>\n<li>Membership : Cluster 안의 노드들을 동적으로 분별하는데 Multicast IP/PORT 를 통해 frequency 에 설정된 간격으로 각 노드들이 UDP packet 을 날려 상태를 확인한다.</li>\n<li>Receiver : Cluster 로부터 메시지를 수신하는 역활을 하며 blocking 방식 <strong>org.apache.catalina.tribes.transport.bio.BioReceiver</strong>와 non-blocking방식인\n<strong>org.apache.catalina.tribes.transport.nio.NioReceiver</strong>을 지원한다.</li>\n</ul>\n</li>\n<li>channelSendOptions : 기본값은 8 이며, 8은 비동기 6은 동기 방식이다.</li>\n<li>\n<p>앞서 설정한 server.xml 에 각 서비스별로 다음의 내용을 추가한다. 각 서비스별로 Membership 의 address 와 Receiver 의 port는 달라야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Cluster</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.ha.tcp.SimpleTcpCluster<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">channelSendOptions</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Manager</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.ha.session.DeltaManager<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">expireSessionsOnShutdown</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">notifyListenersOnReplication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Channel</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.tribes.group.GroupChannel<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Membership</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.tribes.membership.McastService<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>228.0.0.4<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>45564<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">frequency</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>500<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dropTime</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3000<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Receiver</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.tribes.transport.nio.NioReceiver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>auto<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>4000<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">autoBind</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">selectorTimeout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5000<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">maxThreads</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>6<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Sender</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.tribes.transport.ReplicationTransmitter<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Transport</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.tribes.transport.nio.PooledParallelSender<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Sender</span><span class=\"token punctuation\">></span></span>\n\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Interceptor</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.tribes.group.interceptors.TcpFailureDetector<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Interceptor</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.tribes.group.interceptors.MessageDispatchInterceptor<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Channel</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Valve</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.ha.tcp.ReplicationValve<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">filter</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Valve</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.ha.session.JvmRouteBinderValve<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Deployer</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.ha.deploy.FarmWarDeployer<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">tempDir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/tmp/war-temp/<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">deployDir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/tmp/war-deploy/<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">watchDir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/tmp/war-listen/<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">watchEnabled</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ClusterListener</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>org.apache.catalina.ha.session.ClusterSessionListener<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Cluster</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n<li>web.xml 설정 : <strong>&#x3C;distributable/></strong> 을 web.xml 에 추가한다. 톰캣이 아닌 어플리케이션의 web.xml 에 설정해야 한다. 별도의 web.xml 이 없다면 생성해서 저 내용을 추가해야지 정상동작한다.</li>\n<li>\n<p>지금까지 설정한 컨테이너를 이미지로 만들어 동일한 컨테이너를 만든다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker container commit apache-tomcat1 temp\ncmd<span class=\"token operator\">></span> docker container run --privileged --net mynetwork --ip <span class=\"token number\">172.18</span>.0.13  -d -p <span class=\"token number\">20080</span>:80 -p <span class=\"token number\">28081</span>:8081 -p <span class=\"token number\">29090</span>:9090 --name <span class=\"token string\">\"temp\"</span> temp /sbin/init</code></pre></div>\n</li>\n<li>apache-tomcat1, temp container 의 톰캣을 재시작 한다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b094ae3b3e532f976f15958c7fc04c8b/84ee5/socket-bind.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACIElEQVR42j2S608aQRTFx4iKFd8v3ssuUFgtIKBYlTfaggHESk1tIdomqKCgxk9t/cZfUJMmbdr+radnNuKHX87M2Tt37p27oplI4CIWQysaxfmTGkQi+ExNUzMku7b2TI6+9FKhkEGe+1d+Pz41mxAhRUFO0/Da6UTCbseWy4Vttxvb1AS9CL2w1Qp9fh4vZ2ae0SwWKOPjcJnNCExNwSIE0tksxFufDwek7PGgoqoGcl2l7jKxsrQED9FsNmOtLC4a6pidhW16GjYmd87NwTwygmKpBOFaWMAOA9YZEGPABj/GGTQgzEpWWYlUfWwMK6xIqndoCCqr0qj68DBMXCczGYhOt4ve/T3Or65wcX2Nzs0N2r0eLgfQv6T/pdVC4/QUjbMzNMlHvteHRgMnRK6P6nX0+32In3d3+MukBkzwh/q708E/6i8m/0q+k4fbWzwwdqDS+/aE9LrtNn48PkJ4+NibJMaWI5OTWGfLUbYeY7sRqk7PxxYl2uiogZe42aqTbdqI32QyWt5JpyGKuo6DYBBljl1SDQSwLwdFLXAwqsMBjZP2UlU5mOVleDh1Oy+2sgiJg3Mw85JKpQIRZmCeB1IM2uKHJAc0YJP7EA/q/C1WWXGQGmTFcq/JionC6a5MTOAFK9wrFiFqh4c44YPWq1W8K5dxzL1cH9dqhr7nrUf0awwu5XIo5fPYLxSwl0qhkExil7xhqxvxOHp8z/+lYkOm/BP3NwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"socket-bing\"\n        title=\"\"\n        src=\"/static/b094ae3b3e532f976f15958c7fc04c8b/5a190/socket-bind.png\"\n        srcset=\"/static/b094ae3b3e532f976f15958c7fc04c8b/772e8/socket-bind.png 200w,\n/static/b094ae3b3e532f976f15958c7fc04c8b/e17e5/socket-bind.png 400w,\n/static/b094ae3b3e532f976f15958c7fc04c8b/5a190/socket-bind.png 800w,\n/static/b094ae3b3e532f976f15958c7fc04c8b/84ee5/socket-bind.png 1076w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>apache-tomcat1 에서 mago3d-CMS 시스템에 로그인 하고 temp 의 index 페이지에 접근하여 세션이 공유 되어 로그인이 된 상태인지 확인한다.</li>\n<li>\n<p>admin 사이트에서 로그인 한 세션이 user 사이트로 로그인 되지 않는지 확인한다. admin / user 는 각기 다른 세션을 사용해야 한다.</p>\n<ul>\n<li>admin / user 서비스가 같은 클러스터 채널을 사용한다면 Serializable 에러가 발생한다.</li>\n</ul>\n</li>\n</ul>\n<h3>7. apache 설정</h3>\n<h4>7.1. apache 및 compile 관련 패키지 설치</h4>\n<ul>\n<li>\n<p>apache 설정과 관련된 부분은 root 계정으로 진행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dnf <span class=\"token function\">install</span> -y gcc gcc-c++ httpd-devel redhat-rpm-config</code></pre></div>\n</li>\n<li>\n<p>httpd 자동 재시작 설정</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">systemctl <span class=\"token builtin class-name\">enable</span> httpd <span class=\"token operator\">&amp;&amp;</span> systemctl daemon-reload</code></pre></div>\n</li>\n</ul>\n<h4>7.2. 압축해제 및 컴파일</h4>\n<ul>\n<li>apache 와 was 를 연결하는 방법에는 mod<em>jk, mod</em>proxy, mod<em>proxy</em>ajp 이렇게 3가지가 있지만 여기에서는 mod_jk를 사용하도록 한다.</li>\n<li>\n<p>컴파일이 정상적으로 되면 /etc/httpd/modules 경로에 mod_jk.so 파일이 생성된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/gaia3d/setup\n<span class=\"token function\">tar</span> -xvzf tomcat-connectors.tgz\n<span class=\"token builtin class-name\">cd</span> tomcat-connectors-1.2.48-src/native\n./configure --with-apxs<span class=\"token operator\">=</span>/usr/bin/apxs\n<span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span></code></pre></div>\n</li>\n</ul>\n<h4>7.3. mod_jk.conf 파일 생성</h4>\n<ul>\n<li>\n<p>mod_jk 의 로그 및 worker 파일 위치 및 기타 설정들을 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> /etc/httpd/conf.modules.d/mod_jk.conf</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token operator\">&lt;</span>IfModule mod_jk<span class=\"token operator\">.</span><span class=\"token keyword\">c</span><span class=\"token operator\">></span>\n# 워커 설정파일 위치\nJkWorkersFile <span class=\"token keyword\">conf</span><span class=\"token operator\">/</span>workers<span class=\"token operator\">.</span>properties\n# 공유 메모리파일 위치 반드시 Selinux 보안때문에 run에 위치 필수\nJkShmFile run<span class=\"token operator\">/</span>mod_jk<span class=\"token operator\">.</span><span class=\"token builtin\">shm</span>\n# log 위치\nJkLogFile logs<span class=\"token operator\">/</span>mod_jk<span class=\"token operator\">.</span>log\n# 로그레벨 설정\nJkLogLevel info\n# 로그 포맷에 사용할 시간 형식을 지정한다<span class=\"token operator\">.</span>\nJkLogStampFormat <span class=\"token string\">\"[%y %m %d %H:%M:%S]\"</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>IfModule<span class=\"token operator\">></span></code></pre></div>\n</li>\n</ul>\n<h4>7.4. workers.properties 파일 생성</h4>\n<ul>\n<li>apache 에서 로드 밸런싱 해줄 톰캣에 대한 설정 정보 파일이다. <strong>port는 http port 가 아닌 ajp port 를 사용한다.</strong></li>\n<li>lbfactor : 가중치에 따라 로드 밸런싱 된다.</li>\n<li>\n<p>sticky_session : 기존의 세션 아이디 뒤에 jvmroutid 를 붙여 어느 서버로 갈지 결정 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> /etc/httpd/conf/workers.properties</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token attr-name\">worker.list</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">admin,user</span>\n\n<span class=\"token attr-name\">worker.admin.type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">lb</span>\n<span class=\"token attr-name\">worker.admin.balance_workers</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">admin1,admin2</span>\n<span class=\"token attr-name\">worker.admin.sticky_session</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n\n<span class=\"token attr-name\">worker.admin1.type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">ajp13</span>\n<span class=\"token attr-name\">worker.admin1.host</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">172.18.0.12</span>\n<span class=\"token attr-name\">worker.admin1.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">8019</span>\n<span class=\"token attr-name\">worker.admin1.lbfactor</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">1</span>\n\n<span class=\"token attr-name\">worker.admin2.type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">ajp13</span>\n<span class=\"token attr-name\">worker.admin2.host</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">172.18.0.13</span>\n<span class=\"token attr-name\">worker.admin2.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">8019</span>\n<span class=\"token attr-name\">worker.admin2.lbfactor</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">1</span>\n\n<span class=\"token attr-name\">worker.user.type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">lb</span>\n<span class=\"token attr-name\">worker.user.balance_workers</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">user1,user2</span>\n<span class=\"token attr-name\">worker.user.sticky_session</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n\n<span class=\"token attr-name\">worker.user1.type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">ajp13</span>\n<span class=\"token attr-name\">worker.user1.host</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">172.18.0.12</span>\n<span class=\"token attr-name\">worker.user1.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">8029</span>\n<span class=\"token attr-name\">worker.user1.lbfactor</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">1</span>\n\n<span class=\"token attr-name\">worker.user2.type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">ajp13</span>\n<span class=\"token attr-name\">worker.user2.host</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">172.18.0.13</span>\n<span class=\"token attr-name\">worker.user2.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">8029</span>\n<span class=\"token attr-name\">worker.user2.lbfactor</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">1</span></code></pre></div>\n</li>\n</ul>\n<h4>7.5. httpd.conf 설정</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> /etc/httpd/conf/httpd.conf</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\">Listen <span class=\"token number\">9090</span>\n\nLoadModule jk_module modules<span class=\"token operator\">/</span>mod_jk<span class=\"token operator\">.</span><span class=\"token keyword\">so</span>\n<span class=\"token operator\">&lt;</span>VirtualHost <span class=\"token operator\">*</span><span class=\"token punctuation\">:</span><span class=\"token number\">80</span><span class=\"token operator\">></span>\nServerName mago3d<span class=\"token operator\">-</span>user\nJkMount <span class=\"token operator\">/</span><span class=\"token operator\">*</span> user\nJkUnMount  <span class=\"token operator\">/</span>images<span class=\"token operator\">/</span><span class=\"token operator\">*</span> user\nJkUnMount  <span class=\"token operator\">/</span><span class=\"token builtin\">js</span><span class=\"token operator\">/</span><span class=\"token operator\">*</span> user\nJkUnMount  <span class=\"token operator\">/</span>css<span class=\"token operator\">/</span><span class=\"token operator\">*</span> user\njkUnMount  <span class=\"token operator\">/</span>externlib<span class=\"token operator\">/</span><span class=\"token operator\">*</span> user\njkUnMount  <span class=\"token operator\">/</span>sample<span class=\"token operator\">/</span><span class=\"token operator\">*</span> user\nDocumentRoot <span class=\"token string\">\"/var/www/mago3d-user\"</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>VirtualHost<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>VirtualHost <span class=\"token operator\">*</span><span class=\"token punctuation\">:</span><span class=\"token number\">9090</span><span class=\"token operator\">></span>\nServerName mago3d<span class=\"token operator\">-</span>admin\nJkMount <span class=\"token operator\">/</span><span class=\"token operator\">*</span> admin\nJkUnMount  <span class=\"token operator\">/</span>images<span class=\"token operator\">/</span><span class=\"token operator\">*</span> admin\nJkUnMount  <span class=\"token operator\">/</span><span class=\"token builtin\">js</span><span class=\"token operator\">/</span><span class=\"token operator\">*</span> admin\nJkUnMount  <span class=\"token operator\">/</span>css<span class=\"token operator\">/</span><span class=\"token operator\">*</span> admin\njkUnMount  <span class=\"token operator\">/</span>externlib<span class=\"token operator\">/</span><span class=\"token operator\">*</span> admin\njkUnMount  <span class=\"token operator\">/</span>sample<span class=\"token operator\">/</span><span class=\"token operator\">*</span> admin\nDocumentRoot <span class=\"token string\">\"/var/www/mago3d-admin\"</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>VirtualHost<span class=\"token operator\">></span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a5c1ca1c3f7d713318589a7732824eff/89aeb/httpd-conf.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 323px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 215%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAYAAAB4pah1AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFh0lEQVR42pWXWU9jRxCFLzvGGANmMWDMZpvFGDBmyYBYhRADE0JAQiN2XjJSpEiRJlImeYqUnxDl91bO13YRD5mFPJR6ud2nTi1d3Tf6e3XVrufn7YdSya5nZ+3HwUE7Vb9UqVhledmWXyAVrZ2bm7OLiwuL/hTgViplh/399np01N60t1umsdGilhZrbmqyFrWtra1BmjRuqs3VS1tbm0VRZIuLixa9u7mxXE+PLQgstGNjlslkLJvN2qjm0um0TU5O2tDQkI2Pj9vIyIj1aF08HrfOzs4gXV1d1igSqyIXvb2+tjZ9HBgetpTM7RXTvr6+IIMap8S+X3MI4Mx3d3cHUL65oGB9fd2i29vboHVmZsbyuZzl83mbmJgI7fT0dJiflW/HxDyn75hVLBaDFaybl/+Zx5qTkxOLbmQyH5l0kzBxamrKCoVCAGLeBQWsZZ51gKJ4YGDAjo+PLbq7u7NhmeuMaEuKMmDMowxhA8qY6+3tDT5mTJ8Ws4PJV1dXFovFwgZ8w4JEIhEc3a6IE0Gkvs96n+vo6Aj+I8qkT3StoGAKA8wAlACgwINAhAkQY8SDhWKPMum0srJSBUQDprDYwXzswP4NBR5ZANnraRMAHx8fw2Yih19g6VFm7IIVgGBBMpl8MhUB+Anw/v7+ycmwYBNOZgwjlCGYSXCcNaY6GAqam5v/NZkkhQG5RAsYacMY/8EaJZ57Lqxxl6B8Z2enmodoYDOTMKGFNX0PChvdd8zBmj4Rh2lDQ0M1ypwUFsAArWx2VjBAO8zok8huOushwTyJzp6Dg4OqyWgHjFNAGQKMoJDcCPOAIXz3E0TfTxAW7e/vVwGhjQZPCT7iV29xAdHlu7sDYeyRxmRqY/Tw8BAWORMAUEBauNSPn3/7T2Kfn59/lCqulUWIH0OvfZ+SjwAvLy+DOfgRdgB7/qGAAHhB8Igiz1k+RZm0QUP9EXNwP7P155cWcHzuaYZgydbWVjVtYELpIoocQaLGmOJJWjDGx3xnjujSp/AyT4tlZ2dnVYb4zQsq6eJ9zPW66DmHctZ4QWZMH/aHh4dVQOhiBqZiBub4qWDOTwzia+orE+vx5cbGhgCVhyn5a1LaxjBdjLJiRjuhuXDPwEbfijI1J5aZ2jXh5x+GMD09PVWUdQV0YrJ8N0CpEtAIAPhFbU4+m1C/W4ySYkrbVTvXzhq2RH5vb8+in4Wap3zL7CXRXtKHRVpJWf0FlXn6JbVFXeolXfizKv9xkryWNn5SyuWyRX/IjA2ZcCDZkB+RHWncFotNsdiTf7bFbFdzu2q/EaM7VadhgcQ+ldjvX72yFCmic1jQndsvs2kxPSmQhIDjAulUAHBNkxRuCSAjZu0APr8CflNkhuXoWaXCuCoIwSBAabEZknRwOjCLEyFplWzz/hHQZwFnxG6udll7GfO0IBf9zCYkrZJtKfkiYGFpycoy04unl3fE744XA/4qH+YWFmxeqUEK+H1CCzAJD9sQTQG1COCLgB8EOKWnR0UsYUcl5kHkx4tzy3x4gUlhTBEGcPRzgO/1phsSo7m68u+V2e8XAENfTL8K+IsAUzo+izyDJRwljhV9QOurNJH+qsm/b25aVuyKEnxG+fJyhB8pvv8rKEQ5L59Ny2cwAhRAL7QUAH8CvzxtdAaXFZT6tKHALij6gHmZfxHgh1ralGQqDGHkL1QiTTDwK5s6dEK+7kMYKgCrYpilzgmoLAXTAi1ISPi8gpTm4pILksrLXaIssJgqlD+WKA7hL+CntTVLcG/Ib+OwFMOYNsd50UpBl8p/j9yQENNetY1KqTUxTfPfwotWLVnAC3ZJpKK/xOBbbboR0FtF1eV7+fM7AZ/Ih/Rfi8Wu6uGOQN7JpxXeOnKJv81xy9HRkf0DyZN8rollr0YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"httpd-conf\"\n        title=\"\"\n        src=\"/static/a5c1ca1c3f7d713318589a7732824eff/89aeb/httpd-conf.png\"\n        srcset=\"/static/a5c1ca1c3f7d713318589a7732824eff/772e8/httpd-conf.png 200w,\n/static/a5c1ca1c3f7d713318589a7732824eff/89aeb/httpd-conf.png 323w\"\n        sizes=\"(max-width: 323px) 100vw, 323px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h4>7.6. static resource 복사</h4>\n<ul>\n<li>\n<p>static 파일들을 apache 에서 처리하도록 httpd.conf 파일에 설정한 폴더를 생성하고 파일들을 복사해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /var/www/mago3d-user <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mkdir</span> /var/www/mago3d-admin\n<span class=\"token function\">cp</span> -R /home/gaia3d/tools/mago3d-tomcat/source/mago3d-admin/WEB-INF/classes/static/* /var/www/mago3d-admin/\n<span class=\"token function\">cp</span> -R /home/gaia3d/tools/mago3d-tomcat/source/mago3d-user/WEB-INF/classes/static/* /var/www/mago3d-user/</code></pre></div>\n</li>\n</ul>\n<h4>7.7. tomcat ajp 포트 설정</h4>\n<ul>\n<li>session clustering 테스르를 위해 http port 로 실행한 톰캣의 port 를 ajp port 로 변경 한다.(기존의 http port 를 주석 하고 ajp port 를 주석 해제 한다.)</li>\n<li>\n<p><strong>tomcat 버전에 따라 secretRequired 값을 설정 하지 않으면 톰캣이 시작 되지 않을 수 있다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">su</span> gaia3d\n<span class=\"token function\">vi</span> /home/gaia3d/tools/mago3d-tomcat/conf/server.xml</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/944c1ad21682af40739b1e1d8eebd5bf/1cfc2/ajp-port.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 37.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZ0lEQVR42o2SS0tCURSFj3RFvaI3sZep1zDLCB+BBmaDQEXNgf0Fh00qewyahIraQ3TUwL/ha+zcUpr1d1b7nE5gEdGFj7X3OuseuHtfFovFcJhM4iCRwH48jkg4jHAoJPSLaCTyJ3vRKHaCQZwUi2CK2Qyb0wmL3Q476ZrXi1WPBy5dF6pqGhYoo1gsv0NnRlUFMxiwSxczB2PwE+uETmyZTNimUJDCAaMRHvI4Xgmv3TLvlh5/b4k48vvBJsMh3gYDvPT7eJUq6PUE3JtRZip1NhoJjzOVPfcnlH0fj8HuWy08dTqCh3Yb1UYDlXodFam8rzabn/B6vpdejfSuVsNztwtGj/j+b/qz/ie6zwemKgpWbDY4aGbLtJhNWkSAQ8vZcLngtFqh0Uz5OddFiUazFjX5DlqKmS6M09/BTtNp3ObzuMhmcX18jMtcTnBF3nkmg7L0OeW5DK955qZQEN5ZKoXHUgkfi6AUsuvnlrAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"ajp\"\n        title=\"\"\n        src=\"/static/944c1ad21682af40739b1e1d8eebd5bf/5a190/ajp-port.png\"\n        srcset=\"/static/944c1ad21682af40739b1e1d8eebd5bf/772e8/ajp-port.png 200w,\n/static/944c1ad21682af40739b1e1d8eebd5bf/e17e5/ajp-port.png 400w,\n/static/944c1ad21682af40739b1e1d8eebd5bf/5a190/ajp-port.png 800w,\n/static/944c1ad21682af40739b1e1d8eebd5bf/1cfc2/ajp-port.png 900w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</li>\n<li>\n<p>설정 변경 후 톰캣 - apache 순으로 재시작한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart mago3d-tomcat\n<span class=\"token function\">sudo</span> systemctl restart httpd</code></pre></div>\n</li>\n</ul>\n<h4>7.8. container 생성</h4>\n<ul>\n<li>\n<p>테스트를 위해 생성한 temp container 를 삭제하고 지금까지 설정한 내용을 기반으로 container 를 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">cmd<span class=\"token operator\">></span> docker container stop temp\ncmd<span class=\"token operator\">></span> docker container <span class=\"token function\">rm</span> temp\ncmd<span class=\"token operator\">></span> docker container commit apache-tomcat1 apache-tomcat2\ncmd<span class=\"token operator\">></span> docker container run --privileged --net mynetwork --ip <span class=\"token number\">172.18</span>.0.13  -d -p <span class=\"token number\">20080</span>:80 -p <span class=\"token number\">28081</span>:8081 -p <span class=\"token number\">29090</span>:9090 --name <span class=\"token string\">\"apache-tomcat2\"</span> apache-tomcat2 /sbin/init</code></pre></div>\n</li>\n<li>생성한 container 에서 tomcat 의 jvmRoute 값을 각각 admin2, user2 로 변경한다.</li>\n</ul>\n<h4>7.9. 테스트</h4>\n<ul>\n<li>apache-tomcat1 의 port 로 사용자 또는 관리자 사이트에 접속해서 개발자 도구의 네트워크 탭에서 세션을 확인 한다.</li>\n<li>apache-tomcat1 container 를 stop 했을 때 기존의 세션값이 그대로 넘어 가고 jvmroutid 가 변경 됐는지 확인 한다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/391243e41c5fa9e1f5d2efff81735123/ec3e2/session-test.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABXElEQVR42mWRSW7DMAxFff+rdNkzdFkgzZws4iGxLSW25FkeYv+SChy4qAACkvj1Pkk59/sdHFmWIQxD3MIb5jsOpRSGvsOPW+DjS+DzW+PsCdIGkJR/PB5vnTEGDh+CILAJrTXCOERRFOj7HuM4Yl5lrpCIAIUSqMoCoYiQ5dk/nSOlhO/71oGBDK7rGm3bYhgGTNNkhanScD0fUpIxdSOFRFmWf3QcDgMY2jSNhUZRZMFc/izixSOZjRkUx7HdV1X1rtAC+TBf5PQoTdPXI267695ANmEgF8AjsSNa6pjBQCyW4laSBBmJGmqlo1ZaCrZjE/40huVUIes07SvqrKU5Gorh+YSzbEtTu9H5DH29ohQCPVU15jkmqsCQgf0sMiiputvhgMTzUJFuIB0lMRH8BWQaCZvTCfl6jXq/hzke0VAY2o9ktFzd5YJitUK92dh8s9vBbLd4ui5+AaCdYnwmo47JAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"session-test\"\n        title=\"\"\n        src=\"/static/391243e41c5fa9e1f5d2efff81735123/5a190/session-test.png\"\n        srcset=\"/static/391243e41c5fa9e1f5d2efff81735123/772e8/session-test.png 200w,\n/static/391243e41c5fa9e1f5d2efff81735123/e17e5/session-test.png 400w,\n/static/391243e41c5fa9e1f5d2efff81735123/5a190/session-test.png 800w,\n/static/391243e41c5fa9e1f5d2efff81735123/ec3e2/session-test.png 997w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h3>8. haproxy 설정</h3>\n<ul>\n<li>\n<p>haproxy container 연결</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker <span class=\"token builtin class-name\">exec</span> -it haproxy <span class=\"token function\">bash</span></code></pre></div>\n</li>\n<li>\n<p>haproxy.cfg 파일에서 frontend, backend 부분 수정</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vi</span> /etc/haproxy/haproxy.cfg</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\">#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n# main frontend which proxys <span class=\"token keyword\">to</span> the backends\n#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\nfrontend mago3d<span class=\"token operator\">-</span>user<span class=\"token operator\">-</span>front\n  bind <span class=\"token operator\">*</span><span class=\"token punctuation\">:</span><span class=\"token number\">80</span>\n  stats uri <span class=\"token operator\">/</span>haproxy<span class=\"token operator\">?</span>stats\n\n  default_backend    mago3d<span class=\"token operator\">-</span>user\n\n#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n# round robin balancing between the various backends\n#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\nbackend mago3d<span class=\"token operator\">-</span>user\n  balance     roundrobin\n  server  user<span class=\"token operator\">-</span>server<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token operator\">-</span>host   <span class=\"token number\">172.18</span><span class=\"token operator\">.</span><span class=\"token number\">0.12</span><span class=\"token punctuation\">:</span><span class=\"token number\">80</span>  check fall <span class=\"token number\">3</span> rise <span class=\"token number\">2</span>\n  server  user<span class=\"token operator\">-</span>server<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token operator\">-</span>host   <span class=\"token number\">172.18</span><span class=\"token operator\">.</span><span class=\"token number\">0.13</span><span class=\"token punctuation\">:</span><span class=\"token number\">80</span>  check fall <span class=\"token number\">3</span> rise <span class=\"token number\">2</span>\n\n\n\n#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n# main frontend which proxys <span class=\"token keyword\">to</span> the backends\n#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\nfrontend mago3d<span class=\"token operator\">-</span>admin<span class=\"token operator\">-</span>front\n  bind <span class=\"token operator\">*</span><span class=\"token punctuation\">:</span><span class=\"token number\">9090</span>\n  stats uri <span class=\"token operator\">/</span>haproxy<span class=\"token operator\">?</span>stats\n\n  default_backend    mago3d<span class=\"token operator\">-</span>admin\n\n#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n# round robin balancing between the various backends\n#<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\nbackend mago3d<span class=\"token operator\">-</span>admin\n  balance     roundrobin\n  server  admin<span class=\"token operator\">-</span>server<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token operator\">-</span>host   <span class=\"token number\">172.18</span><span class=\"token operator\">.</span><span class=\"token number\">0.12</span><span class=\"token punctuation\">:</span><span class=\"token number\">9090</span>  check fall <span class=\"token number\">3</span> rise <span class=\"token number\">2</span>\n  server  admin<span class=\"token operator\">-</span>server<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token operator\">-</span>host   <span class=\"token number\">172.18</span><span class=\"token operator\">.</span><span class=\"token number\">0.13</span><span class=\"token punctuation\">:</span><span class=\"token number\">9090</span>  check fall <span class=\"token number\">3</span> rise <span class=\"token number\">2</span></code></pre></div>\n</li>\n<li>\n<p>파일 유효성 확인 후 재시작</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">haproxy -f haproxy.cfg -c\nsystemctl restart haproxy</code></pre></div>\n</li>\n<li>haproxy container 의 바인딩 포트인 80 / 9090 으로 확인 한다.</li>\n</ul>","fields":{"slug":"/load-balancing-session-clustering/","prefix":"2020-06-10"},"frontmatter":{"title":"Load Balancing, Session Clustering","category":"infra"}},"authornote":{"id":"265dda60-7971-5464-926f-ea569c79ac0a","html":"<p>🔘 안되면 될 때 까지! 🏃 🔘</p>"}},"pageContext":{"slug":"/load-balancing-session-clustering/","prev":{"id":"4117ac20-e72f-5588-8baa-28119592f9a8","fields":{"slug":"/docker-haproxy/","prefix":"2020-06-06","source":"posts"},"frontmatter":{"title":"docker 에 haproxy 설치","category":"docker"}},"next":{"id":"9edef190-c2d9-5456-af6e-3a09f06f0af4","fields":{"slug":"/geoserver-clustering/","prefix":"2020-06-13","source":"posts"},"frontmatter":{"title":"Geoserver Clustering","category":"etc"}},"source":"posts"}},"staticQueryHashes":["960164547","960164547"]}