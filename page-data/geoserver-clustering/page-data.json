{"componentChunkName":"component---src-templates-post-template-js","path":"/geoserver-clustering/","result":{"data":{"post":{"id":"9edef190-c2d9-5456-af6e-3a09f06f0af4","html":"<h3>1. jms 클러스터링 구성</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3303944965233a38ad935db182be0f9e/74866/clustering-architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 668px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 96%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADeklEQVR42p1U6W9bRRD3P44ECCEk+AhCSFU5hJCgH2iCm8ZJbdymdo80ce36PR+Nj5f4+d1+9338mF27Lm3EF0Ya7e7s7OxvfzOztSRJkKYpsiy7pcxelSVsz0GzfwJBElDk5X6/pD2mRVFwtSwLNXboQ6l2uhXyw+h6gW/+/ALHl0fclpMxpYDyeg1JuuaBmGiatg1YVRXXj8ULUwRhjLIosVBkyLqJnBDya8sKvufDdT14rs9tuq5vAzLYzKGIZPiGiMCaQFu9RmAvCWuFKE/gRBGyKofhubACD0mZIUdJSmhLmlW7gIyLdxI6M8zEFm6mjzEXTpFYIn++Vm2gFSYWjoSJMYOgvsVIv8LMlmDDhYcdQvbk0HfhKHMoyzEWkyE8c72/QHdTTK4NnAtLjCQTlv+e75SeLpLtxXDBfSQjwEpWUDNWV1icfIfTu5/h5e9fYt39FWEQ8EON12t8de8cn945wtf3+2i+Ubm9LHJImoNvG1f45M4xPv+ljR+ac0zmN6jFcYw8jbCxHSLZQ5HF+wSlWQEvyqBYHoKYyigv9hVQEmlhUsBwQuh2gIxypbInR1GM7qs+Gq0zNP4+gzCd759lWDZOyHbaeoL202cwN842w3QhC9gbCDhpPUaj2cZoOoNhGKgFYYiz7nPcPzhE/eghBsJoH1DRDNQfNvjeo1ab1uauVCtkhPblRQ8Hh3+R1vFGHBPCXdl4fgjLdjmCOHlPfE71t3E8vsfGoig/qFM/jPgZ3dwgSbMtwludQrezNqqqks9vS7Vvt4+F1yHrZZ+yukXiwfUCRJSod6h8n3WDy9eaYZJacKgzWDJ5D1PwsTyGbK9h6IQwoQ2XWqgzmOHB0wGGb6+hqWs8Gcp4NlpDoQAKOXb6M/x22CRtoTddwaaWMzd0ycbCvYuf8Ghcp95WtwiDIER/ssTzwRTzG5U4sXHYEVHvDBHGW0p6ozk6lyK6vREmS5n/RHmWw4sD/Nz6Hsf9AyiqtkXoU8AXooTWxRTjpQJTV3E+VdGb6dBVGYFroUsvaF9OuV6OJVhEh+MGsOhr++PVj2iOH2wRMi4C4pBx5VFhs3lMqBlvbC7LMlYrGRF9DsyHaUilxtZ5nnMOJ/KEc6gzDlnG2H8mCAJEUaTDK/xfMU0TNYZqTR8lQ8JGVVV5+tln+Z9K+//2UVSFrxfzBf4BFSuOb9kOwZYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"architecture\"\n        title=\"\"\n        src=\"/static/3303944965233a38ad935db182be0f9e/74866/clustering-architecture.png\"\n        srcset=\"/static/3303944965233a38ad935db182be0f9e/772e8/clustering-architecture.png 200w,\n/static/3303944965233a38ad935db182be0f9e/e17e5/clustering-architecture.png 400w,\n/static/3303944965233a38ad935db182be0f9e/74866/clustering-architecture.png 668w\"\n        sizes=\"(max-width: 668px) 100vw, 668px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>2. geoserver 기본 설정</h3>\n<ul>\n<li>\n<p>docker container 생성 및 시작</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker network create --subnet<span class=\"token operator\">=</span><span class=\"token number\">172.18</span>.0.0/16 mynetwork\ncmd<span class=\"token operator\">></span> docker container run --privileged  -d --net mynetwork --ip <span class=\"token number\">172.18</span>.0.100 -p <span class=\"token number\">18888</span>:8080 -v <span class=\"token string\">\"D:\\geoserver\\gwc-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/gwc-data\"</span> -v <span class=\"token string\">\"D:\\geoserver\\map-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/map-data\"</span> --name <span class=\"token string\">\"geoserver1\"</span> gaia3d/geoserver /sbin/init\ncmd<span class=\"token operator\">></span> docker container run --privileged  -d --net mynetwork --ip <span class=\"token number\">172.18</span>.0.200 -p <span class=\"token number\">28888</span>:8080 -v <span class=\"token string\">\"D:\\geoserver\\gwc-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/gwc-data\"</span> -v <span class=\"token string\">\"D:\\geoserver\\map-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/map-data\"</span> --name <span class=\"token string\">\"geoserver2\"</span> gaia3d/geoserver /sbin/init</code></pre></div>\n</li>\n<li>geoserver data 는 독립적으로 사용하고 tiff 파일과 캐시 데이터는 공유 디렉토리를 마운트해서 사용한다.</li>\n<li><strong>타일 캐시와 관련된 설정은 동기화 되지 않으며, gwc data 디렉토리를 공유해서 사용할 경우 master 의 변경 사항은 slave 에서 reload 후에 적용 된다.</strong></li>\n<li>\n<p>geoserver applictaion 배치 및 서비스 시작(geoserver1, geoserver2 동일하게 실행)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">su</span> gaia3d\n<span class=\"token function\">mkdir</span> /home/gaia3d/tools/geoserver-tomcat/webapps/geoserver\n<span class=\"token function\">unzip</span> /home/gaia3d/setup/geoserver.war -d /home/gaia3d/tools/geoserver-tomcat/webapps/geoserver\n<span class=\"token function\">cp</span> /home/gaia3d/setup/geoserver-2.16-SNAPSHOT-jms-cluster-plugin/* /home/gaia3d/tools/geoserver-tomcat/webapps/geoserver/WEB-INF/lib/\n<span class=\"token function\">sudo</span> systemctl restart geoserver-tomcat</code></pre></div>\n</li>\n<li>타일 캐시 - 그리드셋 - 새로운 그리드셋 생성\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee533171e76d451ab8f8157172bdf5d1/0f529/gridset.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACHElEQVR42pVTi47aMBDM/39hVXGASZyX41deTkJgbuwDQatWvQZNItbr2ZldOzPWYLtuuL7hdtv/G3f+whKQreuK/bpj31+47TcmvfC+9jfEvG3bkCmlsJD0fr8nxMVhHDGvV2JD2K747hP3Z1p3CGGmymuqEBGWBesWrd8TnsX+hfhkTadRKw3X9xiGAWPEOGAJ4ZfK3wUVavQkiVZj4Ha/fZ8IfyBsmwbe+2QxLCs29jPa3jm53/vDd8LT3rtVPFYzZQvISqCqK9hew081Oi+hOv53BsNsMW38hg7aKhadOSiPcdUYlg793PKrMU4NhUzI/FKhbAUuxRlubOAWCTfHImfkjOm+hAsFzJijKJnTG/i5gZlzxiW6QUARxh44XEPCuULVXrhZwA0tfChhJ5kIC3mBHdiSJcZKyFrAk7APikUlcyvoIYfqL3DuxEE6ZG4uqZBq5Jl221TVTgXKRlCRgB3rR+yriGNb+tDC0kUs3pGscYy7IxVaKmQVWZ8hLieYPm6mGlYvuFnkJyp8EUbL1unUtyeh8gK1Pb0Io8JkOaeavklJMRYHFdtgx+atDSL1cHhaZv8bklXm+CI0Y4GLPOB4OkD76msAU051B5zOH8myfQxFFB8wrkuWY05ULtVPiPoHrOFQZg5l5OjbjipriX4yPCI8AozVrUTTVpgWh+lxRBpV8hJ43nHHY9Ol49Q55pmcN6zEugz4BOA0grha5b2JAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"gridset\"\n        title=\"\"\n        src=\"/static/ee533171e76d451ab8f8157172bdf5d1/5a190/gridset.png\"\n        srcset=\"/static/ee533171e76d451ab8f8157172bdf5d1/772e8/gridset.png 200w,\n/static/ee533171e76d451ab8f8157172bdf5d1/e17e5/gridset.png 400w,\n/static/ee533171e76d451ab8f8157172bdf5d1/5a190/gridset.png 800w,\n/static/ee533171e76d451ab8f8157172bdf5d1/c1b63/gridset.png 1200w,\n/static/ee533171e76d451ab8f8157172bdf5d1/0f529/gridset.png 1259w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>geoserver2 설정 reload</li>\n<li>타일 캐시 - 캐시 기본 설정 - 기본 그리드셋 추가(geoserver1, geoserver2 동일하게 설정)\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/500fecbf7ce45ed2fbdaf32441a7c4b2/19a15/gridset-add.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 13.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAApElEQVR42j3LbQuCMBSGYf//3wqEwGZZmWTOouZLm2vzJTWDp6nVh4tznwPH8pkNKlY4S4KQE0SCTB3LefrZ7LePaEEQ5AQX0yfzc+Rz08KBFXMXeR0gM0LmwIsWSPR+wtQOHrURcw9J6YN971e5RSw2yKoD6N011khN39gSlnikKFQ2ETqFKjm6ofrTlUD7KtEP9f827m2v0b9rNJ3C0xi7ayQ+Kb/dIYfZL3MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"gridset\"\n        title=\"\"\n        src=\"/static/500fecbf7ce45ed2fbdaf32441a7c4b2/5a190/gridset-add.png\"\n        srcset=\"/static/500fecbf7ce45ed2fbdaf32441a7c4b2/772e8/gridset-add.png 200w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/e17e5/gridset-add.png 400w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/5a190/gridset-add.png 800w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/c1b63/gridset-add.png 1200w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/19a15/gridset-add.png 1229w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h3>3. cluster 설정</h3>\n<ul>\n<li>jms cluster plugin 이 설치 되면 기본적으로 embeddedBroker 가 활성화 된다. 여기서는 master 의 broker 만 활성화 하고 slave 는 master 의 변경사항만 전달 받도록 설정한다.</li>\n<li>\n<p>master</p>\n<ul>\n<li>embedded-broker.properties\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2c676c7c04c84bea1f9a8e8a38048c8/3a737/broker-port.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 10.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAXUlEQVR42j2MSQoAIRAD/YKCy8EdFRH8//MypME5hAqElDrnYO+NOSfGGFhrCXPOKKUgxvj3lBJaa6i1IoQgcc4JjTHiURx77/+J5JFhf6GI9N6LwFor/VFrjXsvPhHCNcv8NwOpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"broker\"\n        title=\"\"\n        src=\"/static/b2c676c7c04c84bea1f9a8e8a38048c8/5a190/broker-port.png\"\n        srcset=\"/static/b2c676c7c04c84bea1f9a8e8a38048c8/772e8/broker-port.png 200w,\n/static/b2c676c7c04c84bea1f9a8e8a38048c8/e17e5/broker-port.png 400w,\n/static/b2c676c7c04c84bea1f9a8e8a38048c8/5a190/broker-port.png 800w,\n/static/b2c676c7c04c84bea1f9a8e8a38048c8/3a737/broker-port.png 897w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>cluster.properties</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\">#</span>\n<span class=\"token comment\">#Sat Jun 13 09:32:53 UTC 2020</span>\n<span class=\"token attr-name\">CLUSTER_CONFIG_DIR</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">/home/gaia3d/geoserver-data/cluster</span>\n<span class=\"token attr-name\">instanceName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">master-geoserver</span>\n<span class=\"token attr-name\">readOnly</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">disabled</span>\n<span class=\"token attr-name\">durable</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">brokerURL</span><span class=\"token punctuation\">=</span>\n<span class=\"token attr-name\">embeddedBroker</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">enabled</span>\n<span class=\"token attr-name\">connection.retry</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">10</span>\n<span class=\"token attr-name\">toggleMaster</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">xbeanURL</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">./broker.xml</span>\n<span class=\"token attr-name\">embeddedBrokerProperties</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">embedded-broker.properties</span>\n<span class=\"token attr-name\">topicName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">VirtualTopic.geoserver</span>\n<span class=\"token attr-name\">connection</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">enabled</span>\n<span class=\"token attr-name\">toggleSlave</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span>\n<span class=\"token attr-name\">connection.maxwait</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">500</span>\n<span class=\"token attr-name\">group</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">geoserver-cluster</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>slave</p>\n<ul>\n<li>\n<p>cluster.properties</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\">#</span>\n<span class=\"token comment\">#Sat Jun 13 09:32:53 UTC 2020</span>\n<span class=\"token attr-name\">CLUSTER_CONFIG_DIR</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">/home/gaia3d/geoserver-data/cluster</span>\n<span class=\"token attr-name\">instanceName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">slave-geoserver</span>\n<span class=\"token attr-name\">readOnly</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">disabled</span>\n<span class=\"token attr-name\">durable</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">brokerURL</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">tcp://172.18.0.100:61666</span>\n<span class=\"token attr-name\">embeddedBroker</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">disabled</span>\n<span class=\"token attr-name\">connection.retry</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">10</span>\n<span class=\"token attr-name\">toggleMaster</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span>\n<span class=\"token attr-name\">xbeanURL</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">./broker.xml</span>\n<span class=\"token attr-name\">embeddedBrokerProperties</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">embedded-broker.properties</span>\n<span class=\"token attr-name\">topicName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">VirtualTopic.geoserver</span>\n<span class=\"token attr-name\">connection</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">enabled</span>\n<span class=\"token attr-name\">toggleSlave</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">connection.maxwait</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">500</span>\n<span class=\"token attr-name\">group</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">geoserver-cluster</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/geoserver-clustering/","prefix":"2020-06-13"},"frontmatter":{"title":"Geoserver Clustering","category":"etc"}},"authornote":{"id":"265dda60-7971-5464-926f-ea569c79ac0a","html":"<p>🔘 안되면 될 때 까지! 🏃 🔘</p>"}},"pageContext":{"slug":"/geoserver-clustering/","prev":{"id":"68581b87-47db-505f-ae3a-8f4e4f8c9ddb","fields":{"slug":"/load-balancing-session-clustering/","prefix":"2020-06-10","source":"posts"},"frontmatter":{"title":"Load Balancing, Session Clustering","category":"infra"}},"next":{"id":"2224768d-a3dc-538a-aef3-8fe86fd173e9","fields":{"slug":"/docker-container-setting/","prefix":"2020-06-30","source":"posts"},"frontmatter":{"title":"docker container 기본 설정","category":"docker"}},"source":"posts"}},"staticQueryHashes":["960164547","960164547"]}