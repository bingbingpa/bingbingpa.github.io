{"componentChunkName":"component---src-templates-post-template-js","path":"/geoserver-clustering/","result":{"data":{"post":{"id":"b012a83c-7ce4-5c16-9b9f-92756eaf2fd5","html":"<h3>1. jms 클러스터링 구성</h3>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3303944965233a38ad935db182be0f9e/74866/clustering-architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 668px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 96%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADgElEQVQ4y51UWXMbRRDWD+ch8ABV8AS8QcILRYVQRcUyjgWKbMl3FOzYKF7Ju7osabX3am9p74+ekZAT542u6p3Z7jm+/rqnK3EcI0kSpGn6iTJ7WRSwvAUOOq8hyiKKvECSrtcX5GOaZRnyPIdpmqiwTR9LudG10Dp0xiK+/v1zHHYa3JaRMaZ987mCyXQKx3G4fT6frw8sy5LrY/GiBOEyJgQ5hvMpFNNGnhXcx5D6ng/X9eD7AbcpirI5kGAzzSIZgdVDuJCgy/8g8maEtUSUxfBWK6RlBtP3sIgCJGWKHLSHNCnoS3hUVUUlTbMtosAWMeweYCq2MBLqSByRh68VNvTcxMi5h2gOcatJ6BkDjNwJHBBCfIAw8l242hjqRMJ9v0votO0FuhdDmpm47N5Dkm044QPfcZqje2/ib/L1ZQuyHWE6k1ExJj0M//wOfz17gsvfvoLy5lesKDwmf1zJ+PJFG0+e7uOb6nsc9/QNfymGioNvayI++2EfX/x8hKdNunQ0QWW1WiKLI1iLBcLAQ56utgliKLwohWr5CFcZEkrOfxWQU1LCOIfuhDBI02KT5TBa4uztDerNU9RbZxBH021YmmHhdfMEjdYJjs/bcL01V+zCjA68unlP/mPUD48wGE+gaRoqHqW8dXKGlztV7O3XINxJ2wNncw27r2p4Wd1Fo3kEw1o8cJikuGhfYod81d09dMU+FJZlVjaeH1LILkzSVfxAfEoh2o7HfQvXR14UH9WpH0QwbQc61WdC1bIpm/TRQyn5MyrLgs8/lZKeW87XPBZeNiyjQRhyBDapH4RYLlccmUMvIQgCeDSyf4OQsLBZRGwff8d0cG9+B903oKnEYUwOtvHkZoBXpx30RjN+07GgoH2nQLNszDWD/H38Um3g+V4LncGc77EWPhTbwIvLZ2hJdcgyhcy6DUN1fTfGm46EiaJDMWzsnAqoXQjEzTq0K2GA83cCzq97GExV3oly4tiJXPzU+B4HtzUqG3WN0KMDL27HOLzqo0+LdV1DW9JxPdRh6QoCal8MYetdH80rCTfilNPj+RF018Lztz/iqL9ByLgIiUPGle/7fM5srIuw+Wy2pmC5jLg/II2iiP6XPDGsE3XlLlRXpSwTh6xIWWMUBAHdbpfX0v+VdWF7HkfAng0bmdEwDApb5+Nj1T+c0xqmqqZyUMPBEP8CE5KNyHQmaCwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"architecture\"\n        title=\"\"\n        src=\"/static/3303944965233a38ad935db182be0f9e/74866/clustering-architecture.png\"\n        srcset=\"/static/3303944965233a38ad935db182be0f9e/772e8/clustering-architecture.png 200w,\n/static/3303944965233a38ad935db182be0f9e/e17e5/clustering-architecture.png 400w,\n/static/3303944965233a38ad935db182be0f9e/74866/clustering-architecture.png 668w\"\n        sizes=\"(max-width: 668px) 100vw, 668px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>2. geoserver 기본 설정</h3>\n<ul>\n<li>\n<p>docker container 생성 및 시작</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmd<span class=\"token operator\">></span> docker network create --subnet<span class=\"token operator\">=</span><span class=\"token number\">172.18</span>.0.0/16 mynetwork\ncmd<span class=\"token operator\">></span> docker container run --privileged  -d --net mynetwork --ip <span class=\"token number\">172.18</span>.0.100 -p <span class=\"token number\">18888</span>:8080 -v <span class=\"token string\">\"D:\\geoserver\\gwc-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/gwc-data\"</span> -v <span class=\"token string\">\"D:\\geoserver\\map-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/map-data\"</span> --name <span class=\"token string\">\"geoserver1\"</span> gaia3d/geoserver /sbin/init\ncmd<span class=\"token operator\">></span> docker container run --privileged  -d --net mynetwork --ip <span class=\"token number\">172.18</span>.0.200 -p <span class=\"token number\">28888</span>:8080 -v <span class=\"token string\">\"D:\\geoserver\\gwc-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/gwc-data\"</span> -v <span class=\"token string\">\"D:\\geoserver\\map-data\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/home/gaia3d/map-data\"</span> --name <span class=\"token string\">\"geoserver2\"</span> gaia3d/geoserver /sbin/init</code></pre></div>\n</li>\n<li>geoserver data 는 독립적으로 사용하고 tiff 파일과 캐시 데이터는 공유 디렉토리를 마운트해서 사용한다.</li>\n<li><strong>타일 캐시와 관련된 설정은 동기화 되지 않으며, gwc data 디렉토리를 공유해서 사용할 경우 master 의 변경 사항은 slave 에서 reload 후에 적용 된다.</strong></li>\n<li>\n<p>geoserver applictaion 배치 및 서비스 시작(geoserver1, geoserver2 동일하게 실행)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">su</span> gaia3d\n<span class=\"token function\">mkdir</span> /home/gaia3d/tools/geoserver-tomcat/webapps/geoserver\n<span class=\"token function\">unzip</span> /home/gaia3d/setup/geoserver.war -d /home/gaia3d/tools/geoserver-tomcat/webapps/geoserver\n<span class=\"token function\">cp</span> /home/gaia3d/setup/geoserver-2.16-SNAPSHOT-jms-cluster-plugin/* /home/gaia3d/tools/geoserver-tomcat/webapps/geoserver/WEB-INF/lib/\n<span class=\"token function\">sudo</span> systemctl restart geoserver-tomcat</code></pre></div>\n</li>\n<li>타일 캐시 - 그리드셋 - 새로운 그리드셋 생성\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee533171e76d451ab8f8157172bdf5d1/0f529/gridset.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACEElEQVQ4y5VT23abMBDk/3+wPUkac78jJIMkDNjT0eIkdvrSwJkjs9qdmV3JkTEG27Z9Yd9wve4/xo2vcw7RsixCtO879u2OPSRdv7Bfn7+/476/riuitmvlx+12Q3h2OpzmGW7dYC8rFq7//9wQKaXE6uVyQXAb4L3/FPkpoqYfUHUDztMES2fWWkEQ+FB9LPj4lp1vMSEMDgNBmMFXAp4KBPjXzV3um8OmhjYaCx05v9AZW168nPYz6fWZmO+niYc36nWOvIxR1hXGqYe2FTqdoe1KDKrD2Q2YLx2MbdD1DcU4kovCtHDPt8yvZZ2mknPntTG+RFHHyIpEivRSYLRB5IScMTVV0D7HMGeMJZz1CONqjC5jvEB/TtBPKUb1xi7PiLQrUTYJi1OqtQgC41wgr2IUJYsoYpYjVlSpEIozVzBekTAVaH3iuKaDMK9Pom5cK6pqzlkcCFNp6SMWRMykKNrQYS7inYnREnp8fyBkYprFnOFRPNqCIzghy2NxeBAWIqrPJHTN4ZCELZ01mnn6ThiKyzphMd3MzdGyLeSgZAzz0bIQVuzisWVfoVbvqIhPhwMHGmeveI/foM7lcQCMnZIXJOlJWh59hiPvD6/YIIeibCrO0/oX0uY3D+WV/zKDyC4jetXwmjSw3sBvGiHW9rVcG8eTc6vGHPKGFtZN8GuIjVwNlGEe4eYW2+rxF+MNgxl1X3HLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"gridset\"\n        title=\"\"\n        src=\"/static/ee533171e76d451ab8f8157172bdf5d1/5a190/gridset.png\"\n        srcset=\"/static/ee533171e76d451ab8f8157172bdf5d1/772e8/gridset.png 200w,\n/static/ee533171e76d451ab8f8157172bdf5d1/e17e5/gridset.png 400w,\n/static/ee533171e76d451ab8f8157172bdf5d1/5a190/gridset.png 800w,\n/static/ee533171e76d451ab8f8157172bdf5d1/c1b63/gridset.png 1200w,\n/static/ee533171e76d451ab8f8157172bdf5d1/0f529/gridset.png 1259w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>geoserver2 설정 reload</li>\n<li>타일 캐시 - 캐시 기본 설정 - 기본 그리드셋 추가(geoserver1, geoserver2 동일하게 설정)\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/500fecbf7ce45ed2fbdaf32441a7c4b2/19a15/gridset-add.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 13.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAqElEQVQI1y2M2w6CMBBE+f/vUh80VlIFCcpFI5RLuZQigpiMLfThZGdmd9a6JjtE1RFxTXArCQJOFq2JKgKHEbiZ8SbXN15B8FD6rjp+uWr9x4pKG5n0kPce/OQAGm6QCmfh1V5Agy3i6rz4xOTPiiLmFEy6CPMTwsIG0/fpHhZvGDS1yMEFQ9MVmOYe4ywxfiWELNXsVm/4KK+Zfj3eY4thFKqjdkODPydc3RtislotAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"gridset\"\n        title=\"\"\n        src=\"/static/500fecbf7ce45ed2fbdaf32441a7c4b2/5a190/gridset-add.png\"\n        srcset=\"/static/500fecbf7ce45ed2fbdaf32441a7c4b2/772e8/gridset-add.png 200w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/e17e5/gridset-add.png 400w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/5a190/gridset-add.png 800w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/c1b63/gridset-add.png 1200w,\n/static/500fecbf7ce45ed2fbdaf32441a7c4b2/19a15/gridset-add.png 1229w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h3>3. cluster 설정</h3>\n<ul>\n<li>jms cluster plugin 이 설치 되면 기본적으로 embeddedBroker 가 활성화 된다. 여기서는 master 의 broker 만 활성화 하고 slave 는 master 의 변경사항만 전달 받도록 설정한다.</li>\n<li>\n<p>master</p>\n<ul>\n<li>embedded-broker.properties\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2c676c7c04c84bea1f9a8e8a38048c8/3a737/broker-port.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 10.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAZUlEQVQI102MuREAIQwDaYCAL+H/BxL67043dnSBZm1Zsrj34pyDvTfWWsw5J2qt6L2jlMIzebRTZowB7z1SSswYI5xzeO9BUKG1hhACB+j4F3mknDOXrbUspRSMMdBaM6WU/PADQAM12rD4Q9IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"broker\"\n        title=\"\"\n        src=\"/static/b2c676c7c04c84bea1f9a8e8a38048c8/5a190/broker-port.png\"\n        srcset=\"/static/b2c676c7c04c84bea1f9a8e8a38048c8/772e8/broker-port.png 200w,\n/static/b2c676c7c04c84bea1f9a8e8a38048c8/e17e5/broker-port.png 400w,\n/static/b2c676c7c04c84bea1f9a8e8a38048c8/5a190/broker-port.png 800w,\n/static/b2c676c7c04c84bea1f9a8e8a38048c8/3a737/broker-port.png 897w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>cluster.properties</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\">#</span>\n<span class=\"token comment\">#Sat Jun 13 09:32:53 UTC 2020</span>\n<span class=\"token attr-name\">CLUSTER_CONFIG_DIR</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">/home/gaia3d/geoserver-data/cluster</span>\n<span class=\"token attr-name\">instanceName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">master-geoserver</span>\n<span class=\"token attr-name\">readOnly</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">disabled</span>\n<span class=\"token attr-name\">durable</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">brokerURL</span><span class=\"token punctuation\">=</span>\n<span class=\"token attr-name\">embeddedBroker</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">enabled</span>\n<span class=\"token attr-name\">connection.retry</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">10</span>\n<span class=\"token attr-name\">toggleMaster</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">xbeanURL</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">./broker.xml</span>\n<span class=\"token attr-name\">embeddedBrokerProperties</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">embedded-broker.properties</span>\n<span class=\"token attr-name\">topicName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">VirtualTopic.geoserver</span>\n<span class=\"token attr-name\">connection</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">enabled</span>\n<span class=\"token attr-name\">toggleSlave</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span>\n<span class=\"token attr-name\">connection.maxwait</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">500</span>\n<span class=\"token attr-name\">group</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">geoserver-cluster</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>slave</p>\n<ul>\n<li>\n<p>cluster.properties</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\">#</span>\n<span class=\"token comment\">#Sat Jun 13 09:32:53 UTC 2020</span>\n<span class=\"token attr-name\">CLUSTER_CONFIG_DIR</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">/home/gaia3d/geoserver-data/cluster</span>\n<span class=\"token attr-name\">instanceName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">slave-geoserver</span>\n<span class=\"token attr-name\">readOnly</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">disabled</span>\n<span class=\"token attr-name\">durable</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">brokerURL</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">tcp://172.18.0.100:61666</span>\n<span class=\"token attr-name\">embeddedBroker</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">disabled</span>\n<span class=\"token attr-name\">connection.retry</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">10</span>\n<span class=\"token attr-name\">toggleMaster</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span>\n<span class=\"token attr-name\">xbeanURL</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">./broker.xml</span>\n<span class=\"token attr-name\">embeddedBrokerProperties</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">embedded-broker.properties</span>\n<span class=\"token attr-name\">topicName</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">VirtualTopic.geoserver</span>\n<span class=\"token attr-name\">connection</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">enabled</span>\n<span class=\"token attr-name\">toggleSlave</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token attr-name\">connection.maxwait</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">500</span>\n<span class=\"token attr-name\">group</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">geoserver-cluster</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/geoserver-clustering/","prefix":"2020-06-13"},"frontmatter":{"title":"Geoserver Clustering","category":"etc"}},"authornote":{"id":"8b2419cd-9b30-5409-9d2c-da10779777d4","html":"<p><strong>OpenSesame</strong></p>\n<ul>\n<li>안되면 될 때 까지!</li>\n<li>무분별한 정보 보다는 정확한 정보를 전달하도록 노력하기.</li>\n</ul>"}},"pageContext":{"slug":"/geoserver-clustering/","prev":{"id":"25df67eb-1494-5670-8086-7082d0cad64a","fields":{"slug":"/load-balancing-session-clustering/","prefix":"2020-06-10","source":"posts"},"frontmatter":{"title":"Load Balancing, Session Clustering","category":"infra"}},"next":{"id":"c804ec14-96c3-5817-9f4f-f469d31749ba","fields":{"slug":"/docker-container-setting/","prefix":"2020-06-30","source":"posts"},"frontmatter":{"title":"docker container 기본 설정","category":"infra"}},"source":"posts"}},"staticQueryHashes":["960164547","960164547"]}