{"componentChunkName":"component---src-templates-post-template-js","path":"/blocking-io-and-non-blocking-io/","result":{"data":{"post":{"id":"deba0005-8605-547e-bbcf-d28c787f5f2f","html":"<h3>리액티브 시스템과 리액티브 프로그래밍</h3>\n<ul>\n<li><code class=\"language-text\">reactive</code> 의 사전적 의미에는 ‘반응을 하는’이라는 뜻이 있다. 즉, 어떤 이벤트나 상황이 발생했을 때, 반응을 해서 그에 따라 적절하게 행동하는 것을 의미한다.</li>\n<li>리액티브 시스템은 <strong>반응을 잘하는 시스템</strong>이다. 다시 말해서 <strong>클라이언트의 요청에 즉각적으로 응답함으로써 지연 시간을 최소화한다.</strong></li>\n</ul>\n<h3>리액티브 스트림즈(Reactive Streams)란?</h3>\n<ul>\n<li>데이터 스트림을 Non-Blocking 이면서 비동기적인 방식으로 처리하기 위한 리액티브 라이브러리의 표준 사양</li>\n<li>\n<p>리액티브 스트림즈를 구현한 구현체로 RxJava, Reactor, Akka Streams, Java 9 Flow API 등이 있다.</p>\n<ul>\n<li><strong>RxJava</strong> 의 Rx 는 Reactive Extensions 라는 의미이다. RxJava 는 .NET 환경의 리액티브 확장 라이브러리를 넷플릭스에서 Java 언어로 포팅하여 만든 JVM 기반의 대표적인 리액티브 확장 라이브러리이다.</li>\n<li><strong>Reactor</strong> 는 스프링팀에 의해 주도적으로 개발된 리액티브 스트림즈의 구현체</li>\n<li><strong>Akka Streams</strong> 는 JVM 상에서 동시성과 분산 애플리케이션을 단순화해 주는 오픈소스 툴킷</li>\n<li><strong>Java 9 Flow API</strong></li>\n<li>\n<p>다른 라이브러리처럼 리액티브 스트림즈를 구현한 구현체가 아니라 리액티브 표준 사양의 SPI(Service Provider Interface)로써 Java API 에 정의되어 있다.</p>\n<ul>\n<li>자바에서 사용되는 JDBC 를 예로들면 JDBC 는 사용자 입장에서는 API 가 되지만 JDBC 인터페이스를 구현해야 하는 벤더 입장에서 JDBC 는 SPI 가 된다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3>리액티브 스트림즈 구성요소</h3>\n<br>\n<table>\n<thead>\n<tr>\n<th>컴포넌트</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Publisher</td>\n<td>데이터를 생성하고 통지(발행, 게시, 방출)하는 역할</td>\n</tr>\n<tr>\n<td>Subscriber</td>\n<td>구독한 Publisher 로 부터 통지된 데이터를 전달받아서 처리하는 역할</td>\n</tr>\n<tr>\n<td>Subscription</td>\n<td>Publisher 에 요청할 데이터의 개수를 지정하고, 데이터의 구독을 취소하는 역할을 한다.</td>\n</tr>\n<tr>\n<td>Processor</td>\n<td>Publisher 와 Subscriber 의 기능을 모두 가지고 있다. 즉, Subscriber 로서 다른 Publisher 를 구독할 수 있고, Publisher 로서 다른 Subscriber 가 구독할 수 있다.</td>\n</tr>\n</tbody>\n</table>\n<br>\n<ul>\n<li>Publisher 와 Subscriber 의 동작 과정\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8cdb9f10dea7b0f9acb14a3c32a3cef8/48ca3/reactive-streams-flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 74.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJ0lEQVR42pVT2ZLaQBDj/78u2aSSxWAb8H2Nb2xjm47UwAJvWVd1ja9RqyXNZhxHKfJcqsrIvMzC63q9/lfxmueLlGUpRZFL33eyaZtGfn38EMex5XK5yHeveZ7F3u/l98dPSdNYNo+Xy7KQmlzXFcv6wmTVbzOaPf6bMFVpDJgZqatSzuceZCZtoIDTNInvneR0dCXAGoae+D7WwJcAaxwGYjCSKQpIUwKskCSOJI1j/YfVde0TkKP6vieua4t/OioI7w8HR44HFyPtsDri4Rsb+95R4iiUKAoUOM8zaSDdF+D5fMYGGx9DydJEDBgMfa8ic5w8S9HEA/MAYJ6CRrgnYAzACqZ0XfcE7LGJDBJ0LdAtwSh0jUDsfktBKT02LcusRT21LrMwKSRFzRVwIEPXAbsY3YwkSSwBtfFRoa9yBLhPokj1MyZXQ1iVKVHmnSEfnJ2lupBR29bfjs8wDE+GBHSdm4YctWnqZ3hRHI1RmaZbjeOgMVrm2/jrurwD8geyMzpOcRuLGuaprqfTAU5biNVB3XfsnbrP5xByVPifpF4ARxiQSQrt9tZWN+ysT7G2f2X7+UfBaBaNoaN1XUmDYriZTZrWvsaGwR6H8T7iuzZ8l2ODbVsqy6Nu2XTV+RWn621kalYUmWSMCSpNEg0s39Eksiru8aGzlKK4m8dDQVBq/8WwbVsdl5XdiwbxsDPo1JRntkVjBUMjjswx67q+H8lKAf8BwJV59p3LegUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"reactive-streams-flow\"\n        title=\"\"\n        src=\"/static/8cdb9f10dea7b0f9acb14a3c32a3cef8/5a190/reactive-streams-flow.png\"\n        srcset=\"/static/8cdb9f10dea7b0f9acb14a3c32a3cef8/772e8/reactive-streams-flow.png 200w,\n/static/8cdb9f10dea7b0f9acb14a3c32a3cef8/e17e5/reactive-streams-flow.png 400w,\n/static/8cdb9f10dea7b0f9acb14a3c32a3cef8/5a190/reactive-streams-flow.png 800w,\n/static/8cdb9f10dea7b0f9acb14a3c32a3cef8/48ca3/reactive-streams-flow.png 1084w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>리액티브 스트림즈는 다음과 같은 4개의 컴포넌트로 이루어져있다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d53d7091c1fa8bb7eb9c710d38632341/98b6e/reactive-streams-component.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 372px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 59.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABv0lEQVR42o2S2W7bMBBF+TXpW/uWwjEsibJlbdROSdZi7U6ApCiKov9/S7IR4Bht0oeDmSGGl7OQfP7yFTs6wXjYgJp73N+LeKdB0/RXq4FSKvwdttstTGqq883mAabI13VD+ZK7u08g3mGHYxLBfn5GX0YoixiVpIzRVJmyBQ/Q1hx5FiAObUTBESGTWPAcA7alKQ7mFiTyDcSxhWDpwYYznqYKXZthHkqc6wRZfFQU3BPWRhzsFUl4QMRMBJ6B0KcKGRMmDmJPR8oZ+DRialJx2ccpZyJhD8/egbk6fEdTVgq8BwmVQ1EXDN+/LSj7E9LQUi/+qcRS1axV3HJdoYSsh5Gr4chDRL9+4rEvMPYlxi7HpGyhhG8v/w2yJgWCRMyzqHPwlx+YOo55rLBMNS5zg1KMQbb8oeB1wFwDWWZhWBK0lUAsRS5ILuV/qnvT8irIswPmS4S+zXER1XVN9mZWHwkTuRCFCHzxpzi3MD8lSnAaThjk/CIL8jcE/mvuO5DY17EiF5OnJpYlxChaHZoYs5hlxR1Enobr3H9BqOdixXAc2ClDcamQtR3yvkfRD8I/Y898UNfBdf4tpmvjN1MyxNlfdOsZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"reactive-streams-component\"\n        title=\"\"\n        src=\"/static/d53d7091c1fa8bb7eb9c710d38632341/98b6e/reactive-streams-component.png\"\n        srcset=\"/static/d53d7091c1fa8bb7eb9c710d38632341/772e8/reactive-streams-component.png 200w,\n/static/d53d7091c1fa8bb7eb9c710d38632341/98b6e/reactive-streams-component.png 372w\"\n        sizes=\"(max-width: 372px) 100vw, 372px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h3>Publisher</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Publisher</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Subscriber</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>subscribe 메서드는 파라미터로 전달받은 Subscriber 를 등록하는 역할을 한다.</li>\n<li>개념상으로는 Subscriber 가 구독하는 것이 맞지만 실제 코드상에서는 위의 코드처럼 Publisher 가 subscribe 메서드의 파라미터인 Subscriber 를 등록하는 형태로 구독이 이루어진다.</li>\n</ul>\n<h3>Subscriber</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Subscriber</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onSubscribe</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Subscription</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onNext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onComplete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><strong>onSubscribe</strong> 메서드는 구독 시작 시점에 어떤 처리를 하는 역할을 한다. 여기서의 처리는 Publisher 에게 요청할 데이터의 개수를 지정하거나 구독을\n해지하는 것을 의미하고, 이것은 파라미터로 전달 되는 Subscription 객체를 통해서 이루어진다.</li>\n<li><strong>onNext</strong> 메서드는 Publisher 가 통지한 데이터를 처리하는 역할을 한다.</li>\n<li><strong>onError</strong> 메서드는 Publisher 가 데이터 통지를 위한 처리 과정에서 에러가 발생했을 때 해당 에러를 처리하는 역할을 한다.</li>\n<li><strong>onComplete</strong> 메서드는 Publisher 가 데이터 통지를 완료했음을 알릴 때 호출되는 메서드이다. 데이터 통지가 정상적으로 완료될 경우에 어떤 후처리를\n해야 한다면 이 메서드에서 처리 코드를 작성하면 된다.</li>\n</ul>\n<h3>Subscription</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Subscription</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Subscription 인터페이스는 Subscriber 가 구독한 데이터의 개수를 요청하거나 또는 데이터 요청의 취소, 즉 구독을 해지하는 역할을 한다.</li>\n<li>request 메서드를 통해서 Publisher 에게 데이터의 개수를 요청할 수 있고, cancel 메서드를 통해 구독을 해지할 수 있다.</li>\n</ul>\n<h3>Processor</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Processor</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Subscriber</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Publisher</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Processor 의 경우 별도로 구현해야 하는 메소드가 없다. 다른 인터페이스와 다른 점은 Subscriber 인터페이스와 Publisher 인터페이스를 상속한다는 것이다.\n이는 Processor 가 Publisher 와 Subscriber 의 기능을 모두 가지고 있기 때문이다.</li>\n</ul>\n<h3>리액티브 스트림즈 관련 용어 정의</h3>\n<ul>\n<li>\n<p>Signal</p>\n<ul>\n<li>Publisher 와 Subscriber 간에 주고받는 상호작용을 의미한다.</li>\n<li>onSubscribe, onNext, onComplete, onError, request 또는 cancel 메서드를 Signal 이라고 표현한다.</li>\n<li><strong>onSubscribe, onNext, onComplete, onError 메서드는 Subscriber 인터페이스에 정의되지만 이 메서드들을 실제 호출해서\n사용하는 주체는 Publisher 이기 때문에 Publisher 가 Subscriber 에게 보내는 Signal 이라고 볼 수 있다.</strong></li>\n<li><strong>request 와 cancel 메서드는 Subscription 인터페이스 코드에 정의되지만 이 메서드들을 실제로 사용하는 주체는\nSubscriber 이므로 Subscriber 가 Publisher 에게 보내는 Signal 이라고 볼 수 있다.</strong></li>\n</ul>\n</li>\n<li>\n<p>Demand</p>\n<ul>\n<li>Subscriber 가 Publisher 에게 요청하는 데이터로, Publisher 가 아직 Subscriber 에게 전달하지 않는 Subscriber 가 요청한 데이터를 말한다.</li>\n</ul>\n</li>\n<li>\n<p>Emit</p>\n<ul>\n<li>우리말로 해석하면 ‘방출하다’의 의미인데, ‘데이터를 내보내다’정도로 이해하면 될 것 같다.</li>\n<li>Publisher 가 emit 하는 Signal 중에서 데이터를 전달하기 위한 onNext Signal 을 데이터를 emit 한다고 표현하기도 한다.</li>\n</ul>\n</li>\n</ul>\n<h3>webFlux + Reactor VS webFlux + coroutine</h3>\n<ul>\n<li>웹플럭스를 공부하다보니 코틀린을 사용하면 코루틴을 사용하면 Reactor 를 안써도 되지 않을까?라는 생각이 들었다. Reactor 가 지원하는 Operator 가\n많긴 하지만 코드를 작성하다보면 콜백지옥에 빠지는걸 많이 봤기 때문에…</li>\n<li>\n<p>이것 저것 검색을 해보니 단일 비동기 처리를 하거나 코드의 가독성이 중요하다면 코루틴을, 복잡한 데이터 스트림을 다루거나 Backpressure 가 필요하다면\n리액터를 추천한다는 내용이 많았다.</p>\n<ul>\n<li><a href=\"https://techblog.woowahan.com/7349/\">배민광고리스팅 개발기(feat. 코프링과 DSL 그리고 코루틴)</a></li>\n</ul>\n</li>\n<li>그리고 지금 회사는 코틀린을 사용하지만 자바를 사용하는 회사가 훨씬 많을테니… 리액터를 공부해두는게 더 나을 것 같다는 생각이 든다.</li>\n</ul>\n<h3>spring webMVC 와 webFlux 비교</h3>\n<ul>\n<li>\n<p>webMvc(Blocking I/O)</p>\n<ul>\n<li>api 는 테스트를 위해 요청시 5초 딜레이를 주도록 설정</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@RestController</span>\n<span class=\"token annotation builtin\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/v1/books\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">SpringMvcBranchOfficeController</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> bookMap<span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>Long<span class=\"token punctuation\">,</span> Book<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation builtin\">@ResponseStatus</span><span class=\"token punctuation\">(</span>HttpStatus<span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation builtin\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/{book-id}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation builtin\">@Throws</span><span class=\"token punctuation\">(</span>InterruptedException<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">getBook</span><span class=\"token punctuation\">(</span><span class=\"token annotation builtin\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"book-id\"</span><span class=\"token punctuation\">)</span> bookId<span class=\"token operator\">:</span> Long<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ResponseEntity<span class=\"token operator\">&lt;</span>Book<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 테스트를 위해 5초 딜레이</span>\n        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> book<span class=\"token operator\">:</span> Book<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> bookMap<span class=\"token punctuation\">[</span>bookId<span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword\">return</span> ResponseEntity<span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>book<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>실행</p>\n<ul>\n<li>테스트를 위해 bookMap 이라는 임시 데이터를 생성하고 컨트롤러에 주입해주었다.</li>\n<li>run 메소드를 통해 application 이 실행되면 5번의 api 요청을 한다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@SpringBootApplication</span>\n<span class=\"token keyword\">class</span> SpringMvcBranchOfficeApplication <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation builtin\">@Bean</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">bookMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>Long<span class=\"token punctuation\">,</span> Book<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> bookMap<span class=\"token operator\">:</span> MutableMap<span class=\"token operator\">&lt;</span>Long<span class=\"token punctuation\">,</span> Book<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">HashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1L</span><span class=\"token operator\">..</span><span class=\"token number\">2000000L</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            bookMap<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">Book</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">\"IT Book<span class=\"token interpolation variable\">$i</span>\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> bookMap\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation builtin\">@Bean</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">restTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> RestTemplateBuilder <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">RestTemplateBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation builtin\">@Bean</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> CommandLineRunner <span class=\"token punctuation\">{</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"# 요청 시작 시간: {}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> book <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBook</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span><span class=\"token function\">toLong</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}: book name: {}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> book<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getBook</span><span class=\"token punctuation\">(</span>bookId<span class=\"token operator\">:</span> Long<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Book<span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> restTemplate <span class=\"token operator\">=</span> <span class=\"token function\">RestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> baseUri <span class=\"token operator\">=</span> UriComponentsBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">scheme</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">host</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">port</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/v1/books\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">toUri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> getBooksUri <span class=\"token operator\">=</span> UriComponentsBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">fromUri</span><span class=\"token punctuation\">(</span>baseUri<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/{book-id}\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">expand</span><span class=\"token punctuation\">(</span>bookId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">toUri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// http://localhost:8080/v1/books/{book-id}</span>\n\n        <span class=\"token keyword\">val</span> response <span class=\"token operator\">=</span>\n            restTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">getForEntity</span><span class=\"token punctuation\">(</span>getBooksUri<span class=\"token punctuation\">,</span> Book<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> book <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>body\n\n        <span class=\"token keyword\">return</span> book\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">companion</span> <span class=\"token keyword\">object</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token annotation builtin\">@JvmStatic</span>\n        <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>args<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            SpringApplication<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>SpringMvcBranchOfficeApplication<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> logger <span class=\"token keyword\">by</span> <span class=\"token function\">lazyLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>api 에서 5초의 딜레이를 주고 있고 동기 방식으로 호출되고 있기 때문에 모든 요청이 완료되는데는 약 25초정도가 소요된다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/376bc69d96ff9b295bb0a723de8dea21/ae953/web-mvc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 11.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaUlEQVR42j2MSQqAMBAE/YV6ikggm2SP//9Z2xPUw1CzdS29d+ScIWytwXiN6DKUUjhYISXs1mErBRv/ds4reXqPXuvMFt4qe2stljHGXAhFaoJG8vUXXiJxFDLwSVdShLdk3rwIY4x4AOYKPHHoGH+xAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"web-mvc\"\n        title=\"\"\n        src=\"/static/376bc69d96ff9b295bb0a723de8dea21/5a190/web-mvc.png\"\n        srcset=\"/static/376bc69d96ff9b295bb0a723de8dea21/772e8/web-mvc.png 200w,\n/static/376bc69d96ff9b295bb0a723de8dea21/e17e5/web-mvc.png 400w,\n/static/376bc69d96ff9b295bb0a723de8dea21/5a190/web-mvc.png 800w,\n/static/376bc69d96ff9b295bb0a723de8dea21/ae953/web-mvc.png 1132w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>\n<p>webFlux(Non-Blocking I/O)</p>\n<ul>\n<li>여기도 mvc 에서와 동일하게 5초의 딜레이를 준다.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/v1/books\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation builtin\">@RestController</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">SpringReactiveBranchOfficeController</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> bookMap<span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>Long<span class=\"token punctuation\">,</span> Book<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation builtin\">@ResponseStatus</span><span class=\"token punctuation\">(</span>HttpStatus<span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation builtin\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/{book-id}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation builtin\">@Throws</span><span class=\"token punctuation\">(</span>InterruptedException<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">getBook</span><span class=\"token punctuation\">(</span><span class=\"token annotation builtin\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"book-id\"</span><span class=\"token punctuation\">)</span> bookId<span class=\"token operator\">:</span> Long<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Mono<span class=\"token operator\">&lt;</span>Book<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> book<span class=\"token operator\">:</span> Book <span class=\"token operator\">=</span> bookMap<span class=\"token punctuation\">[</span>bookId<span class=\"token punctuation\">]</span> <span class=\"token operator\">?:</span> <span class=\"token keyword\">throw</span> <span class=\"token function\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"not found bookId = <span class=\"token interpolation variable\">$bookId</span>\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> Mono<span class=\"token punctuation\">.</span><span class=\"token function\">just</span><span class=\"token punctuation\">(</span>book<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>실행</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@SpringBootApplication</span>\n<span class=\"token keyword\">class</span> SpringReactiveBranchOfficeApplication <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation builtin\">@Bean</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">bookMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>Long<span class=\"token punctuation\">,</span> Book<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> bookMap<span class=\"token operator\">:</span> MutableMap<span class=\"token operator\">&lt;</span>Long<span class=\"token punctuation\">,</span> Book<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">HashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1L</span><span class=\"token operator\">..</span><span class=\"token number\">2000000L</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            bookMap<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">Book</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">\"IT Book<span class=\"token interpolation variable\">$i</span>\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> bookMap\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation builtin\">@Bean</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> CommandLineRunner <span class=\"token punctuation\">{</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"# 요청 시작 시간: {}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">getBook</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span><span class=\"token function\">toLong</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span> <span class=\"token punctuation\">{</span> book <span class=\"token operator\">-></span>\n                logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}: book name: {}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> book<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getBook</span><span class=\"token punctuation\">(</span>bookId<span class=\"token operator\">:</span> Long<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Mono<span class=\"token operator\">&lt;</span>Book<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> baseUri <span class=\"token operator\">=</span> UriComponentsBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">scheme</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">host</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">port</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/v1/books\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">toUri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> getBooksUri <span class=\"token operator\">=</span> UriComponentsBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">fromUri</span><span class=\"token punctuation\">(</span>baseUri<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/{book-id}\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">expand</span><span class=\"token punctuation\">(</span>bookId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">toUri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// http://localhost:8080/v1/books/{book-id}</span>\n\n        <span class=\"token keyword\">return</span> WebClient<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">uri</span><span class=\"token punctuation\">(</span>getBooksUri<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">retrieve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">bodyToMono</span><span class=\"token punctuation\">(</span>Book<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">companion</span> <span class=\"token keyword\">object</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token annotation builtin\">@JvmStatic</span>\n        <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>args<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            SpringApplication<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>SpringReactiveBranchOfficeApplication<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> logger <span class=\"token keyword\">by</span> <span class=\"token function\">lazyLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>webFlux 는 비동기 방식으로 동작하기 때문에 약 5초안에 모든 요청이 완료된다.</li>\n<li>webMvc 의 로그를 보면 모두 main 스레드에서 수행되지만 webFlux 에서는 각 요청이 별도의 스레드에서 실행되는것을 알 수 있다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/11ebb324a10b1c84aded96f38fe3dd66/ae953/web-flux.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 11.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcUlEQVR42h2OSw7EIAxDe4tmtqNK0OEbINz/Zh6HhRUptl9yrbXQWsMYA3NOhN+DFApijCilIOUMcdEX5j6t4+4d3/fF4FTuVfXIO9feG52Gw5YthPQgh4pMiPHYARIs9IU56YqbZQdOwszswPyhWiv+DgY86yXHFqIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"web-flux\"\n        title=\"\"\n        src=\"/static/11ebb324a10b1c84aded96f38fe3dd66/5a190/web-flux.png\"\n        srcset=\"/static/11ebb324a10b1c84aded96f38fe3dd66/772e8/web-flux.png 200w,\n/static/11ebb324a10b1c84aded96f38fe3dd66/e17e5/web-flux.png 400w,\n/static/11ebb324a10b1c84aded96f38fe3dd66/5a190/web-flux.png 800w,\n/static/11ebb324a10b1c84aded96f38fe3dd66/ae953/web-flux.png 1132w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<h3>Blocking I/O 와 Non-Blocking I/O 의 특징</h3>\n<ul>\n<li>\n<p>Blocking I/O</p>\n<ul>\n<li>작업 스레드의 작업이 종료될 때까지 요청 스레드가 차단된다.</li>\n<li>스레드가 차단되는 문제를 보완하기 위해 멀티스레딩 기법을 사용할 수 있다.</li>\n<li>멀티스레딩 기법 사용 시 컨텍스트 스위칭 전환 비용, 메모리 사용 오버헤드, 스레드 풀의 응답 지연 등의 문제가 발생할 수있다.</li>\n</ul>\n</li>\n<li>\n<p>Non-Blocking I/O</p>\n<ul>\n<li>작업 스레드의 종료 여부와 상관없이 요청 스레드가 차단되지 않는다.</li>\n<li>적은 수의 스레드만 사용해 스레드 전환 비용이 적으므로, CPU 를 효율적으로 사용할 수 있다.</li>\n<li><strong>CPU 를 많이 사용하는 작업의 경우에는 성능에 악영향을 미칠 수 있다.</strong></li>\n<li>사용자 요청 처리에서 응답까지 전 과정이 Non-Blocking 이어야 제대로 된 효과를 얻을 수 있다.</li>\n<li>webFlux 사용한다고 하고 .block() 으로 동기식으로 처리하면 그냥 webMvc 쓰는게 나을 것 같다는 생각이 든다.</li>\n<li>하지만 .block() 을 어쩔 수 없이 사용했던 경우가 있었는데 클라이언트에서 api 요청 후 동기식으로 기다리는 경우 클라이언트의 요청이 끊기게 되면 api 요청이 cancel 되는 경우가 있어서\nblock 을 사용했던 적이 있다. 클라이언트까지 비동기로 처리를 해야 책에 있는 것처럼 제대로 된 효과를 얻을 수 있을 것 같다고 생각한다.</li>\n</ul>\n</li>\n</ul>\n<h3>Reference</h3>\n<ul>\n<li>스프링으로 시작하는 리액티브 프로그래밍</li>\n<li><a href=\"https://github.com/bingbingpa/dev-book/tree/main/spring-reactive/src/main/kotlin/me/bingbingpa/ch03\">사용한 샘플 코드</a></li>\n</ul>","fields":{"slug":"/blocking-io-and-non-blocking-io/","prefix":"2024-02-02"},"frontmatter":{"title":"reactive streams 개념 정리와 spring webMVC 와 webFlux 코드 비교","category":"spring-reactive"}},"authornote":{"id":"265dda60-7971-5464-926f-ea569c79ac0a","html":"<p>🔘 안되면 될 때 까지! 🏃 🔘</p>"}},"pageContext":{"slug":"/blocking-io-and-non-blocking-io/","prev":{"id":"1017c77c-64ca-5ccd-bd05-a37b8007873f","fields":{"slug":"/spring-async-config/","prefix":"2022-02-06","source":"posts"},"frontmatter":{"title":"스프링 Async multi config 설정하기","category":"spring"}},"next":{"id":"456a81af-cfd5-5c27-bab3-fa06318692d6","fields":{"slug":"/noname/","prefix":"2024-02-10","source":"posts"},"frontmatter":{"title":"Reactor 개요와 마블다이어그램","category":"spring-reactive"}},"source":"posts"}},"staticQueryHashes":["960164547","960164547"]}