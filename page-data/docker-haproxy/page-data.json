{"componentChunkName":"component---src-templates-post-template-js","path":"/docker-haproxy/","result":{"data":{"post":{"id":"4117ac20-e72f-5588-8baa-28119592f9a8","html":"<h3>1. DockerFile 작성</h3>\n<ul>\n<li>centos 에서 dnf 로 haproxy 를 설치하면 1.8.5 버전인가가 설치된다. 현재 최신 버전은 2.1.5 버전인데… 그래서 소스를 받아서 컴파일 해야한다.</li>\n<li>haproxy docker image 로 테스트 하면 되지만 우리가 쓰는 서버는 다 centos 다 보니 이런 삽질을 했다.</li>\n<li>haproxy 를 컴파일하고 유저 만들고 이런건 되는데 systemctl 이 안되서 서비스 등록은 불가능하고 딱 설치까지만 삽질한 내용을 정리해본다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\">    <span class=\"token instruction\"><span class=\"token keyword\">FROM</span> centos:8</span>\n\n    <span class=\"token instruction\"><span class=\"token keyword\">ENV</span> HAPROXY_MJR_VERSION=2.1 <span class=\"token operator\">\\</span>\n        HAPROXY_VERSION=2.1.5</span>\n\n    <span class=\"token instruction\"><span class=\"token keyword\">RUN</span> <span class=\"token operator\">\\</span>\n        dnf install -y epel-release &amp;&amp; <span class=\"token operator\">\\</span>\n        dnf update -y &amp;&amp; <span class=\"token operator\">\\</span>\n        dnf install -y passwd &amp;&amp; dnf install -y sudo &amp;&amp; dnf install -y ncurses &amp;&amp; <span class=\"token operator\">\\</span>\n        <span class=\"token comment\"># haproxy 컴파일을 위한 패키지 추가(USER_SYSTEMD로 컴파일하기 위해 systemd-devel 패키지 필수)</span>\n        dnf install -y inotify-tools wget tar gzip make gcc perl pcre-devel zlib-devel systemd-devel &amp;&amp; <span class=\"token operator\">\\</span>\n        <span class=\"token comment\"># haproxy download &amp; install</span>\n        wget -O /tmp/haproxy.tgz http://www.haproxy.org/download/<span class=\"token variable\">${HAPROXY_MJR_VERSION}</span>/src/haproxy-<span class=\"token variable\">${HAPROXY_VERSION}</span>.tar.gz &amp;&amp; <span class=\"token operator\">\\</span>\n        tar -zxvf /tmp/haproxy.tgz -C /tmp &amp;&amp; <span class=\"token operator\">\\</span>\n        cd /tmp/haproxy-* &amp;&amp; <span class=\"token operator\">\\</span>\n        make TARGET=linux-glibc USE_PCRE=1USE_ZLIB=1 USE_SYSTEMD=1 &amp;&amp; <span class=\"token operator\">\\</span>\n        make install &amp;&amp; <span class=\"token operator\">\\</span>\n        <span class=\"token comment\"># 폴더 생성 및 유저 생성</span>\n        mkdir -p /var/lib/haproxy &amp;&amp; <span class=\"token operator\">\\</span>\n        mkdir -p /var/log/haproxy &amp;&amp; <span class=\"token operator\">\\</span>\n        mkdir -p /etc/haproxy/certs &amp;&amp; <span class=\"token operator\">\\</span>\n        mkdir -p /etc/haproxy/errors &amp;&amp; <span class=\"token operator\">\\</span>\n        groupadd haproxy &amp;&amp; adduser haproxy -g haproxy &amp;&amp; chown -R haproxy:haproxy /var/lib/haproxy &amp;&amp; <span class=\"token operator\">\\</span>\n        adduser -m gaia3d &amp;&amp; <span class=\"token operator\">\\</span>\n        <span class=\"token comment\"># 설치파일 제거</span>\n        rm -rf /tmp/haproxy* &amp;&amp; <span class=\"token operator\">\\</span>\n        dnf remove -y make gcc pcre-devel &amp;&amp; <span class=\"token operator\">\\</span>\n        dnf clean all &amp;&amp; rm -rf /var/cache/dnf</span></code></pre></div>\n<h3>2. service 등록</h3>\n<ul>\n<li>/usr/lib/systemd/system 경로에 service 파일 작성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\">    <span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\n    Description<span class=\"token operator\">=</span>HAProxy Load Balancer\n    After<span class=\"token operator\">=</span>network<span class=\"token operator\">.</span>target\n\n    <span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\n    Environment<span class=\"token operator\">=</span><span class=\"token string\">\"CONFIG=/etc/haproxy/haproxy.cfg\"</span> <span class=\"token string\">\"PIDFILE=/run/haproxy.pid\"</span>\n    ExecStartPre<span class=\"token operator\">=</span>haproxy <span class=\"token operator\">-</span><span class=\"token keyword\">f</span> $CONFIG <span class=\"token operator\">-</span><span class=\"token keyword\">c</span> <span class=\"token operator\">-</span><span class=\"token keyword\">q</span>\n    ExecStart<span class=\"token operator\">=</span>haproxy <span class=\"token operator\">-</span>Ws <span class=\"token operator\">-</span><span class=\"token keyword\">f</span> $CONFIG <span class=\"token operator\">-</span><span class=\"token keyword\">p</span> $PIDFILE\n    ExecReload<span class=\"token operator\">=</span>haproxy <span class=\"token operator\">-</span><span class=\"token keyword\">f</span> $CONFIG <span class=\"token operator\">-</span><span class=\"token keyword\">c</span> <span class=\"token operator\">-</span><span class=\"token keyword\">q</span>\n    ExecReload<span class=\"token operator\">=</span><span class=\"token operator\">/</span><span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>kill <span class=\"token operator\">-</span>USR2 $MAINPID\n    KillMode<span class=\"token operator\">=</span>mixed\n    Type<span class=\"token operator\">=</span>notify\n\n    <span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\n    WantedBy<span class=\"token operator\">=</span>multi<span class=\"token operator\">-</span>user<span class=\"token operator\">.</span>target</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">    systemctl daemon-reload</code></pre></div>\n<h3>3. haproxy.cfg 파일 작성</h3>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\">    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    # Global settings\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    global\n        # <span class=\"token keyword\">to</span> have these messages end <span class=\"token keyword\">up</span> <span class=\"token keyword\">in</span> <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>haproxy<span class=\"token operator\">.</span>log you will\n        # need <span class=\"token keyword\">to</span><span class=\"token punctuation\">:</span>\n        #\n        # <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> configure syslog <span class=\"token keyword\">to</span> accept network log events<span class=\"token operator\">.</span>  This <span class=\"token operator\">is</span> done\n        #    by adding the <span class=\"token string\">'-r'</span> option <span class=\"token keyword\">to</span> the SYSLOGD_OPTIONS <span class=\"token keyword\">in</span>\n        #    <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>sysconfig<span class=\"token operator\">/</span>syslog\n        #\n        # <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> configure local2 events <span class=\"token keyword\">to</span> <span class=\"token keyword\">go</span> <span class=\"token keyword\">to</span> the <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>haproxy<span class=\"token operator\">.</span>log\n        #   <span class=\"token keyword\">file</span><span class=\"token operator\">.</span> A line like the following can <span class=\"token keyword\">be</span> added <span class=\"token keyword\">to</span>\n        #   <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>sysconfig<span class=\"token operator\">/</span>syslog\n        #\n        #    local2<span class=\"token operator\">.</span><span class=\"token operator\">*</span>                       <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>haproxy<span class=\"token operator\">.</span>log\n        #\n        log         <span class=\"token number\">127.0</span><span class=\"token operator\">.</span><span class=\"token number\">0.1</span> local2\n\n        chroot      <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>haproxy\n        pidfile     <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>run<span class=\"token operator\">/</span>haproxy<span class=\"token operator\">.</span>pid\n        maxconn     <span class=\"token number\">4000</span>\n        user        haproxy\n        group       haproxy\n        daemon\n\n        # turn <span class=\"token keyword\">on</span> stats unix socket\n        stats socket <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>haproxy<span class=\"token operator\">/</span>stats\n\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    # common defaults that <span class=\"token keyword\">all</span> the <span class=\"token string\">'listen'</span> and <span class=\"token string\">'backend'</span> <span class=\"token builtin\">sections</span> will\n    # use <span class=\"token keyword\">if</span> not designated <span class=\"token keyword\">in</span> their block\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    defaults\n        <span class=\"token keyword\">mode</span>                    http\n        log                     global\n        option                  httplog\n        option                  dontlognull\n        option http<span class=\"token operator\">-</span>server<span class=\"token operator\">-</span><span class=\"token keyword\">close</span>\n        option forwardfor       except <span class=\"token number\">127.0</span><span class=\"token operator\">.</span><span class=\"token number\">0.0</span><span class=\"token operator\">/</span><span class=\"token number\">8</span>\n        option                  redispatch\n        retries                 <span class=\"token number\">3</span>\n        <span class=\"token builtin\">timeout</span> http<span class=\"token operator\">-</span>request    10s\n        <span class=\"token builtin\">timeout</span> queue           1m\n        <span class=\"token builtin\">timeout</span> connect         10s\n        <span class=\"token builtin\">timeout</span> client          1m\n        <span class=\"token builtin\">timeout</span> server          1m\n        <span class=\"token builtin\">timeout</span> http<span class=\"token operator\">-</span>keep<span class=\"token operator\">-</span>alive 10s\n        <span class=\"token builtin\">timeout</span> check           10s\n        maxconn                 <span class=\"token number\">3000</span>\n\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    # main frontend which proxys <span class=\"token keyword\">to</span> the backends\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    frontend main\n        bind <span class=\"token operator\">*</span><span class=\"token punctuation\">:</span><span class=\"token number\">80</span>\n        stats uri <span class=\"token operator\">/</span>haproxy<span class=\"token operator\">?</span>stats\n        acl url_static       path_beg       <span class=\"token operator\">-</span>i <span class=\"token operator\">/</span>static <span class=\"token operator\">/</span>images <span class=\"token operator\">/</span>javascript <span class=\"token operator\">/</span>stylesheets\n        acl url_static       path_end       <span class=\"token operator\">-</span>i <span class=\"token operator\">.</span>jpg <span class=\"token operator\">.</span>gif <span class=\"token operator\">.</span>png <span class=\"token operator\">.</span>css <span class=\"token operator\">.</span><span class=\"token builtin\">js</span>\n\n        use_backend static          <span class=\"token keyword\">if</span> url_static\n        default_backend             app\n\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    # static backend <span class=\"token keyword\">for</span> serving <span class=\"token keyword\">up</span> images<span class=\"token punctuation\">,</span> stylesheets and such\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    backend static\n        balance     roundrobin\n        server      static <span class=\"token number\">127.0</span><span class=\"token operator\">.</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">4331</span> check\n\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    # round robin balancing between the various backends\n    #<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n    backend app\n        balance     roundrobin\n        server  app1 <span class=\"token number\">127.0</span><span class=\"token operator\">.</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">5001</span> check\n        server  app2 <span class=\"token number\">127.0</span><span class=\"token operator\">.</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">5002</span> check\n        server  app3 <span class=\"token number\">127.0</span><span class=\"token operator\">.</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">5003</span> check\n        server  app4 <span class=\"token number\">127.0</span><span class=\"token operator\">.</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">5004</span> check</code></pre></div>\n<h3>4. haproxy start</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">    systemctl start haproxy</code></pre></div>","fields":{"slug":"/docker-haproxy/","prefix":"2020-06-06"},"frontmatter":{"title":"docker 에 haproxy 설치","category":"docker"}},"authornote":{"id":"265dda60-7971-5464-926f-ea569c79ac0a","html":"<p>🔘 안되면 될 때 까지! 🏃 🔘</p>"}},"pageContext":{"slug":"/docker-haproxy/","prev":{"id":"123193c8-7c13-526c-be01-794f0da6553a","fields":{"slug":"/thymeleaf/","prefix":"2020-06-03","source":"posts"},"frontmatter":{"title":"springBoot Thymeleaf","category":"spring"}},"next":{"id":"68581b87-47db-505f-ae3a-8f4e4f8c9ddb","fields":{"slug":"/load-balancing-session-clustering/","prefix":"2020-06-10","source":"posts"},"frontmatter":{"title":"Load Balancing, Session Clustering","category":"infra"}},"source":"posts"}},"staticQueryHashes":["960164547","960164547"]}