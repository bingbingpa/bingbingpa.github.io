{"componentChunkName":"component---src-templates-post-template-js","path":"/docker-compose-use/","result":{"data":{"post":{"id":"4e433ebd-1571-56fa-a744-d771368b0329","html":"<h3>1. docker image 사용하기</h3>\n<ul>\n<li>\n<p>docker hub 에 있는 image 를 받아서 사용</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker container run -d  -p <span class=\"token number\">15432</span>:5432 --name <span class=\"token string\">\"postgres\"</span> -e <span class=\"token assign-left variable\">POSTGRES_PASSWORD</span><span class=\"token operator\">=</span>postgres postgis/postgis:12-master</code></pre></div>\n</li>\n<li>\n<p>문제점</p>\n<ul>\n<li>리눅스에서 기본적으로 사용하던 wget, unzip, clear 명령 등이 없어서 설치해줘야 한다.</li>\n<li>위 이미지는 postgis 만을 위한 image 이므로 다른 것을 사용 하려면 용도에 맞는 이미지를 별도의 container 로 실행시켜야 한다.</li>\n<li>필요에 따라 n 개의 container 를 생성 및 실행하고 각각 관리해야하는 불편함이 있다.</li>\n</ul>\n</li>\n</ul>\n<h3>2. docker image 에 몽땅 넣어 사용하기</h3>\n<ul>\n<li>\n<p>centos image 를 받아서 거기에 db, tomcat, java, rabbitmq 등을 몽땅 설치해서 image 로 배포 해서 사용</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker container run --privileged  -d -p <span class=\"token number\">15432</span>:5432 -p <span class=\"token number\">18080</span>:8080 -v <span class=\"token string\">\"D:\\data\\geoserver\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/data/geoserver_data\"</span> --name <span class=\"token string\">\"mago3d\"</span> gaia3d/mago3d /sbin/init</code></pre></div>\n</li>\n<li>\n<p>문제점</p>\n<ul>\n<li>개발과정에서 발생하는 db 스키마 변경 및 환경 구성을 항상 최신으로 유지하기가 쉽지 않다.</li>\n<li>centos image 위에 모든 것을 설치해서 배포하기 때문에 용량이 크다.</li>\n<li>privileged 권한으로 실행하면서 container 에 불필요한 파일들이 늘어나 용량이 증가한다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ca11d87624d139d177d844cb2c9a43a/c56af/docker-size.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 56.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABfklEQVR42o1Sy3KCQBDci0XAB1gCgiiiKIqo4KP0llP+/5c601tZQqxUJYeueTA709ODqi8XFHGMj8UCzXSKUvxG/Mz3kSQJppKjDYIAs9kM8/lc+2EYIooiBPI9n0xQy7t3ead2ux1WqxWq9RqpNIlHIySeh3AwgNPvo/+CgeR/y1mWpYepsiyRZRliYeGOx7AcB28C+6vwPxgOh98NyZANI6HuC3XPdeEJQ1eYcrojzf/CD4bb7RZFUYBM6e/3e5zPZ201c9GGehHUjqCuxvdFJoIs0zSF4kPicDi09nq9oq5rjYscjfZ4PLaoqkoPZZ4+CS3kIGu5g27IBBsZhozJjsfK8xybzaYFY4K1jNlkuVzqi7Ner0xwZYITqQV1oT62bWt0/S6Yp9a9Xk//XqrbiKuaFY2mhhWZGJb0CW7BVYmJHJSx6hYbjczap9Op1ZYDaPlXGBJ8w0MQZMq11e1208zu9zuezycej4eO2ZjCN03THugVrDGD+Ddw2CfsECagqKKGrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"docker-size\"\n        title=\"\"\n        src=\"/static/5ca11d87624d139d177d844cb2c9a43a/5a190/docker-size.png\"\n        srcset=\"/static/5ca11d87624d139d177d844cb2c9a43a/772e8/docker-size.png 200w,\n/static/5ca11d87624d139d177d844cb2c9a43a/e17e5/docker-size.png 400w,\n/static/5ca11d87624d139d177d844cb2c9a43a/5a190/docker-size.png 800w,\n/static/5ca11d87624d139d177d844cb2c9a43a/c1b63/docker-size.png 1200w,\n/static/5ca11d87624d139d177d844cb2c9a43a/c56af/docker-size.png 1231w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n</li>\n</ul>\n<h3>3. docker compose 를 사용해서 개선하기</h3>\n<ul>\n<li>필요한 환경 구성을 Dockerfile 에 작성하고 docker compose 를 이용해서 관리하기</li>\n</ul>\n<h4>3.1. postgresql</h4>\n<ul>\n<li>postgis image 에 타임존, 디비명, 유저, 패스워드 인코딩, 허용ip 를 설정해준다. 디비명은 변수로 지정한 이름으로 만들어진다.</li>\n<li>\n<p>shell, vim 의 가독성을 위한 설정파일을 복사한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> postgis/postgis:12-master</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> .vimrc /root/.vimrc</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> bashrc /color-config</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> TZ=Asia/Seoul</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> POSTGRES_DB=oim</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> POSTGRES_USER=postgres</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> POSTGRES_PASSWORD=postgres</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> POSTGRES_INITDB_ARGS=<span class=\"token string\">\"--encoding=UTF-8\"</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> ALLOW_IP_RANGE=0.0.0.0/0</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> <span class=\"token operator\">\\</span>\n    apt-get update &amp;&amp; <span class=\"token operator\">\\</span>\n    apt-get install -y vim &amp;&amp; <span class=\"token operator\">\\</span>\n    cat color-config >> /etc/bash.bashrc</span></code></pre></div>\n</li>\n</ul>\n<h4>3.2. geoserver</h4>\n<ul>\n<li>tomcat image 에 geoserver war 를 받아서 압축을 풀고 cors 설정을 해준다.</li>\n<li>\n<p>setenv 파일을 복사하지 않고 ENV 로 geoserver 데이터 경로나 캐시 경로를 설정 해줄 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> tomcat:9.0.38-jdk11-adoptopenjdk-openj9</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> JAVA_OPTS=-D-Xms4096m-Xmx4096m</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> <span class=\"token operator\">\\</span>\n    apt-get update &amp;&amp; <span class=\"token operator\">\\</span>\n    apt-get install -y vim wget unzip &amp;&amp; <span class=\"token operator\">\\</span>\n    rm -rf /usr/local/tomcat/webapps/* &amp;&amp; <span class=\"token operator\">\\</span>\n    cd /tmp &amp;&amp; wget http://sourceforge.net/projects/geoserver/files/GeoServer/2.17.3/geoserver-2.17.3-war.zip &amp;&amp; <span class=\"token operator\">\\</span>\n    unzip /tmp/geoserver-2.17.3-war.zip -d /usr/local/tomcat/webapps &amp;&amp; <span class=\"token operator\">\\</span>\n    rm -rf /tmp/geoserver-2.17.3-war.zip</span>\n\n<span class=\"token comment\"># Enable CORS</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> sed -i <span class=\"token string\">'\\:&lt;/web-app>:i\\\n&lt;filter>\\n\\\n    &lt;filter-name>CorsFilter&lt;/filter-name>\\n\\\n    &lt;filter-class>org.apache.catalina.filters.CorsFilter&lt;/filter-class>\\n\\\n    &lt;init-param>\\n\\\n        &lt;param-name>cors.allowed.origins&lt;/param-name>\\n\\\n        &lt;param-value>*&lt;/param-value>\\n\\\n    &lt;/init-param>\\n\\\n    &lt;init-param>\\n\\\n        &lt;param-name>cors.allowed.methods&lt;/param-name>\\n\\\n        &lt;param-value>GET,POST,HEAD,OPTIONS,PUT&lt;/param-value>\\n\\\n    &lt;/init-param>\\n\\\n&lt;/filter>\\n\\\n&lt;filter-mapping>\\n\\\n    &lt;filter-name>CorsFilter&lt;/filter-name>\\n\\\n    &lt;url-pattern>/*&lt;/url-pattern>\\n\\\n&lt;/filter-mapping>'</span> /usr/local/tomcat/conf/web.xml</span></code></pre></div>\n</li>\n</ul>\n<h4>3.3. rabbitmq</h4>\n<ul>\n<li>rabbitmq 의 관리자 플러그인을 사용하기 위해 기본 rabbitmq 가 아닌 rabbitmq-management image 를 사용한다.</li>\n<li>\n<p>rabbitmq 에서 사용할 사용자와 queue 등을 미리 작성해둔 json 파일을 image 에 복사해서 빌드한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> rabbitmq:3.8.9-management</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> definitions.json /etc/rabbitmq/</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt-get update &amp;&amp; apt-get install -y vim</span></code></pre></div>\n</li>\n</ul>\n<h4>3.4. docker-compose</h4>\n<ul>\n<li>초기 한번은 모든 Dockerfile 을 빌드하여 이미지를 생성하고, 변동 가능성이 적은 geoserver, rabbitmq 등은 만들어진 image 를 docker hub 에 등록하여 해당 image 를 사용한다.</li>\n<li>geoserver, rabbitmq 등의 버전을 변경하거나 Dockerfile 에 변경사항이 있을 경우에는 주석된 build 부분을 해제하고 image 를 주석하고 실행하면 된다.</li>\n<li>db 는 docker-entrypoint-initdb.d 경로에 스크립트나 sql 을 복사해두면 container 가 실행되면서 해당 내용들을 실행시켜준다.</li>\n<li>\n<p>geoserver 에 마운트하는 볼륨은 docker 내부에서 자동으로 관리하도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\">version: '3'\nvolumes:\n  oim-geoserver-data:\n\nservices:\n  db:\n    container_name: oim-db\n    restart: always\n    build:\n      context: ./doc/docker/postgres\n      dockerfile: Dockerfile\n    volumes:\n      - ./doc/database:/database:ro\n      - ./init-user-db.sh:/docker-entrypoint-initdb.d/init-user-db.sh:ro\n    ports:\n      - 15432:5432\n      - 18080:8080\n\n  geoserver:\n    container_name: oim-geoserver\n    restart: always\n    image: gaia3d/geoserver:oim-2.17.3\n<span class=\"token comment\">#    build:</span>\n<span class=\"token comment\">#      context: ./doc/docker/geoserver</span>\n<span class=\"token comment\">#      dockerfile: Dockerfile</span>\n    volumes:\n      - oim-geoserver-data:/geoserver-data\n    network_mode: \"service:db\"\n\n  rabbitmq:\n    container_name: oim-rabbitmq\n    restart: always\n    image: gaia3d/rabbitmq:oim-3.8.9\n<span class=\"token comment\">#    build:</span>\n<span class=\"token comment\">#      context: ./doc/docker/rabbitmq</span>\n<span class=\"token comment\">#      dockerfile: Dockerfile</span>\n    ports:\n      - 5672:5672\n      - 15672:15672</code></pre></div>\n</li>\n</ul>\n<h4>3.5. 실행하기</h4>\n<ul>\n<li>docker-compose.yml 파일이 있는 경로에서 다음 실행</li>\n<li>\n<p>-d 는 백그라운드에서 실행한다는 옵션이고, container 가 생성되고 위에서 설정한 compose 파일에 restart 가 always 로 되어 있으므로, 개발장비가 재부팅 되어도 자동으로 실행 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker-compose up -d</code></pre></div>\n</li>\n</ul>\n<h4>3.6. 변경된 db 반영하기</h4>\n<ul>\n<li>\n<p>-v 옵션을 줘야 docker 에서 사용하는 volume(geoserver-data) 이 모두 삭제된다. geoserver 의 데이터를 유지하고 싶을 경우에는 -v 옵션을 생략한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker-compose down -v\ndocker-compose up --build -d</code></pre></div>\n</li>\n</ul>\n<h4>3.7. geoserver docker 에서 호스트의 파일 사용하기</h4>\n<ul>\n<li>docker-compose 파일의 volume 마운트 하는 부분 “oim-geoserver-data:/geoserver-data” 에서 oim-geoserver-data(docker 내부에서 자동으로 관리하는 volume)을\n로컬 호스트의 경로로 마운트하고 docker-compose up -d —build 으로 실행하여 사용하거나 geoserver container 에 마운트 한 geoserver-data 폴더 안으로 파일을 복사하여 사용 할 수 있다.\n(docker container cp “로컬파일” oim-geoserver:/geoserver-data)</li>\n</ul>\n<h3>4. 삽질한 내용…</h3>\n<ul>\n<li>\n<p>Dockerfile 에 RUN 명령은 가급적 <strong>\\</strong>(개행) 과 <strong>&#x26;&#x26;</strong> 을 써서 하나의 RUN 명령에 이어서 쓰는것이 좋다. RUN, COPY, CMD 등 Dockerfile 에서 사용가능한 명령어 마다 레이어(image) 가 생성되므로, 불필요하게 많은\n레이어가 생성되지 않도록 하기 위해 하나의 RUN 명령에 작성하도록 한다.</p>\n<ul>\n<li>\n<p>RUN 명령 2개로 Dockerfile 을 작성하는 경우</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> <span class=\"token operator\">\\</span>\n    apt-get update &amp;&amp; <span class=\"token operator\">\\</span>\n    apt-get install -y vim wget unzip &amp;&amp; <span class=\"token operator\">\\</span>\n    rm -rf /usr/local/tomcat/webapps/* &amp;&amp; <span class=\"token operator\">\\</span>\n    cd /tmp &amp;&amp; wget http://sourceforge.net/projects/geoserver/files/GeoServer/2.17.3/geoserver-2.17.3-war.zip &amp;&amp; <span class=\"token operator\">\\</span>\n    unzip /tmp/geoserver-2.17.3-war.zip -d /usr/local/tomcat/webapps &amp;&amp; <span class=\"token operator\">\\</span>\n    rm -rf /tmp/geoserver-2.17.3-war.zip</span>\n\n<span class=\"token comment\"># Enable CORS</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> sed -i <span class=\"token string\">'\\:&lt;/web-app>:i\\\n&lt;filter>\\n\\\n    &lt;filter-name>CorsFilter&lt;/filter-name>\\n\\\n    &lt;filter-class>org.apache.catalina.filters.CorsFilter&lt;/filter-class>\\n\\\n    &lt;init-param>\\n\\\n        &lt;param-name>cors.allowed.origins&lt;/param-name>\\n\\\n        &lt;param-value>*&lt;/param-value>\\n\\\n    &lt;/init-param>\\n\\\n    &lt;init-param>\\n\\\n        &lt;param-name>cors.allowed.methods&lt;/param-name>\\n\\\n        &lt;param-value>GET,POST,HEAD,OPTIONS,PUT&lt;/param-value>\\n\\\n    &lt;/init-param>\\n\\\n&lt;/filter>\\n\\\n&lt;filter-mapping>\\n\\\n    &lt;filter-name>CorsFilter&lt;/filter-name>\\n\\\n    &lt;url-pattern>/*&lt;/url-pattern>\\n\\\n&lt;/filter-mapping>'</span> /usr/local/tomcat/conf/web.xml</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f91746a8cfc5635cee81f8009a2c25e2/636c2/run-one.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeklEQVR42l2O2w6CMBBE+RNF5WJiGilIA1ZLKRFE/f/PObZ9Mj7sw86cndlkl5fsiyN6GBGyJs2KuP/O9pBTXRTz+uZuHaKqoyZbxTQ/Ub1Gej9kJeEgzUquxtJ2fQT/A0OJkA3usbC8PnT6xsZzp7P0j1iMm9BmiNwXZEY+l8CjMxsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"run-one\"\n        title=\"\"\n        src=\"/static/f91746a8cfc5635cee81f8009a2c25e2/5a190/run-one.png\"\n        srcset=\"/static/f91746a8cfc5635cee81f8009a2c25e2/772e8/run-one.png 200w,\n/static/f91746a8cfc5635cee81f8009a2c25e2/e17e5/run-one.png 400w,\n/static/f91746a8cfc5635cee81f8009a2c25e2/5a190/run-one.png 800w,\n/static/f91746a8cfc5635cee81f8009a2c25e2/636c2/run-one.png 911w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</li>\n<li>\n<p>하나의 커맨드 마다 RUN 명령을 사용하는 경우</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt-get update</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt-get install -y vim wget unzip</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> rm -rf /usr/local/tomcat/webapps/*</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> cd /tmp &amp;&amp; wget http://sourceforge.net/projects/geoserver/files/GeoServer/2.17.3/geoserver-2.17.3-war.zip</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> unzip /tmp/geoserver-2.17.3-war.zip -d /usr/local/tomcat/webapps</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> rm -rf /tmp/geoserver-2.17.3-war.zip</span>\n\n<span class=\"token comment\"># Enable CORS</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> sed -i <span class=\"token string\">'\\:&lt;/web-app>:i\\\n&lt;filter>\\n\\\n    &lt;filter-name>CorsFilter&lt;/filter-name>\\n\\\n    &lt;filter-class>org.apache.catalina.filters.CorsFilter&lt;/filter-class>\\n\\\n    &lt;init-param>\\n\\\n        &lt;param-name>cors.allowed.origins&lt;/param-name>\\n\\\n        &lt;param-value>*&lt;/param-value>\\n\\\n    &lt;/init-param>\\n\\\n    &lt;init-param>\\n\\\n        &lt;param-name>cors.allowed.methods&lt;/param-name>\\n\\\n        &lt;param-value>GET,POST,HEAD,OPTIONS,PUT&lt;/param-value>\\n\\\n    &lt;/init-param>\\n\\\n&lt;/filter>\\n\\\n&lt;filter-mapping>\\n\\\n    &lt;filter-name>CorsFilter&lt;/filter-name>\\n\\\n    &lt;url-pattern>/*&lt;/url-pattern>\\n\\\n&lt;/filter-mapping>'</span> /usr/local/tomcat/conf/web.xml</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9688b460c97c08ecdba687b584b309ee/2a50c/run-multi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 17.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVR42nWP1xKCMBBF+RNRIJQIFkZEQAZCCVjG9v/fck1Wxxf1YSft7tkTIwgXMG2GcBUj2WWYMY/Kcv1P6fdtXkB0EnGS0h3jIUQvkWQ5eLSkzCbNYEwshqnjElB0PWwv+ALqTFqUOF9v6McjXAVjwRxV26GRA0rRKIYamhUwTAXTwCjeoBvGP0CHgJf7g4aygMNXVvJwwr4SaOVI5juVMaZvIF+sUVT1T+Dry3uyK2tBdo7P1b6hHm2mz4lan5S6feZTQkuyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"run-multi\"\n        title=\"\"\n        src=\"/static/9688b460c97c08ecdba687b584b309ee/5a190/run-multi.png\"\n        srcset=\"/static/9688b460c97c08ecdba687b584b309ee/772e8/run-multi.png 200w,\n/static/9688b460c97c08ecdba687b584b309ee/e17e5/run-multi.png 400w,\n/static/9688b460c97c08ecdba687b584b309ee/5a190/run-multi.png 800w,\n/static/9688b460c97c08ecdba687b584b309ee/2a50c/run-multi.png 925w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</li>\n</ul>\n</li>\n<li>\n<p>Dockerfile 로부터 이미지를 만들 때 docker build 명령은 Dockerfile 을 포함하는 디렉토리(서브디렉토리를 포함한다)를 모두 Docker 데몬으로 전송한다.\n그래서 Dockerfile 의 저장 위치는 빈 디렉토리를 만들고 거기에 Dockerfile 을 놓아두고 이미지를 작성하는 방법을 권장한다.</p>\n<ul>\n<li>Dockerfile 경로에 파일이 없는 경우\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b4093bcd12b801cf2f98c2a6af86f05c/4d383/dockerfile-build1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhklEQVR42l2R23KiQBRF+Y6ZqUQFFLwgCgpya+5gNKTm8jL//yFrujtmKpWHVQ1UsXrvcwxxvxCWe465zz7OiaKCNhYkSYkvOcjnQ5bhhSk7P8A7hkRphh+cWLobVpstztZjZi253icMUQ4EYUJVj6SiZJI054g/XUcsCs5xyunNwg1trPVK//hkWjybNnN7pVksHb49zWiHK0YzlcTNmeZek3Ujt+7Gr7LndXglqwcq0VPdMuL7ibgLCfNQpgxwd3s2+4PEl8mPuDLl9PM3RtEViL6kGlvyquVS1OSiIa17RlHz93hm8gJM19PVnO1O1txhy7qOPNW7+m7KlC/TG0acFlog6pZDeNK3qZt3/oF9EOpvak6qqq5nO7qiYv7AXLl8f57TjS8YSV5QVI1MV+v4a++BrKTOjUTVW8o0agmLh+AzlrPmx8ykv94wMlHRDKNGbU5tUaFEekYPoaplu+v/ws/id+HiXSjqhqysqNqeKEm5yMRRkmmZGvTHJhV6Vl9kX4X/ABju/tbC0L/4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"build1\"\n        title=\"\"\n        src=\"/static/b4093bcd12b801cf2f98c2a6af86f05c/5a190/dockerfile-build1.png\"\n        srcset=\"/static/b4093bcd12b801cf2f98c2a6af86f05c/772e8/dockerfile-build1.png 200w,\n/static/b4093bcd12b801cf2f98c2a6af86f05c/e17e5/dockerfile-build1.png 400w,\n/static/b4093bcd12b801cf2f98c2a6af86f05c/5a190/dockerfile-build1.png 800w,\n/static/b4093bcd12b801cf2f98c2a6af86f05c/4d383/dockerfile-build1.png 1195w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n<li>Dockerfile 경로에 파일이 있는 경우\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d143b0522a87dd2afd5cd4c151fd4ddf/061c7/dockerfile-build2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYElEQVR42oWS2XKCQBBF+Y+kUsaoICCrxIVtgAFRSSyroGLikv//iptmEnxKzMOpXmbp2z0jMZ4jZCnKzRbZeost+fnExKncIC1KJJwjbmwYngXNtDDWTaiG9SdSyBLMlgGyYoWILs8jhsIPUecrLGlt7kd43hhY7MdwUh2qp+FJVtAbjH5FShoPfmUhqgLMsxcU+Q4136HMKvhpBcZfERRreJzReopZnMKdzTGmLnTLwcR2hDLTmYpYCnkItkrAiowUcbz5DAc/xjnJ8U7qancGZrjoKwYU1YCsTQTDsQZFNwQjVf/2KS8t6HDEMjFH03FFFcOimZG1px4sd0qHVdHO41BGf6RcaeMuJ3yyUpSkiDOOgOal/rShmfaVNm7b65QMFPUm0iIIESUZfHoMWdPFpa3tNgyJTtFDf4C7Xh/3N5CO5wsOxxOOl0/s6wbN4UPYnL5NSxAnYhwCKhz9wxdNqQNDR8ch/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"build2\"\n        title=\"\"\n        src=\"/static/d143b0522a87dd2afd5cd4c151fd4ddf/5a190/dockerfile-build2.png\"\n        srcset=\"/static/d143b0522a87dd2afd5cd4c151fd4ddf/772e8/dockerfile-build2.png 200w,\n/static/d143b0522a87dd2afd5cd4c151fd4ddf/e17e5/dockerfile-build2.png 400w,\n/static/d143b0522a87dd2afd5cd4c151fd4ddf/5a190/dockerfile-build2.png 800w,\n/static/d143b0522a87dd2afd5cd4c151fd4ddf/c1b63/dockerfile-build2.png 1200w,\n/static/d143b0522a87dd2afd5cd4c151fd4ddf/061c7/dockerfile-build2.png 1216w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n</li>\n<li>postgis image 는 타임존이 한국시간이 아니므로 반드시 Dockerfile 작성시 환경변수로 <strong>ENV TZ=Asia/Seoul</strong> 과 같이 줘야지 제대로 된 시간을 사용 할 수 있다.</li>\n<li>postgis image 에서 psql 은 <strong>docker-entrypoint-initdb.d</strong> 폴더에 작성한 스크립트만 실행이 가능하다.</li>\n<li>\n<p>컨테이너간 네트워크를 공유하는 경우에는 다음과 같이 설정해줘야 한다.(예를 들어 geoserver container 에서 db container 의 네트워크를 공유해서 postgis 저장소를 등록하는 경우)</p>\n<ul>\n<li>\n<p>service:“docker-compose 파일에 기술한 서비스명”</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\">services:\n      db:\n        build:\n          context: ./doc/docker/postgres\n          dockerfile: Dockerfile\n        ports:\n          - 15432:5432\n          - 18080:8080\n\n      geoserver:\n        image: gaia3d/geoserver:oim-2.17.3\n        network_mode: \"service:db\"</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/docker-compose-use/","prefix":"2020-10-13"},"frontmatter":{"title":"docker 로 개발환경 구성하기","category":"docker"}},"authornote":{"id":"265dda60-7971-5464-926f-ea569c79ac0a","html":"<p>🔘 안되면 될 때 까지! 🏃 🔘</p>"}},"pageContext":{"slug":"/docker-compose-use/","prev":{"id":"3439b04c-5731-56cf-b9ba-9a82df058350","fields":{"slug":"/docker-compose-manual/","prefix":"2020-08-27","source":"posts"},"frontmatter":{"title":"Docker Compose 작성 방법 및 명령어 정리","category":"docker"}},"next":{"id":"e43209b6-1808-5f96-858e-7058da4c0fc6","fields":{"slug":"/web-application-server/","prefix":"2020-12-13","source":"posts"},"frontmatter":{"title":"Web Application Server 와 servlet","category":"java"}},"source":"posts"}},"staticQueryHashes":["960164547","960164547"]}